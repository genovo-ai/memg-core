
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Memory Graph Core â€” AI memory + GraphRAG engine">
      
      
      
        <link rel="canonical" href="https://genovo-ai.github.io/memg-core/reference/api/">
      
      
        <link rel="prev" href="../../usage/">
      
      
        <link rel="next" href="../../changelog/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>API - memg-core</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="memg-core" class="md-header__button md-logo" aria-label="memg-core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            memg-core
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/genovo-ai/memg-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    genovo-ai/memg-core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../usage/" class="md-tabs__link">
        
  
  
    
  
  Usage

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="memg-core" class="md-nav__button md-logo" aria-label="memg-core" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    memg-core
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/genovo-ai/memg-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    genovo-ai/memg-core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#public-api" class="md-nav__link">
    <span class="md-ellipsis">
      Public API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public" class="md-nav__link">
    <span class="md-ellipsis">
      public
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public._CLIENT" class="md-nav__link">
    <span class="md-ellipsis">
      _CLIENT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseClients
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabaseClients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_embedder" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_kuzu_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_kuzu_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_qdrant_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_qdrant_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_yaml_translator" class="md-nav__link">
    <span class="md-ellipsis">
      get_yaml_translator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.init_dbs" class="md-nav__link">
    <span class="md-ellipsis">
      init_dbs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient" class="md-nav__link">
    <span class="md-ellipsis">
      MemgClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemgClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.add_memory" class="md-nav__link">
    <span class="md-ellipsis">
      add_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.delete_memory" class="md-nav__link">
    <span class="md-ellipsis">
      delete_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.get_memories" class="md-nav__link">
    <span class="md-ellipsis">
      get_memories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.update_memory" class="md-nav__link">
    <span class="md-ellipsis">
      update_memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemoryService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.add_memory" class="md-nav__link">
    <span class="md-ellipsis">
      add_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.delete_memory" class="md-nav__link">
    <span class="md-ellipsis">
      delete_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.update_memory" class="md-nav__link">
    <span class="md-ellipsis">
      update_memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchResult" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService" class="md-nav__link">
    <span class="md-ellipsis">
      SearchService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SearchService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.get_memories" class="md-nav__link">
    <span class="md-ellipsis">
      get_memories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YamlTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.build_anchor_text" class="md-nav__link">
    <span class="md-ellipsis">
      build_anchor_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.create_memory_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.debug_relation_map" class="md-nav__link">
    <span class="md-ellipsis">
      debug_relation_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_anchor_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_anchor_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_entity_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_labels_for_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      get_labels_for_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_relations_for_source" class="md-nav__link">
    <span class="md-ellipsis">
      get_relations_for_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_see_also_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_see_also_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.relationship_table_name" class="md-nav__link">
    <span class="md-ellipsis">
      relationship_table_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.validate_memory_against_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      validate_memory_against_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public._get_client" class="md-nav__link">
    <span class="md-ellipsis">
      _get_client
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.add_memory" class="md-nav__link">
    <span class="md-ellipsis">
      add_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.create_memory_service" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.create_search_service" class="md-nav__link">
    <span class="md-ellipsis">
      create_search_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.delete_memory" class="md-nav__link">
    <span class="md-ellipsis">
      delete_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_memories" class="md-nav__link">
    <span class="md-ellipsis">
      get_memories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_services" class="md-nav__link">
    <span class="md-ellipsis">
      get_services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.shutdown_services" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown_services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.update_memory" class="md-nav__link">
    <span class="md-ellipsis">
      update_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-models" class="md-nav__link">
    <span class="md-ellipsis">
      Core Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models._MAX_SCORE_TOLERANCE" class="md-nav__link">
    <span class="md-ellipsis">
      _MAX_SCORE_TOLERANCE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory" class="md-nav__link">
    <span class="md-ellipsis">
      Memory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory.memory_type_not_empty" class="md-nav__link">
    <span class="md-ellipsis">
      memory_type_not_empty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory.to_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      to_entity_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.MemoryNeighbor" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryNeighbor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.MemoryPoint" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryPoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemoryPoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.MemoryPoint.vector_not_empty" class="md-nav__link">
    <span class="md-ellipsis">
      vector_not_empty
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.MemorySeed" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySeed
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemorySeed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.MemorySeed.normalize_score" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.ProcessingResult" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessingResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.ProcessingResult.total_created" class="md-nav__link">
    <span class="md-ellipsis">
      total_created
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.RelationshipInfo" class="md-nav__link">
    <span class="md-ellipsis">
      RelationshipInfo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.SearchResult" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.DEFAULT_MEMG_CONFIG" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MEMG_CONFIG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.DEFAULT_SYSTEM_CONFIG" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SYSTEM_CONFIG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig" class="md-nav__link">
    <span class="md-ellipsis">
      MemGConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemGConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __post_init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.from_env" class="md-nav__link">
    <span class="md-ellipsis">
      from_env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.MemorySystemConfig" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySystemConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemorySystemConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemorySystemConfig.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __post_init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemorySystemConfig.from_env" class="md-nav__link">
    <span class="md-ellipsis">
      from_env
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      Exceptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      exceptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.ConfigurationError" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigurationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.MemorySystemError" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySystemError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.ProcessingError" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.ValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      ValidationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.handle_with_context" class="md-nav__link">
    <span class="md-ellipsis">
      handle_with_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.wrap_exception" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_exception
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yaml-schema" class="md-nav__link">
    <span class="md-ellipsis">
      YAML Schema
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator" class="md-nav__link">
    <span class="md-ellipsis">
      yaml_translator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory" class="md-nav__link">
    <span class="md-ellipsis">
      Memory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory.memory_type_not_empty" class="md-nav__link">
    <span class="md-ellipsis">
      memory_type_not_empty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory.to_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      to_entity_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.MemorySystemError" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySystemError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YamlTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.build_anchor_text" class="md-nav__link">
    <span class="md-ellipsis">
      build_anchor_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.create_memory_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.debug_relation_map" class="md-nav__link">
    <span class="md-ellipsis">
      debug_relation_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_anchor_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_anchor_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_entity_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_labels_for_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      get_labels_for_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_relations_for_source" class="md-nav__link">
    <span class="md-ellipsis">
      get_relations_for_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_see_also_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_see_also_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.relationship_table_name" class="md-nav__link">
    <span class="md-ellipsis">
      relationship_table_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.validate_memory_against_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      validate_memory_against_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslatorError" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslatorError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.initialize_types_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_types_from_yaml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hrid-management" class="md-nav__link">
    <span class="md-ellipsis">
      HRID Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid" class="md-nav__link">
    <span class="md-ellipsis">
      hrid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._COUNTERS" class="md-nav__link">
    <span class="md-ellipsis">
      _COUNTERS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._HRID_RE" class="md-nav__link">
    <span class="md-ellipsis">
      _HRID_RE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._alpha_to_idx" class="md-nav__link">
    <span class="md-ellipsis">
      _alpha_to_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._idx_to_alpha" class="md-nav__link">
    <span class="md-ellipsis">
      _idx_to_alpha
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._initialize_counter_from_tracker" class="md-nav__link">
    <span class="md-ellipsis">
      _initialize_counter_from_tracker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid.generate_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      generate_hrid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid.parse_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      parse_hrid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker" class="md-nav__link">
    <span class="md-ellipsis">
      hrid_tracker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker" class="md-nav__link">
    <span class="md-ellipsis">
      HridTracker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HridTracker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.create_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      create_mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.get_highest_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      get_highest_hrid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.get_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      get_hrid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.get_uuid" class="md-nav__link">
    <span class="md-ellipsis">
      get_uuid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.mark_deleted" class="md-nav__link">
    <span class="md-ellipsis">
      mark_deleted
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface" class="md-nav__link">
    <span class="md-ellipsis">
      KuzuInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KuzuInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.add_node" class="md-nav__link">
    <span class="md-ellipsis">
      add_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.delete_node" class="md-nav__link">
    <span class="md-ellipsis">
      delete_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.get_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      neighbors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.update_node" class="md-nav__link">
    <span class="md-ellipsis">
      update_node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker._alpha_to_idx" class="md-nav__link">
    <span class="md-ellipsis">
      _alpha_to_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.parse_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      parse_hrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parse_hrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-clients" class="md-nav__link">
    <span class="md-ellipsis">
      Database Clients
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients" class="md-nav__link">
    <span class="md-ellipsis">
      db_clients
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseClients
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabaseClients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_embedder" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_kuzu_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_kuzu_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_qdrant_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_qdrant_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_yaml_translator" class="md-nav__link">
    <span class="md-ellipsis">
      get_yaml_translator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.init_dbs" class="md-nav__link">
    <span class="md-ellipsis">
      init_dbs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder" class="md-nav__link">
    <span class="md-ellipsis">
      Embedder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder.get_embedding" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder.get_embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      get_embeddings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister" class="md-nav__link">
    <span class="md-ellipsis">
      GraphRegister
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GraphRegister">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_all_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_all_entity_tables_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_entity_tables_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_entity_table_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_entity_table_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_hrid_mapping_table_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_hrid_mapping_table_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_relationship_tables_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_relationship_tables_ddl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface" class="md-nav__link">
    <span class="md-ellipsis">
      KuzuInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KuzuInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.add_node" class="md-nav__link">
    <span class="md-ellipsis">
      add_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.delete_node" class="md-nav__link">
    <span class="md-ellipsis">
      delete_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.get_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      neighbors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.update_node" class="md-nav__link">
    <span class="md-ellipsis">
      update_node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface" class="md-nav__link">
    <span class="md-ellipsis">
      QdrantInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QdrantInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.add_point" class="md-nav__link">
    <span class="md-ellipsis">
      add_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.delete_points" class="md-nav__link">
    <span class="md-ellipsis">
      delete_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.get_collection_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.get_point" class="md-nav__link">
    <span class="md-ellipsis">
      get_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.search_points" class="md-nav__link">
    <span class="md-ellipsis">
      search_points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YamlTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.build_anchor_text" class="md-nav__link">
    <span class="md-ellipsis">
      build_anchor_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.create_memory_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.debug_relation_map" class="md-nav__link">
    <span class="md-ellipsis">
      debug_relation_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_anchor_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_anchor_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_entity_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_labels_for_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      get_labels_for_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_relations_for_source" class="md-nav__link">
    <span class="md-ellipsis">
      get_relations_for_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_see_also_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_see_also_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.relationship_table_name" class="md-nav__link">
    <span class="md-ellipsis">
      relationship_table_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.validate_memory_against_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      validate_memory_against_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_config
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#public-api" class="md-nav__link">
    <span class="md-ellipsis">
      Public API
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public" class="md-nav__link">
    <span class="md-ellipsis">
      public
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public._CLIENT" class="md-nav__link">
    <span class="md-ellipsis">
      _CLIENT
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseClients
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabaseClients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_embedder" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_kuzu_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_kuzu_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_qdrant_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_qdrant_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.get_yaml_translator" class="md-nav__link">
    <span class="md-ellipsis">
      get_yaml_translator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.DatabaseClients.init_dbs" class="md-nav__link">
    <span class="md-ellipsis">
      init_dbs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient" class="md-nav__link">
    <span class="md-ellipsis">
      MemgClient
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemgClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.add_memory" class="md-nav__link">
    <span class="md-ellipsis">
      add_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.delete_memory" class="md-nav__link">
    <span class="md-ellipsis">
      delete_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.get_memories" class="md-nav__link">
    <span class="md-ellipsis">
      get_memories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemgClient.update_memory" class="md-nav__link">
    <span class="md-ellipsis">
      update_memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemoryService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.add_memory" class="md-nav__link">
    <span class="md-ellipsis">
      add_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.delete_memory" class="md-nav__link">
    <span class="md-ellipsis">
      delete_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.MemoryService.update_memory" class="md-nav__link">
    <span class="md-ellipsis">
      update_memory
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchResult" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService" class="md-nav__link">
    <span class="md-ellipsis">
      SearchService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SearchService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.get_memories" class="md-nav__link">
    <span class="md-ellipsis">
      get_memories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.SearchService.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YamlTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.build_anchor_text" class="md-nav__link">
    <span class="md-ellipsis">
      build_anchor_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.create_memory_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.debug_relation_map" class="md-nav__link">
    <span class="md-ellipsis">
      debug_relation_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_anchor_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_anchor_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_entity_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_labels_for_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      get_labels_for_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_relations_for_source" class="md-nav__link">
    <span class="md-ellipsis">
      get_relations_for_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.get_see_also_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_see_also_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.relationship_table_name" class="md-nav__link">
    <span class="md-ellipsis">
      relationship_table_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.api.public.YamlTranslator.validate_memory_against_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      validate_memory_against_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public._get_client" class="md-nav__link">
    <span class="md-ellipsis">
      _get_client
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.add_memory" class="md-nav__link">
    <span class="md-ellipsis">
      add_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.create_memory_service" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.create_search_service" class="md-nav__link">
    <span class="md-ellipsis">
      create_search_service
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.delete_memory" class="md-nav__link">
    <span class="md-ellipsis">
      delete_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_memories" class="md-nav__link">
    <span class="md-ellipsis">
      get_memories
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_memory" class="md-nav__link">
    <span class="md-ellipsis">
      get_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.get_services" class="md-nav__link">
    <span class="md-ellipsis">
      get_services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.search" class="md-nav__link">
    <span class="md-ellipsis">
      search
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.shutdown_services" class="md-nav__link">
    <span class="md-ellipsis">
      shutdown_services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.api.public.update_memory" class="md-nav__link">
    <span class="md-ellipsis">
      update_memory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-models" class="md-nav__link">
    <span class="md-ellipsis">
      Core Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models._MAX_SCORE_TOLERANCE" class="md-nav__link">
    <span class="md-ellipsis">
      _MAX_SCORE_TOLERANCE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory" class="md-nav__link">
    <span class="md-ellipsis">
      Memory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory.memory_type_not_empty" class="md-nav__link">
    <span class="md-ellipsis">
      memory_type_not_empty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.Memory.to_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      to_entity_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.MemoryNeighbor" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryNeighbor
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.MemoryPoint" class="md-nav__link">
    <span class="md-ellipsis">
      MemoryPoint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemoryPoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.MemoryPoint.vector_not_empty" class="md-nav__link">
    <span class="md-ellipsis">
      vector_not_empty
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.MemorySeed" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySeed
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemorySeed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.MemorySeed.normalize_score" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_score
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.ProcessingResult" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProcessingResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.models.ProcessingResult.total_created" class="md-nav__link">
    <span class="md-ellipsis">
      total_created
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.RelationshipInfo" class="md-nav__link">
    <span class="md-ellipsis">
      RelationshipInfo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.SearchResult" class="md-nav__link">
    <span class="md-ellipsis">
      SearchResult
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.models.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.DEFAULT_MEMG_CONFIG" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_MEMG_CONFIG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.DEFAULT_SYSTEM_CONFIG" class="md-nav__link">
    <span class="md-ellipsis">
      DEFAULT_SYSTEM_CONFIG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig" class="md-nav__link">
    <span class="md-ellipsis">
      MemGConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemGConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __post_init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.from_env" class="md-nav__link">
    <span class="md-ellipsis">
      from_env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemGConfig.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.MemorySystemConfig" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySystemConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MemorySystemConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemorySystemConfig.__post_init__" class="md-nav__link">
    <span class="md-ellipsis">
      __post_init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.config.MemorySystemConfig.from_env" class="md-nav__link">
    <span class="md-ellipsis">
      from_env
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.config.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      Exceptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      exceptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.ConfigurationError" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigurationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.MemorySystemError" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySystemError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.ProcessingError" class="md-nav__link">
    <span class="md-ellipsis">
      ProcessingError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.ValidationError" class="md-nav__link">
    <span class="md-ellipsis">
      ValidationError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.handle_with_context" class="md-nav__link">
    <span class="md-ellipsis">
      handle_with_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.exceptions.wrap_exception" class="md-nav__link">
    <span class="md-ellipsis">
      wrap_exception
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yaml-schema" class="md-nav__link">
    <span class="md-ellipsis">
      YAML Schema
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator" class="md-nav__link">
    <span class="md-ellipsis">
      yaml_translator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory" class="md-nav__link">
    <span class="md-ellipsis">
      Memory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __getattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory.memory_type_not_empty" class="md-nav__link">
    <span class="md-ellipsis">
      memory_type_not_empty
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.Memory.to_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      to_entity_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.MemorySystemError" class="md-nav__link">
    <span class="md-ellipsis">
      MemorySystemError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YamlTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.build_anchor_text" class="md-nav__link">
    <span class="md-ellipsis">
      build_anchor_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.create_memory_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.debug_relation_map" class="md-nav__link">
    <span class="md-ellipsis">
      debug_relation_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_anchor_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_anchor_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_entity_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_labels_for_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      get_labels_for_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_relations_for_source" class="md-nav__link">
    <span class="md-ellipsis">
      get_relations_for_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.get_see_also_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_see_also_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.relationship_table_name" class="md-nav__link">
    <span class="md-ellipsis">
      relationship_table_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslator.validate_memory_against_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      validate_memory_against_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.YamlTranslatorError" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslatorError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.core.yaml_translator.initialize_types_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_types_from_yaml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hrid-management" class="md-nav__link">
    <span class="md-ellipsis">
      HRID Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid" class="md-nav__link">
    <span class="md-ellipsis">
      hrid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._COUNTERS" class="md-nav__link">
    <span class="md-ellipsis">
      _COUNTERS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._HRID_RE" class="md-nav__link">
    <span class="md-ellipsis">
      _HRID_RE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._alpha_to_idx" class="md-nav__link">
    <span class="md-ellipsis">
      _alpha_to_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._idx_to_alpha" class="md-nav__link">
    <span class="md-ellipsis">
      _idx_to_alpha
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid._initialize_counter_from_tracker" class="md-nav__link">
    <span class="md-ellipsis">
      _initialize_counter_from_tracker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid.generate_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      generate_hrid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid.parse_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      parse_hrid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker" class="md-nav__link">
    <span class="md-ellipsis">
      hrid_tracker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker" class="md-nav__link">
    <span class="md-ellipsis">
      HridTracker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HridTracker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.create_mapping" class="md-nav__link">
    <span class="md-ellipsis">
      create_mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.exists" class="md-nav__link">
    <span class="md-ellipsis">
      exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.get_highest_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      get_highest_hrid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.get_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      get_hrid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.get_uuid" class="md-nav__link">
    <span class="md-ellipsis">
      get_uuid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.HridTracker.mark_deleted" class="md-nav__link">
    <span class="md-ellipsis">
      mark_deleted
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface" class="md-nav__link">
    <span class="md-ellipsis">
      KuzuInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KuzuInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.add_node" class="md-nav__link">
    <span class="md-ellipsis">
      add_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.delete_node" class="md-nav__link">
    <span class="md-ellipsis">
      delete_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.get_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      neighbors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.KuzuInterface.update_node" class="md-nav__link">
    <span class="md-ellipsis">
      update_node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker._alpha_to_idx" class="md-nav__link">
    <span class="md-ellipsis">
      _alpha_to_idx
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.hrid_tracker.parse_hrid" class="md-nav__link">
    <span class="md-ellipsis">
      parse_hrid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="parse_hrid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-clients" class="md-nav__link">
    <span class="md-ellipsis">
      Database Clients
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients" class="md-nav__link">
    <span class="md-ellipsis">
      db_clients
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseClients
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DatabaseClients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.close" class="md-nav__link">
    <span class="md-ellipsis">
      close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_embedder" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_kuzu_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_kuzu_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_qdrant_interface" class="md-nav__link">
    <span class="md-ellipsis">
      get_qdrant_interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.get_yaml_translator" class="md-nav__link">
    <span class="md-ellipsis">
      get_yaml_translator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseClients.init_dbs" class="md-nav__link">
    <span class="md-ellipsis">
      init_dbs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.DatabaseError" class="md-nav__link">
    <span class="md-ellipsis">
      DatabaseError
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder" class="md-nav__link">
    <span class="md-ellipsis">
      Embedder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Embedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder.get_embedding" class="md-nav__link">
    <span class="md-ellipsis">
      get_embedding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.Embedder.get_embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      get_embeddings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister" class="md-nav__link">
    <span class="md-ellipsis">
      GraphRegister
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GraphRegister">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_all_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_all_entity_tables_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_entity_tables_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_entity_table_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_entity_table_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_hrid_mapping_table_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_hrid_mapping_table_ddl
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.GraphRegister.generate_relationship_tables_ddl" class="md-nav__link">
    <span class="md-ellipsis">
      generate_relationship_tables_ddl
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface" class="md-nav__link">
    <span class="md-ellipsis">
      KuzuInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="KuzuInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.add_node" class="md-nav__link">
    <span class="md-ellipsis">
      add_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.add_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      add_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.delete_node" class="md-nav__link">
    <span class="md-ellipsis">
      delete_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.delete_relationship" class="md-nav__link">
    <span class="md-ellipsis">
      delete_relationship
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.get_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      get_nodes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      neighbors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.KuzuInterface.update_node" class="md-nav__link">
    <span class="md-ellipsis">
      update_node
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface" class="md-nav__link">
    <span class="md-ellipsis">
      QdrantInterface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QdrantInterface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.add_point" class="md-nav__link">
    <span class="md-ellipsis">
      add_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.delete_points" class="md-nav__link">
    <span class="md-ellipsis">
      delete_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.get_collection_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_collection_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.get_point" class="md-nav__link">
    <span class="md-ellipsis">
      get_point
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.QdrantInterface.search_points" class="md-nav__link">
    <span class="md-ellipsis">
      search_points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator" class="md-nav__link">
    <span class="md-ellipsis">
      YamlTranslator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="YamlTranslator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.build_anchor_text" class="md-nav__link">
    <span class="md-ellipsis">
      build_anchor_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.create_memory_from_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      create_memory_from_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.debug_relation_map" class="md-nav__link">
    <span class="md-ellipsis">
      debug_relation_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_anchor_field" class="md-nav__link">
    <span class="md-ellipsis">
      get_anchor_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_entity_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_entity_types" class="md-nav__link">
    <span class="md-ellipsis">
      get_entity_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_labels_for_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      get_labels_for_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_relations_for_source" class="md-nav__link">
    <span class="md-ellipsis">
      get_relations_for_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.get_see_also_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_see_also_config
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.relationship_table_name" class="md-nav__link">
    <span class="md-ellipsis">
      relationship_table_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.YamlTranslator.validate_memory_against_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      validate_memory_against_yaml
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memg_core.utils.db_clients.get_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_config
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference">API Reference</h1>
<p>This page provides comprehensive API documentation for memg-core.</p>
<h2 id="public-api">Public API</h2>
<p>The main interface for memg-core is through the public API module:</p>


<div class="doc doc-object doc-module">



<a id="memg_core.api.public"></a>
    <div class="doc doc-contents first">

        <p>Public API for memg-core - designed for long-running servers.</p>
<p>Provides MemgClient for explicit initialization and module-level functions for
environment-based usage.</p>










  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="memg_core.api.public._CLIENT" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_CLIENT</span> <span class="o">=</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-class">



<h2 id="memg_core.api.public.DatabaseClients" class="doc doc-heading">
            <code>DatabaseClients</code>


</h2>


    <div class="doc doc-contents ">


        <p>DDL-only database setup - creates schemas and returns raw clients.</p>
<p>NO INTERFACES - pure schema creation only.
Consumer must create interfaces separately using returned raw clients.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.DatabaseClients.qdrant_client">qdrant_client</span></code></td>
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized QdrantClient.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.DatabaseClients.kuzu_connection">kuzu_connection</span></code></td>
            <td>
                  <code><span title="kuzu.Connection">Connection</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized Kuzu connection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.DatabaseClients.db_name">db_name</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.DatabaseClients.qdrant_path">qdrant_path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to Qdrant database.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.DatabaseClients.kuzu_path">kuzu_path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to Kuzu database.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.DatabaseClients.yaml_translator">yaml_translator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>YAML translator instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseClients</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DDL-only database setup - creates schemas and returns raw clients.</span>

<span class="sd">    NO INTERFACES - pure schema creation only.</span>
<span class="sd">    Consumer must create interfaces separately using returned raw clients.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        qdrant_client: Pre-initialized QdrantClient.</span>
<span class="sd">        kuzu_connection: Pre-initialized Kuzu connection.</span>
<span class="sd">        db_name: Database name.</span>
<span class="sd">        qdrant_path: Path to Qdrant database.</span>
<span class="sd">        kuzu_path: Path to Kuzu database.</span>
<span class="sd">        yaml_translator: YAML translator instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create DDL-only database client wrapper.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml_path: Path to YAML schema file. User must provide - no defaults.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">:</span> <span class="n">QdrantClient</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Set during init_dbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="s2">&quot;qdrant&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="s2">&quot;kuzu&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">YamlTranslator</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">yaml_path</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_dbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize databases with structured paths.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_path: Base database directory.</span>
<span class="sd">            db_name: Database name (used for collection and file names).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Structure paths</span>
        <span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;qdrant&quot;</span><span class="p">)</span>
        <span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;kuzu&quot;</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span>

        <span class="c1"># Store paths and names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">qdrant_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">kuzu_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="n">db_name</span>

        <span class="c1"># Ensure directories exist</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">qdrant_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create raw database clients directly</span>
        <span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">qdrant_path</span><span class="p">)</span>
        <span class="n">kuzu_db</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span>
        <span class="n">kuzu_conn</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">kuzu_db</span><span class="p">)</span>

        <span class="c1"># Store raw clients for interface creation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">qdrant_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="n">kuzu_conn</span>

        <span class="c1"># DDL operations - create collection and tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_qdrant_collection</span><span class="p">(</span><span class="n">qdrant_client</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_kuzu_tables_with_graph_register</span><span class="p">(</span><span class="n">kuzu_conn</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_qdrant_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Qdrant collection if it doesn&#39;t exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            client: Qdrant client instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If collection creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
            <span class="n">vector_dimension</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">vector_dimension</span>
            <span class="n">collection_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span>

            <span class="n">collections</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_collections</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">collection_name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">collections</span><span class="p">):</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="n">VectorParams</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">vector_dimension</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to setup Qdrant collection&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_setup_qdrant_collection&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_kuzu_tables_with_graph_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Kuzu tables using GraphRegister for DDL generation.</span>

<span class="sd">        Args:</span>
<span class="sd">            conn: Kuzu database connection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If YAML translator not initialized or table creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YAML translator not initialized. Provide yaml_path to constructor.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_setup_kuzu_tables_with_graph_register&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create GraphRegister with YamlTranslator for complete DDL generation</span>
            <span class="n">graph_register</span> <span class="o">=</span> <span class="n">GraphRegister</span><span class="p">(</span><span class="n">yaml_translator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>

            <span class="c1"># Generate all DDL statements using GraphRegister</span>
            <span class="n">ddl_statements</span> <span class="o">=</span> <span class="n">graph_register</span><span class="o">.</span><span class="n">generate_all_ddl</span><span class="p">()</span>

            <span class="c1"># Execute all DDL statements</span>
            <span class="k">for</span> <span class="n">ddl</span> <span class="ow">in</span> <span class="n">ddl_statements</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ddl</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to setup Kuzu tables using GraphRegister&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_setup_kuzu_tables_with_graph_register&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># ===== INTERFACE ACCESS METHODS =====</span>
    <span class="c1"># After DDL operations, provide access to CRUD interfaces</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_qdrant_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QdrantInterface</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Qdrant interface using the initialized client.</span>

<span class="sd">        Returns:</span>
<span class="sd">            QdrantInterface: Configured with the DDL-created client and collection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If client not initialized (call init_dbs first).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Qdrant client not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_qdrant_interface&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">QdrantInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_kuzu_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KuzuInterface</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Kuzu interface using the initialized connection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            KuzuInterface: Configured with the DDL-created connection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If connection not initialized (call init_dbs first).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Kuzu connection not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_kuzu_interface&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">KuzuInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_embedder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Embedder</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get embedder instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Embedder: Instance for generating vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Embedder</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_yaml_translator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">YamlTranslator</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the YAML translator used for schema operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            YamlTranslator: Instance used during DDL operations.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If YAML translator not initialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YAML translator not initialized. Provide yaml_path to constructor.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_yaml_translator&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close all database connections and cleanup resources.</span>

<span class="sd">        Should be called when database clients are no longer needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
                <span class="c1"># Ignore cleanup errors - best effort</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
                <span class="c1"># Ignore cleanup errors - best effort</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.DatabaseClients.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">yaml_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create DDL-only database client wrapper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>yaml_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file. User must provide - no defaults.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create DDL-only database client wrapper.</span>

<span class="sd">    Args:</span>
<span class="sd">        yaml_path: Path to YAML schema file. User must provide - no defaults.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">:</span> <span class="n">QdrantClient</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Set during init_dbs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="s2">&quot;qdrant&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="s2">&quot;kuzu&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">YamlTranslator</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">yaml_path</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.DatabaseClients.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Close all database connections and cleanup resources.</p>
<p>Should be called when database clients are no longer needed.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close all database connections and cleanup resources.</span>

<span class="sd">    Should be called when database clients are no longer needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="c1"># Ignore cleanup errors - best effort</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="c1"># Ignore cleanup errors - best effort</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.DatabaseClients.get_embedder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_embedder</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get embedder instance.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Embedder</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Embedder (memg_core.core.interfaces.embedder.Embedder)" href="#memg_core.utils.db_clients.Embedder">Embedder</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instance for generating vectors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_embedder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Embedder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get embedder instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Embedder: Instance for generating vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Embedder</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.DatabaseClients.get_kuzu_interface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_kuzu_interface</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get Kuzu interface using the initialized connection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>KuzuInterface</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="KuzuInterface (memg_core.core.interfaces.kuzu.KuzuInterface)" href="#memg_core.utils.hrid_tracker.KuzuInterface">KuzuInterface</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured with the DDL-created connection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If connection not initialized (call init_dbs first).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_kuzu_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KuzuInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Kuzu interface using the initialized connection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        KuzuInterface: Configured with the DDL-created connection.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If connection not initialized (call init_dbs first).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Kuzu connection not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_kuzu_interface&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">KuzuInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.DatabaseClients.get_qdrant_interface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_qdrant_interface</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get Qdrant interface using the initialized client.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>QdrantInterface</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantInterface (memg_core.core.interfaces.qdrant.QdrantInterface)" href="#memg_core.utils.db_clients.QdrantInterface">QdrantInterface</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured with the DDL-created client and collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If client not initialized (call init_dbs first).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_qdrant_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QdrantInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Qdrant interface using the initialized client.</span>

<span class="sd">    Returns:</span>
<span class="sd">        QdrantInterface: Configured with the DDL-created client and collection.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If client not initialized (call init_dbs first).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Qdrant client not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_qdrant_interface&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">QdrantInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.DatabaseClients.get_yaml_translator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_yaml_translator</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the YAML translator used for schema operations.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>YamlTranslator</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslator (memg_core.core.yaml_translator.YamlTranslator)" href="#memg_core.core.yaml_translator.YamlTranslator">YamlTranslator</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instance used during DDL operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If YAML translator not initialized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_yaml_translator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">YamlTranslator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the YAML translator used for schema operations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        YamlTranslator: Instance used during DDL operations.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If YAML translator not initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;YAML translator not initialized. Provide yaml_path to constructor.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_yaml_translator&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.DatabaseClients.init_dbs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_dbs</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize databases with structured paths.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base database directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>db_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database name (used for collection and file names).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_dbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize databases with structured paths.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_path: Base database directory.</span>
<span class="sd">        db_name: Database name (used for collection and file names).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Structure paths</span>
    <span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;qdrant&quot;</span><span class="p">)</span>
    <span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;kuzu&quot;</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span>

    <span class="c1"># Store paths and names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">qdrant_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">kuzu_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="n">db_name</span>

    <span class="c1"># Ensure directories exist</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">qdrant_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create raw database clients directly</span>
    <span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">qdrant_path</span><span class="p">)</span>
    <span class="n">kuzu_db</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span>
    <span class="n">kuzu_conn</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">kuzu_db</span><span class="p">)</span>

    <span class="c1"># Store raw clients for interface creation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">qdrant_client</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="n">kuzu_conn</span>

    <span class="c1"># DDL operations - create collection and tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_qdrant_collection</span><span class="p">(</span><span class="n">qdrant_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_kuzu_tables_with_graph_register</span><span class="p">(</span><span class="n">kuzu_conn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.api.public.MemgClient" class="doc doc-heading">
            <code>MemgClient</code>


</h2>


    <div class="doc doc-contents ">


        <p>Client for memg-core operations - initialize once, use throughout server lifetime.</p>
<p>Provides a clean interface for memory operations with explicit resource management.</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemgClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Client for memg-core operations - initialize once, use throughout server lifetime.</span>

<span class="sd">    Provides a clean interface for memory operations with explicit resource management.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize client for long-running server usage.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml_path: Path to YAML schema configuration file.</span>
<span class="sd">            db_path: Base directory path for database storage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span> <span class="o">=</span> <span class="n">DatabaseClients</span><span class="p">(</span><span class="n">yaml_path</span><span class="o">=</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="o">.</span><span class="n">init_dbs</span><span class="p">(</span><span class="n">db_path</span><span class="o">=</span><span class="n">db_path</span><span class="p">,</span> <span class="n">db_name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span> <span class="o">=</span> <span class="n">create_memory_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span> <span class="o">=</span> <span class="n">create_search_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to initialize memg-core services&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add memory and return HRID.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory_type: Entity type from YAML schema (e.g., &#39;task&#39;, &#39;note&#39;).</span>
<span class="sd">            payload: Memory data conforming to YAML schema.</span>
<span class="sd">            user_id: Owner of the memory.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Human-readable ID (HRID) for the created memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decay_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decay_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search memories with explicit seed/neighbor separation.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Text to search for.</span>
<span class="sd">            user_id: User ID for filtering results.</span>
<span class="sd">            memory_type: Optional memory type filter.</span>
<span class="sd">            limit: Maximum number of results to return.</span>
<span class="sd">            score_threshold: Minimum similarity score threshold (0.0-1.0).</span>
<span class="sd">            decay_rate: Score decay factor per hop (default: 1.0 = no decay).</span>
<span class="sd">            decay_threshold: Explicit neighbor score threshold (overrides decay_rate).</span>
<span class="sd">            **kwargs: Additional search parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SearchResult: Search result with explicit seed/neighbor separation,</span>
<span class="sd">                including full payloads for seeds and relationships.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">query</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">clean_query</span><span class="p">,</span>
            <span class="n">user_id</span><span class="p">,</span>
            <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
            <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">,</span>
            <span class="n">decay_threshold</span><span class="o">=</span><span class="n">decay_threshold</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete memory by HRID.</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Human-readable ID of the memory to delete.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            memory_type: Optional memory type hint.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion succeeded, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload_updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update memory with partial payload changes (patch-style update).</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Memory HRID to update.</span>
<span class="sd">            payload_updates: Dictionary of fields to update (only changed fields).</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            memory_type: Optional memory type hint (inferred from HRID if not provided).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if update succeeded, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">update_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">payload_updates</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add relationship between memories.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_memory_hrid: Source memory HRID.</span>
<span class="sd">            to_memory_hrid: Target memory HRID.</span>
<span class="sd">            relation_type: Relationship type from YAML schema.</span>
<span class="sd">            from_memory_type: Source memory entity type.</span>
<span class="sd">            to_memory_type: Target memory entity type.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            properties: Optional relationship properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span>
            <span class="n">from_memory_hrid</span><span class="p">,</span>
            <span class="n">to_memory_hrid</span><span class="p">,</span>
            <span class="n">relation_type</span><span class="p">,</span>
            <span class="n">from_memory_type</span><span class="p">,</span>
            <span class="n">to_memory_type</span><span class="p">,</span>
            <span class="n">user_id</span><span class="p">,</span>
            <span class="n">properties</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete relationship between memories.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_memory_hrid: Source memory HRID.</span>
<span class="sd">            to_memory_hrid: Target memory HRID.</span>
<span class="sd">            relation_type: Relationship type from YAML schema.</span>
<span class="sd">            from_memory_type: Source memory entity type (inferred from HRID if not provided).</span>
<span class="sd">            to_memory_type: Target memory entity type (inferred from HRID if not provided).</span>
<span class="sd">            user_id: User ID for ownership verification (required).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion succeeded, False if relationship not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">delete_relationship</span><span class="p">(</span>
            <span class="n">from_memory_hrid</span><span class="p">,</span>
            <span class="n">to_memory_hrid</span><span class="p">,</span>
            <span class="n">relation_type</span><span class="p">,</span>
            <span class="n">from_memory_type</span><span class="p">,</span>
            <span class="n">to_memory_type</span><span class="p">,</span>
            <span class="n">user_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_memory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">relation_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">neighbor_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a single memory by HRID with optional neighbor expansion.</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Human-readable identifier of the memory.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            memory_type: Optional memory type hint (inferred from HRID if not provided).</span>
<span class="sd">            include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">            hops: Number of hops for neighbor expansion (default 1).</span>
<span class="sd">            relation_types: Filter by specific relationship types (None = all relations).</span>
<span class="sd">            neighbor_limit: Maximum neighbors to return per hop (default 5).</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="o">.</span><span class="n">get_memory</span><span class="p">(</span>
            <span class="n">hrid</span><span class="p">,</span>
            <span class="n">user_id</span><span class="p">,</span>
            <span class="n">memory_type</span><span class="p">,</span>
            <span class="n">include_neighbors</span><span class="p">,</span>
            <span class="n">hops</span><span class="p">,</span>
            <span class="n">relation_types</span><span class="p">,</span>
            <span class="n">neighbor_limit</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_memories</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get multiple memories with filtering and optional graph expansion.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            memory_type: Optional memory type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">            filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;, &quot;priority&quot;: &quot;high&quot;}).</span>
<span class="sd">            limit: Maximum number of memories to return (default 50).</span>
<span class="sd">            offset: Number of memories to skip for pagination (default 0).</span>
<span class="sd">            include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">            hops: Number of hops for neighbor expansion (default 1).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of memory data with full payloads.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="o">.</span><span class="n">get_memories</span><span class="p">(</span>
            <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="p">,</span> <span class="n">hops</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close client and cleanup resources.</span>

<span class="sd">        Should be called when the client is no longer needed to free database connections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_db_clients&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize client for long-running server usage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>yaml_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>db_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base directory path for database storage.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize client for long-running server usage.</span>

<span class="sd">    Args:</span>
<span class="sd">        yaml_path: Path to YAML schema configuration file.</span>
<span class="sd">        db_path: Base directory path for database storage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span> <span class="o">=</span> <span class="n">DatabaseClients</span><span class="p">(</span><span class="n">yaml_path</span><span class="o">=</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="o">.</span><span class="n">init_dbs</span><span class="p">(</span><span class="n">db_path</span><span class="o">=</span><span class="n">db_path</span><span class="p">,</span> <span class="n">db_name</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span> <span class="o">=</span> <span class="n">create_memory_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span> <span class="o">=</span> <span class="n">create_search_service</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to initialize memg-core services&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.add_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_memory</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add memory and return HRID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type from YAML schema (e.g., 'task', 'note').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory data conforming to YAML schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Owner of the memory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID (HRID) for the created memory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add memory and return HRID.</span>

<span class="sd">    Args:</span>
<span class="sd">        memory_type: Entity type from YAML schema (e.g., &#39;task&#39;, &#39;note&#39;).</span>
<span class="sd">        payload: Memory data conforming to YAML schema.</span>
<span class="sd">        user_id: Owner of the memory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Human-readable ID (HRID) for the created memory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.add_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_relationship</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">,</span> <span class="n">from_memory_type</span><span class="p">,</span> <span class="n">to_memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add relationship between memories.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type from YAML schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional relationship properties.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add relationship between memories.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_memory_hrid: Source memory HRID.</span>
<span class="sd">        to_memory_hrid: Target memory HRID.</span>
<span class="sd">        relation_type: Relationship type from YAML schema.</span>
<span class="sd">        from_memory_type: Source memory entity type.</span>
<span class="sd">        to_memory_type: Target memory entity type.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        properties: Optional relationship properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span>
        <span class="n">from_memory_hrid</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Close client and cleanup resources.</p>
<p>Should be called when the client is no longer needed to free database connections.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close client and cleanup resources.</span>

<span class="sd">    Should be called when the client is no longer needed to free database connections.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_db_clients&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_db_clients</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.delete_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete memory by HRID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID of the memory to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete memory by HRID.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable ID of the memory to delete.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.delete_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_relationship</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">,</span> <span class="n">from_memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete relationship between memories.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type from YAML schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory entity type (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory entity type (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification (required).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded, False if relationship not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete relationship between memories.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_memory_hrid: Source memory HRID.</span>
<span class="sd">        to_memory_hrid: Target memory HRID.</span>
<span class="sd">        relation_type: Relationship type from YAML schema.</span>
<span class="sd">        from_memory_type: Source memory entity type (inferred from HRID if not provided).</span>
<span class="sd">        to_memory_type: Target memory entity type (inferred from HRID if not provided).</span>
<span class="sd">        user_id: User ID for ownership verification (required).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded, False if relationship not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">delete_relationship</span><span class="p">(</span>
        <span class="n">from_memory_hrid</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.get_memories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_memories</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get multiple memories with filtering and optional graph expansion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type filter (e.g., "task", "note").</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional field filters (e.g., {"status": "open", "priority": "high"}).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of memories to return (default 50).</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of memories to skip for pagination (default 0).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_neighbors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include neighbor nodes via graph traversal.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hops</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of hops for neighbor expansion (default 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of memory data with full payloads.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_memories</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get multiple memories with filtering and optional graph expansion.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">        filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;, &quot;priority&quot;: &quot;high&quot;}).</span>
<span class="sd">        limit: Maximum number of memories to return (default 50).</span>
<span class="sd">        offset: Number of memories to skip for pagination (default 0).</span>
<span class="sd">        include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">        hops: Number of hops for neighbor expansion (default 1).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of memory data with full payloads.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="o">.</span><span class="n">get_memories</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="p">,</span> <span class="n">hops</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.get_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relation_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neighbor_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single memory by HRID with optional neighbor expansion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier of the memory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_neighbors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include neighbor nodes via graph traversal.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hops</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of hops for neighbor expansion (default 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_types</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by specific relationship types (None = all relations).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum neighbors to return per hop (default 5).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_memory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">relation_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">neighbor_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a single memory by HRID with optional neighbor expansion.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable identifier of the memory.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint (inferred from HRID if not provided).</span>
<span class="sd">        include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">        hops: Number of hops for neighbor expansion (default 1).</span>
<span class="sd">        relation_types: Filter by specific relationship types (None = all relations).</span>
<span class="sd">        neighbor_limit: Maximum neighbors to return per hop (default 5).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="o">.</span><span class="n">get_memory</span><span class="p">(</span>
        <span class="n">hrid</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">,</span>
        <span class="n">include_neighbors</span><span class="p">,</span>
        <span class="n">hops</span><span class="p">,</span>
        <span class="n">relation_types</span><span class="p">,</span>
        <span class="n">neighbor_limit</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decay_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Search memories with explicit seed/neighbor separation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to search for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for filtering results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type filter.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of results to return.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity score threshold (0.0-1.0).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decay_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Score decay factor per hop (default: 1.0 = no decay).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decay_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Explicit neighbor score threshold (overrides decay_rate).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional search parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SearchResult</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="SearchResult (memg_core.core.models.SearchResult)" href="#memg_core.core.models.SearchResult">SearchResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search result with explicit seed/neighbor separation,
including full payloads for seeds and relationships.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decay_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decay_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search memories with explicit seed/neighbor separation.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Text to search for.</span>
<span class="sd">        user_id: User ID for filtering results.</span>
<span class="sd">        memory_type: Optional memory type filter.</span>
<span class="sd">        limit: Maximum number of results to return.</span>
<span class="sd">        score_threshold: Minimum similarity score threshold (0.0-1.0).</span>
<span class="sd">        decay_rate: Score decay factor per hop (default: 1.0 = no decay).</span>
<span class="sd">        decay_threshold: Explicit neighbor score threshold (overrides decay_rate).</span>
<span class="sd">        **kwargs: Additional search parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SearchResult: Search result with explicit seed/neighbor separation,</span>
<span class="sd">            including full payloads for seeds and relationships.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clean_query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">query</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_service</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">clean_query</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
        <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">,</span>
        <span class="n">decay_threshold</span><span class="o">=</span><span class="n">decay_threshold</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemgClient.update_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">payload_updates</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update memory with partial payload changes (patch-style update).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory HRID to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload_updates</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of fields to update (only changed fields).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if update succeeded, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">payload_updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update memory with partial payload changes (patch-style update).</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Memory HRID to update.</span>
<span class="sd">        payload_updates: Dictionary of fields to update (only changed fields).</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint (inferred from HRID if not provided).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if update succeeded, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_service</span><span class="o">.</span><span class="n">update_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">payload_updates</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.api.public.MemoryService" class="doc doc-heading">
            <code>MemoryService</code>


</h2>


    <div class="doc doc-contents ">


        <p>Unified memory service - handles indexing, search, and deletion operations.</p>
<p>Provides a clean, class-based interface for all memory operations using
DatabaseClients for both DDL initialization and CRUD interface access.
Eliminates the need for scattered interface creation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.MemoryService.qdrant">qdrant</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Qdrant interface instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.MemoryService.kuzu">kuzu</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kuzu interface instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.MemoryService.embedder">embedder</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Embedder instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.MemoryService.yaml_translator">yaml_translator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>YAML translator instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.MemoryService.hrid_tracker">hrid_tracker</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HRID tracker instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemoryService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unified memory service - handles indexing, search, and deletion operations.</span>

<span class="sd">    Provides a clean, class-based interface for all memory operations using</span>
<span class="sd">    DatabaseClients for both DDL initialization and CRUD interface access.</span>
<span class="sd">    Eliminates the need for scattered interface creation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        qdrant: Qdrant interface instance.</span>
<span class="sd">        kuzu: Kuzu interface instance.</span>
<span class="sd">        embedder: Embedder instance.</span>
<span class="sd">        yaml_translator: YAML translator instance.</span>
<span class="sd">        hrid_tracker: HRID tracker instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_clients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize MemoryService with DatabaseClients.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_clients: DatabaseClients instance (after init_dbs() called).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_clients</span><span class="p">,</span> <span class="n">DatabaseClients</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;db_clients must be a DatabaseClients instance&quot;</span><span class="p">)</span>

        <span class="c1"># Get interfaces from DatabaseClients (reuses DDL-created clients)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_qdrant_interface</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_kuzu_interface</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_embedder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_yaml_translator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span> <span class="o">=</span> <span class="n">HridTracker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="p">)</span>

        <span class="c1"># Initialize memory serializer for packing/unpacking</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.retrieval</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemorySerializer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span> <span class="o">=</span> <span class="n">MemorySerializer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a memory to both graph and vector storage.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory_type: Entity type from YAML schema (e.g., &#39;task&#39;, &#39;note&#39;).</span>
<span class="sd">            payload: Memory data conforming to YAML schema.</span>
<span class="sd">            user_id: Owner of the memory.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Memory HRID (Human-readable ID string).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ProcessingError: If validation fails or storage operations fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create and validate memory from YAML schema using our instance</span>
            <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">create_memory_from_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="c1"># Stamp timestamps</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">memory</span><span class="o">.</span><span class="n">created_at</span><span class="p">:</span>
                <span class="n">memory</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">now</span>
            <span class="n">memory</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">now</span>

            <span class="c1"># Generate HRID using tracker</span>
            <span class="n">hrid</span> <span class="o">=</span> <span class="n">generate_hrid</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">)</span>

            <span class="c1"># Get anchor text from YAML-defined anchor field using our instance</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">build_anchor_text</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Empty anchor text for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_memory&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Generate embedding from anchor text</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_embedding</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">)</span>

            <span class="c1"># Use centralized serializer for packing</span>
            <span class="n">flat_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_qdrant_payload</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">hrid</span><span class="p">)</span>
            <span class="n">kuzu_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_kuzu_data</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>

            <span class="c1"># Add to Qdrant (vector storage) with complete payload</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">_point_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span>
                <span class="n">vector</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">flat_payload</span><span class="p">,</span>
                <span class="n">point_id</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to add memory to vector storage&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_memory&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Add to Kuzu (graph storage) - use entity-specific table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">kuzu_data</span><span class="p">)</span>

            <span class="c1"># Create HRID mapping after successful storage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">create_mapping</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">hrid</span>  <span class="c1"># Return HRID, not UUID</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ProcessingError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to add memory&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">payload_updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update memory with partial payload changes (patch-style update).</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Memory HRID to update.</span>
<span class="sd">            payload_updates: Dictionary of fields to update (only changed fields).</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            memory_type: Optional memory type hint (inferred from HRID if not provided).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if update succeeded.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ProcessingError: If update fails or memory not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Infer memory type from HRID if not provided</span>
            <span class="k">if</span> <span class="n">memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Get existing UUID to preserve relationships</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="c1"># Get current memory data from Qdrant to merge with updates</span>
            <span class="n">current_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_point</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Memory not found for HRID </span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Merge current payload with updates</span>
            <span class="n">current_payload</span> <span class="o">=</span> <span class="n">current_point</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="c1"># Remove system fields from current payload to get user fields only</span>
            <span class="n">user_fields</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current_payload</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;hrid&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">}</span>

            <span class="c1"># Merge updates into user fields</span>
            <span class="n">updated_user_payload</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">user_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">payload_updates</span><span class="p">}</span>

            <span class="c1"># Validate merged payload against YAML schema</span>
            <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">create_memory_from_yaml</span><span class="p">(</span>
                <span class="n">memory_type</span><span class="p">,</span> <span class="n">updated_user_payload</span><span class="p">,</span> <span class="n">user_id</span>
            <span class="p">)</span>
            <span class="n">memory</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">uuid</span>  <span class="c1"># Preserve existing UUID for relationships</span>

            <span class="c1"># Update timestamps - preserve created_at, update updated_at</span>
            <span class="n">memory</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">current_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">))</span>
            <span class="n">memory</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

            <span class="c1"># Get anchor text for vector update</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">build_anchor_text</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Empty anchor text for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Generate new embedding from updated anchor text</span>
            <span class="n">vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_embedding</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">)</span>

            <span class="c1"># Use centralized serializer for packing</span>
            <span class="n">flat_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_qdrant_payload</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">hrid</span><span class="p">)</span>
            <span class="n">kuzu_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_kuzu_data</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>

            <span class="c1"># Update Qdrant point (upsert with same UUID)</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">_point_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span>
                <span class="n">vector</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">flat_payload</span><span class="p">,</span>
                <span class="n">point_id</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>  <span class="c1"># Same UUID preserves relationships</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to update memory in vector storage&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Update Kuzu node using efficient update_node method</span>
            <span class="c1"># This preserves relationships and is more efficient than delete+add</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">update_node</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">kuzu_data</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to update memory in graph storage - memory not found&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ProcessingError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to update memory&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a relationship between two memories using HRIDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_memory_hrid: Source memory HRID.</span>
<span class="sd">            to_memory_hrid: Target memory HRID.</span>
<span class="sd">            relation_type: Relationship type from YAML schema (e.g., &#39;ANNOTATES&#39;).</span>
<span class="sd">            from_memory_type: Source memory entity type.</span>
<span class="sd">            to_memory_type: Target memory entity type.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            properties: Optional relationship properties.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ProcessingError: If relationship creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Translate HRIDs to UUIDs</span>
            <span class="n">from_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
            <span class="n">to_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span>
                <span class="n">from_table</span><span class="o">=</span><span class="n">from_memory_type</span><span class="p">,</span>
                <span class="n">to_table</span><span class="o">=</span><span class="n">to_memory_type</span><span class="p">,</span>
                <span class="n">rel_type</span><span class="o">=</span><span class="n">relation_type</span><span class="p">,</span>
                <span class="n">from_id</span><span class="o">=</span><span class="n">from_uuid</span><span class="p">,</span>
                <span class="n">to_id</span><span class="o">=</span><span class="n">to_uuid</span><span class="p">,</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">props</span><span class="o">=</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to add relationship&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_hrid&quot;</span><span class="p">:</span> <span class="n">from_memory_hrid</span><span class="p">,</span>
                    <span class="s2">&quot;to_hrid&quot;</span><span class="p">:</span> <span class="n">to_memory_hrid</span><span class="p">,</span>
                    <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">relation_type</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a relationship between two memories using HRIDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_memory_hrid: Source memory HRID.</span>
<span class="sd">            to_memory_hrid: Target memory HRID.</span>
<span class="sd">            relation_type: Relationship type from YAML schema (e.g., &#39;ANNOTATES&#39;).</span>
<span class="sd">            from_memory_type: Source memory entity type (inferred from HRID if not provided).</span>
<span class="sd">            to_memory_type: Target memory entity type (inferred from HRID if not provided).</span>
<span class="sd">            user_id: User ID for ownership verification (required).</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion succeeded, False if relationship not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ProcessingError: If relationship deletion fails or parameters invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate required user_id</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                    <span class="s2">&quot;user_id is required for relationship deletion&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;from_hrid&quot;</span><span class="p">:</span> <span class="n">from_memory_hrid</span><span class="p">,</span> <span class="s2">&quot;to_hrid&quot;</span><span class="p">:</span> <span class="n">to_memory_hrid</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Infer memory types from HRIDs if not provided</span>
            <span class="k">if</span> <span class="n">from_memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">from_memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">to_memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">to_memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to_memory_hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Translate HRIDs to UUIDs</span>
            <span class="n">from_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
            <span class="n">to_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="c1"># Delete relationship using Kuzu interface</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">delete_relationship</span><span class="p">(</span>
                <span class="n">from_table</span><span class="o">=</span><span class="n">from_memory_type</span><span class="p">,</span>
                <span class="n">to_table</span><span class="o">=</span><span class="n">to_memory_type</span><span class="p">,</span>
                <span class="n">rel_type</span><span class="o">=</span><span class="n">relation_type</span><span class="p">,</span>
                <span class="n">from_id</span><span class="o">=</span><span class="n">from_uuid</span><span class="p">,</span>
                <span class="n">to_id</span><span class="o">=</span><span class="n">to_uuid</span><span class="p">,</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ProcessingError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to delete relationship&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_hrid&quot;</span><span class="p">:</span> <span class="n">from_memory_hrid</span><span class="p">,</span>
                    <span class="s2">&quot;to_hrid&quot;</span><span class="p">:</span> <span class="n">to_memory_hrid</span><span class="p">,</span>
                    <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">relation_type</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a memory from both storages using HRID.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory_hrid: Memory HRID to delete.</span>
<span class="sd">            memory_type: Memory entity type.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion succeeded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Translate HRID to UUID</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="c1"># Delete from Qdrant (with user ownership verification)</span>
            <span class="n">qdrant_success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">delete_points</span><span class="p">([</span><span class="n">uuid</span><span class="p">],</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="c1"># Delete from Kuzu (with user_id verification)</span>
            <span class="n">kuzu_success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

            <span class="c1"># Mark HRID as deleted (soft delete in mapping)</span>
            <span class="k">if</span> <span class="n">qdrant_success</span> <span class="ow">and</span> <span class="n">kuzu_success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">mark_deleted</span><span class="p">(</span><span class="n">memory_hrid</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">qdrant_success</span> <span class="ow">and</span> <span class="n">kuzu_success</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to delete memory&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_hrid&quot;</span><span class="p">:</span> <span class="n">memory_hrid</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemoryService.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize MemoryService with DatabaseClients.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_clients</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DatabaseClients instance (after init_dbs() called).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_clients</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize MemoryService with DatabaseClients.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_clients: DatabaseClients instance (after init_dbs() called).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_clients</span><span class="p">,</span> <span class="n">DatabaseClients</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;db_clients must be a DatabaseClients instance&quot;</span><span class="p">)</span>

    <span class="c1"># Get interfaces from DatabaseClients (reuses DDL-created clients)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_qdrant_interface</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_kuzu_interface</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_embedder</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_yaml_translator</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span> <span class="o">=</span> <span class="n">HridTracker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="p">)</span>

    <span class="c1"># Initialize memory serializer for packing/unpacking</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.retrieval</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemorySerializer</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span> <span class="o">=</span> <span class="n">MemorySerializer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemoryService.add_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_memory</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a memory to both graph and vector storage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type from YAML schema (e.g., 'task', 'note').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory data conforming to YAML schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Owner of the memory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory HRID (Human-readable ID string).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingError (memg_core.core.exceptions.ProcessingError)" href="#memg_core.core.exceptions.ProcessingError">ProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If validation fails or storage operations fail.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a memory to both graph and vector storage.</span>

<span class="sd">    Args:</span>
<span class="sd">        memory_type: Entity type from YAML schema (e.g., &#39;task&#39;, &#39;note&#39;).</span>
<span class="sd">        payload: Memory data conforming to YAML schema.</span>
<span class="sd">        user_id: Owner of the memory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Memory HRID (Human-readable ID string).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ProcessingError: If validation fails or storage operations fail.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create and validate memory from YAML schema using our instance</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">create_memory_from_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="c1"># Stamp timestamps</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">memory</span><span class="o">.</span><span class="n">created_at</span><span class="p">:</span>
            <span class="n">memory</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">now</span>
        <span class="n">memory</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">now</span>

        <span class="c1"># Generate HRID using tracker</span>
        <span class="n">hrid</span> <span class="o">=</span> <span class="n">generate_hrid</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">)</span>

        <span class="c1"># Get anchor text from YAML-defined anchor field using our instance</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">build_anchor_text</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Empty anchor text for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Generate embedding from anchor text</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_embedding</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">)</span>

        <span class="c1"># Use centralized serializer for packing</span>
        <span class="n">flat_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_qdrant_payload</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">hrid</span><span class="p">)</span>
        <span class="n">kuzu_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_kuzu_data</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>

        <span class="c1"># Add to Qdrant (vector storage) with complete payload</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">_point_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span>
            <span class="n">vector</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">flat_payload</span><span class="p">,</span>
            <span class="n">point_id</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to add memory to vector storage&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Add to Kuzu (graph storage) - use entity-specific table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">kuzu_data</span><span class="p">)</span>

        <span class="c1"># Create HRID mapping after successful storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">create_mapping</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hrid</span>  <span class="c1"># Return HRID, not UUID</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ProcessingError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to add memory&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_memory&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemoryService.add_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_relationship</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">,</span> <span class="n">from_memory_type</span><span class="p">,</span> <span class="n">to_memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a relationship between two memories using HRIDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type from YAML schema (e.g., 'ANNOTATES').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional relationship properties.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingError (memg_core.core.exceptions.ProcessingError)" href="#memg_core.core.exceptions.ProcessingError">ProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If relationship creation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a relationship between two memories using HRIDs.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_memory_hrid: Source memory HRID.</span>
<span class="sd">        to_memory_hrid: Target memory HRID.</span>
<span class="sd">        relation_type: Relationship type from YAML schema (e.g., &#39;ANNOTATES&#39;).</span>
<span class="sd">        from_memory_type: Source memory entity type.</span>
<span class="sd">        to_memory_type: Target memory entity type.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        properties: Optional relationship properties.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ProcessingError: If relationship creation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Translate HRIDs to UUIDs</span>
        <span class="n">from_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
        <span class="n">to_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span>
            <span class="n">from_table</span><span class="o">=</span><span class="n">from_memory_type</span><span class="p">,</span>
            <span class="n">to_table</span><span class="o">=</span><span class="n">to_memory_type</span><span class="p">,</span>
            <span class="n">rel_type</span><span class="o">=</span><span class="n">relation_type</span><span class="p">,</span>
            <span class="n">from_id</span><span class="o">=</span><span class="n">from_uuid</span><span class="p">,</span>
            <span class="n">to_id</span><span class="o">=</span><span class="n">to_uuid</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">props</span><span class="o">=</span><span class="n">properties</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to add relationship&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;from_hrid&quot;</span><span class="p">:</span> <span class="n">from_memory_hrid</span><span class="p">,</span>
                <span class="s2">&quot;to_hrid&quot;</span><span class="p">:</span> <span class="n">to_memory_hrid</span><span class="p">,</span>
                <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">relation_type</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemoryService.delete_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_memory</span><span class="p">(</span><span class="n">memory_hrid</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a memory from both storages using HRID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory HRID to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a memory from both storages using HRID.</span>

<span class="sd">    Args:</span>
<span class="sd">        memory_hrid: Memory HRID to delete.</span>
<span class="sd">        memory_type: Memory entity type.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Translate HRID to UUID</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="c1"># Delete from Qdrant (with user ownership verification)</span>
        <span class="n">qdrant_success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">delete_points</span><span class="p">([</span><span class="n">uuid</span><span class="p">],</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="c1"># Delete from Kuzu (with user_id verification)</span>
        <span class="n">kuzu_success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">delete_node</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="c1"># Mark HRID as deleted (soft delete in mapping)</span>
        <span class="k">if</span> <span class="n">qdrant_success</span> <span class="ow">and</span> <span class="n">kuzu_success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">mark_deleted</span><span class="p">(</span><span class="n">memory_hrid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">qdrant_success</span> <span class="ow">and</span> <span class="n">kuzu_success</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to delete memory&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_memory&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_hrid&quot;</span><span class="p">:</span> <span class="n">memory_hrid</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemoryService.delete_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_relationship</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">,</span> <span class="n">from_memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a relationship between two memories using HRIDs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type from YAML schema (e.g., 'ANNOTATES').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory entity type (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory entity type (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification (required).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded, False if relationship not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingError (memg_core.core.exceptions.ProcessingError)" href="#memg_core.core.exceptions.ProcessingError">ProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If relationship deletion fails or parameters invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a relationship between two memories using HRIDs.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_memory_hrid: Source memory HRID.</span>
<span class="sd">        to_memory_hrid: Target memory HRID.</span>
<span class="sd">        relation_type: Relationship type from YAML schema (e.g., &#39;ANNOTATES&#39;).</span>
<span class="sd">        from_memory_type: Source memory entity type (inferred from HRID if not provided).</span>
<span class="sd">        to_memory_type: Target memory entity type (inferred from HRID if not provided).</span>
<span class="sd">        user_id: User ID for ownership verification (required).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded, False if relationship not found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ProcessingError: If relationship deletion fails or parameters invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Validate required user_id</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;user_id is required for relationship deletion&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;from_hrid&quot;</span><span class="p">:</span> <span class="n">from_memory_hrid</span><span class="p">,</span> <span class="s2">&quot;to_hrid&quot;</span><span class="p">:</span> <span class="n">to_memory_hrid</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Infer memory types from HRIDs if not provided</span>
        <span class="k">if</span> <span class="n">from_memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">from_memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">to_memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to_memory_hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Translate HRIDs to UUIDs</span>
        <span class="n">from_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
        <span class="n">to_uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="c1"># Delete relationship using Kuzu interface</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">delete_relationship</span><span class="p">(</span>
            <span class="n">from_table</span><span class="o">=</span><span class="n">from_memory_type</span><span class="p">,</span>
            <span class="n">to_table</span><span class="o">=</span><span class="n">to_memory_type</span><span class="p">,</span>
            <span class="n">rel_type</span><span class="o">=</span><span class="n">relation_type</span><span class="p">,</span>
            <span class="n">from_id</span><span class="o">=</span><span class="n">from_uuid</span><span class="p">,</span>
            <span class="n">to_id</span><span class="o">=</span><span class="n">to_uuid</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ProcessingError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to delete relationship&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;from_hrid&quot;</span><span class="p">:</span> <span class="n">from_memory_hrid</span><span class="p">,</span>
                <span class="s2">&quot;to_hrid&quot;</span><span class="p">:</span> <span class="n">to_memory_hrid</span><span class="p">,</span>
                <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">relation_type</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.MemoryService.update_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">payload_updates</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update memory with partial payload changes (patch-style update).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory HRID to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload_updates</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of fields to update (only changed fields).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if update succeeded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProcessingError (memg_core.core.exceptions.ProcessingError)" href="#memg_core.core.exceptions.ProcessingError">ProcessingError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If update fails or memory not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">payload_updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update memory with partial payload changes (patch-style update).</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Memory HRID to update.</span>
<span class="sd">        payload_updates: Dictionary of fields to update (only changed fields).</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint (inferred from HRID if not provided).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if update succeeded.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ProcessingError: If update fails or memory not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Infer memory type from HRID if not provided</span>
        <span class="k">if</span> <span class="n">memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Get existing UUID to preserve relationships</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="c1"># Get current memory data from Qdrant to merge with updates</span>
        <span class="n">current_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_point</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Memory not found for HRID </span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Merge current payload with updates</span>
        <span class="n">current_payload</span> <span class="o">=</span> <span class="n">current_point</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="c1"># Remove system fields from current payload to get user fields only</span>
        <span class="n">user_fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current_payload</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span>
            <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
                <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hrid&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Merge updates into user fields</span>
        <span class="n">updated_user_payload</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">user_fields</span><span class="p">,</span> <span class="o">**</span><span class="n">payload_updates</span><span class="p">}</span>

        <span class="c1"># Validate merged payload against YAML schema</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">create_memory_from_yaml</span><span class="p">(</span>
            <span class="n">memory_type</span><span class="p">,</span> <span class="n">updated_user_payload</span><span class="p">,</span> <span class="n">user_id</span>
        <span class="p">)</span>
        <span class="n">memory</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">uuid</span>  <span class="c1"># Preserve existing UUID for relationships</span>

        <span class="c1"># Update timestamps - preserve created_at, update updated_at</span>
        <span class="n">memory</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">current_payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">))</span>
        <span class="n">memory</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

        <span class="c1"># Get anchor text for vector update</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">build_anchor_text</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Empty anchor text for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Generate new embedding from updated anchor text</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">get_embedding</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">)</span>

        <span class="c1"># Use centralized serializer for packing</span>
        <span class="n">flat_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_qdrant_payload</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">hrid</span><span class="p">)</span>
        <span class="n">kuzu_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="o">.</span><span class="n">to_kuzu_data</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>

        <span class="c1"># Update Qdrant point (upsert with same UUID)</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">_point_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span>
            <span class="n">vector</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">flat_payload</span><span class="p">,</span>
            <span class="n">point_id</span><span class="o">=</span><span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>  <span class="c1"># Same UUID preserves relationships</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to update memory in vector storage&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">memory</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Update Kuzu node using efficient update_node method</span>
        <span class="c1"># This preserves relationships and is more efficient than delete+add</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">update_node</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">kuzu_data</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to update memory in graph storage - memory not found&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_id&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ProcessingError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">ProcessingError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to update memory&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_memory&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.api.public.SearchResult" class="doc doc-heading">
            <code>SearchResult</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Search result with explicit seed/neighbor separation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.SearchResult.memories">memories</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="MemorySeed (memg_core.core.models.MemorySeed)" href="#memg_core.core.models.MemorySeed">MemorySeed</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of memory seeds with full payloads and relationships.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.SearchResult.neighbors">neighbors</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="MemoryNeighbor (memg_core.core.models.MemoryNeighbor)" href="#memg_core.core.models.MemoryNeighbor">MemoryNeighbor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of memory neighbors with anchor-only payloads.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SearchResult</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search result with explicit seed/neighbor separation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        memories: List of memory seeds with full payloads and relationships.</span>
<span class="sd">        neighbors: List of memory neighbors with anchor-only payloads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">memories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemorySeed</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Memory seeds with full payloads&quot;</span>
    <span class="p">)</span>
    <span class="n">neighbors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemoryNeighbor</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Memory neighbors with anchor payloads&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.api.public.SearchService" class="doc doc-heading">
            <code>SearchService</code>


</h2>


    <div class="doc doc-contents ">


        <p>Search orchestration service - coordinates specialized handlers for GraphRAG operations.</p>
<p>Clean orchestration layer that delegates to specialized handlers:
- VectorSearchHandler: Qdrant vector search and seed generation
- GraphExpansionHandler: Kuzu graph traversal and neighbor expansion
- MemorySerializer: Memory object packing/unpacking and conversion
- PayloadProjector: Payload filtering and projection</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.SearchService.vector_handler">vector_handler</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Handles vector search operations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.SearchService.graph_handler">graph_handler</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Handles graph expansion operations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.SearchService.memory_serializer">memory_serializer</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Handles memory serialization and construction.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.SearchService.payload_projector">payload_projector</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Handles payload projection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/pipelines/retrieval.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SearchService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search orchestration service - coordinates specialized handlers for GraphRAG operations.</span>

<span class="sd">    Clean orchestration layer that delegates to specialized handlers:</span>
<span class="sd">    - VectorSearchHandler: Qdrant vector search and seed generation</span>
<span class="sd">    - GraphExpansionHandler: Kuzu graph traversal and neighbor expansion</span>
<span class="sd">    - MemorySerializer: Memory object packing/unpacking and conversion</span>
<span class="sd">    - PayloadProjector: Payload filtering and projection</span>

<span class="sd">    Attributes:</span>
<span class="sd">        vector_handler: Handles vector search operations.</span>
<span class="sd">        graph_handler: Handles graph expansion operations.</span>
<span class="sd">        memory_serializer: Handles memory serialization and construction.</span>
<span class="sd">        payload_projector: Handles payload projection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_clients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize SearchService with DatabaseClients.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_clients: DatabaseClients instance (after init_dbs() called).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_clients</span><span class="p">,</span> <span class="n">DatabaseClients</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;db_clients must be a DatabaseClients instance&quot;</span><span class="p">)</span>

        <span class="c1"># Get interfaces from DatabaseClients (reuses DDL-created clients)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_qdrant_interface</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_kuzu_interface</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_embedder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_yaml_translator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span> <span class="o">=</span> <span class="n">HridTracker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>

        <span class="c1"># Initialize utility classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span> <span class="o">=</span> <span class="n">MemorySerializer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload_projector</span> <span class="o">=</span> <span class="n">PayloadProjector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>

        <span class="c1"># Initialize handler classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector_handler</span> <span class="o">=</span> <span class="n">VectorSearchHandler</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload_projector</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span> <span class="o">=</span> <span class="n">GraphExpansionHandler</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">payload_projector</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">relation_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">neighbor_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">include_details</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;self&quot;</span><span class="p">,</span>
        <span class="n">modified_within_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">projection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decay_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decay_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GraphRAG search orchestration: vector seeds â†’ graph expansion â†’ result composition.</span>

<span class="sd">        Pure orchestration method that delegates to specialized handlers for clean separation of concerns.</span>

<span class="sd">        Args:</span>
<span class="sd">            query: Search query text (required).</span>
<span class="sd">            user_id: User ID for filtering (required).</span>
<span class="sd">            limit: Maximum results to return (default: 5).</span>
<span class="sd">            memory_type: Optional memory type filter.</span>
<span class="sd">            relation_names: Specific relations to expand (None = all relations).</span>
<span class="sd">            neighbor_limit: Max neighbors per seed (default: 5).</span>
<span class="sd">            hops: Number of graph hops to expand (default: 1).</span>
<span class="sd">            include_details: &quot;self&quot; (full payload) or &quot;none&quot; (anchor only) for seeds.</span>
<span class="sd">            modified_within_days: Filter by recency (e.g., last 7 days).</span>
<span class="sd">            filters: Custom field-based filtering (e.g., {&quot;project&quot;: &quot;memg-core&quot;}).</span>
<span class="sd">            projection: Control which fields to return per memory type.</span>
<span class="sd">            score_threshold: Minimum similarity score threshold (0.0-1.0).</span>
<span class="sd">            decay_rate: Score decay factor per hop (default: 1.0 = no decay).</span>
<span class="sd">            decay_threshold: Explicit neighbor score threshold (overrides decay_rate).</span>

<span class="sd">        Returns:</span>
<span class="sd">            SearchResult: Search result with explicit seed/neighbor separation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Get seeds from vector search using handler</span>
        <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_handler</span><span class="o">.</span><span class="n">search_seeds</span><span class="p">(</span>
            <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">modified_within_days</span><span class="o">=</span><span class="n">modified_within_days</span><span class="p">,</span>
            <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
            <span class="n">include_details</span><span class="o">=</span><span class="n">include_details</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">seeds</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SearchResult</span><span class="p">()</span>

        <span class="c1"># 2. Graph expansion (neighbors with anchor-only payloads)</span>
        <span class="n">neighbors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemoryNeighbor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">hops</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Calculate neighbor filtering threshold</span>
            <span class="n">neighbor_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_neighbor_threshold</span><span class="p">(</span>
                <span class="n">score_threshold</span><span class="p">,</span> <span class="n">decay_rate</span><span class="p">,</span> <span class="n">decay_threshold</span><span class="p">,</span> <span class="n">hops</span>
            <span class="p">)</span>

            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span><span class="o">.</span><span class="n">expand_neighbors</span><span class="p">(</span>
                <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">relation_names</span><span class="o">=</span><span class="n">relation_names</span><span class="p">,</span>
                <span class="n">neighbor_limit</span><span class="o">=</span><span class="n">neighbor_limit</span><span class="p">,</span>
                <span class="n">hops</span><span class="o">=</span><span class="n">hops</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
                <span class="n">neighbor_threshold</span><span class="o">=</span><span class="n">neighbor_threshold</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Compose final SearchResult with seeds and neighbors</span>
        <span class="k">return</span> <span class="n">SearchResult</span><span class="p">(</span>
            <span class="n">memories</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
            <span class="n">neighbors</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_neighbor_threshold</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decay_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">decay_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate neighbor filtering threshold using elegant hierarchy.</span>

<span class="sd">        Args:</span>
<span class="sd">            score_threshold: Minimum similarity score for seeds.</span>
<span class="sd">            decay_rate: Score decay factor per hop (1.0 = no decay).</span>
<span class="sd">            decay_threshold: Explicit neighbor threshold (overrides decay_rate).</span>
<span class="sd">            hops: Number of graph hops.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float | None: Neighbor threshold or None (no filtering).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Most explicit: User specified exact neighbor threshold</span>
        <span class="k">if</span> <span class="n">decay_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">decay_threshold</span>

        <span class="c1"># 2. Dynamic decay: Calculate threshold based on hops</span>
        <span class="k">if</span> <span class="n">score_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">decay_rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">score_threshold</span> <span class="o">*</span> <span class="p">(</span><span class="n">decay_rate</span><span class="o">**</span><span class="n">hops</span><span class="p">)</span>

        <span class="c1"># 3. Conservative default: Same threshold for neighbors as seeds</span>
        <span class="k">if</span> <span class="n">score_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">score_threshold</span>

        <span class="c1"># 4. No filtering</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_memory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">relation_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">neighbor_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a single memory by HRID with optional neighbor expansion.</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Human-readable identifier of the memory.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            memory_type: Optional memory type hint (inferred from HRID if not provided).</span>
<span class="sd">            include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">            hops: Number of hops for neighbor expansion (default 1).</span>
<span class="sd">            relation_types: Filter by specific relationship types (None = all relations).</span>
<span class="sd">            neighbor_limit: Maximum neighbors to return per hop (default 5).</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Infer memory type from HRID if not provided</span>
            <span class="k">if</span> <span class="n">memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Get UUID from HRID</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Get memory data from Qdrant</span>
            <span class="n">point_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">point_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Verify user ownership</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">point_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Build response with full memory information (HRID-only policy - no UUID exposure)</span>
            <span class="n">memory_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">),</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">),</span>
                <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">),</span>
                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span>
                    <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;hrid&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">},</span>
            <span class="p">}</span>

            <span class="c1"># Add neighbor expansion if requested</span>
            <span class="k">if</span> <span class="n">include_neighbors</span> <span class="ow">and</span> <span class="n">hops</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Convert memory to MemorySeed for graph expansion</span>
                <span class="n">created_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span>
                <span class="n">updated_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">)</span>

                <span class="c1"># Parse datetime strings if they exist, otherwise use current time</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">created_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">created_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">updated_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">updated_at</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">updated_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

                <span class="c1"># Create MemorySeed for graph expansion</span>
                <span class="n">memory_seed</span> <span class="o">=</span> <span class="n">MemorySeed</span><span class="p">(</span>
                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                    <span class="n">hrid</span><span class="o">=</span><span class="n">hrid</span><span class="p">,</span>
                    <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;memory_type&quot;</span><span class="p">],</span>
                    <span class="n">created_at</span><span class="o">=</span><span class="n">created_at</span><span class="p">,</span>
                    <span class="n">updated_at</span><span class="o">=</span><span class="n">updated_at</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">],</span>
                    <span class="n">score</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Not from vector search, so use 1.0</span>
                    <span class="n">relationships</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Will be populated by graph expansion</span>
                <span class="p">)</span>

                <span class="c1"># Use graph handler to expand neighbors</span>
                <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span><span class="o">.</span><span class="n">expand_neighbors</span><span class="p">(</span>
                    <span class="n">seeds</span><span class="o">=</span><span class="p">[</span><span class="n">memory_seed</span><span class="p">],</span>
                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                    <span class="n">relation_names</span><span class="o">=</span><span class="n">relation_types</span><span class="p">,</span>
                    <span class="n">neighbor_limit</span><span class="o">=</span><span class="n">neighbor_limit</span><span class="p">,</span>
                    <span class="n">hops</span><span class="o">=</span><span class="n">hops</span><span class="p">,</span>
                    <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># No projection needed for get_memory</span>
                    <span class="n">neighbor_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># No threshold filtering</span>
                <span class="p">)</span>

                <span class="c1"># Add neighbors and relationships to response</span>
                <span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;neighbors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">hrid</span><span class="p">,</span>
                        <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">memory_type</span><span class="p">,</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">created_at</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">updated_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">updated_at</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>  <span class="c1"># Already projected to anchor-only</span>
                        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors</span>
                <span class="p">]</span>

                <span class="c1"># Add relationships from the seed (populated by expand_neighbors)</span>
                <span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">relation_type</span><span class="p">,</span>
                        <span class="s2">&quot;target_hrid&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">target_hrid</span><span class="p">,</span>
                        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                        <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">nested_rel</span><span class="o">.</span><span class="n">relation_type</span><span class="p">,</span>
                                <span class="s2">&quot;target_hrid&quot;</span><span class="p">:</span> <span class="n">nested_rel</span><span class="o">.</span><span class="n">target_hrid</span><span class="p">,</span>
                                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">nested_rel</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                            <span class="p">}</span>
                            <span class="k">for</span> <span class="n">nested_rel</span> <span class="ow">in</span> <span class="n">rel</span><span class="o">.</span><span class="n">relationships</span>
                        <span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">memory_seed</span><span class="o">.</span><span class="n">relationships</span>
                <span class="p">]</span>

            <span class="k">return</span> <span class="n">memory_data</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_memories</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get multiple memories with filtering and optional graph expansion.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            memory_type: Optional memory type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">            filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;, &quot;priority&quot;: &quot;high&quot;}).</span>
<span class="sd">            limit: Maximum number of memories to return (default 50).</span>
<span class="sd">            offset: Number of memories to skip for pagination (default 0).</span>
<span class="sd">            include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">            hops: Number of hops for neighbor expansion (default 1).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of memory data with full payloads.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use KuzuInterface to get nodes with filtering</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">node_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
                <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Convert Kuzu results directly to memory data</span>
            <span class="n">memories</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">node_data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="p">{})</span>

                <span class="c1"># Get HRID from UUID</span>
                <span class="n">uuid</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="n">hrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_hrid</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">uuid</span> <span class="k">else</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">hrid</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Filter out UUID fields from payload (consumers should only see HRIDs)</span>
                <span class="n">filtered_payload</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">node_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;_id&quot;</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">]</span>
                <span class="p">}</span>

                <span class="c1"># Build memory data directly</span>
                <span class="n">memory_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                    <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">filtered_payload</span><span class="p">,</span>
                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Not from vector search</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;kuzu_query&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query_type&quot;</span><span class="p">:</span> <span class="s2">&quot;get_memories&quot;</span><span class="p">},</span>
                <span class="p">}</span>

                <span class="n">memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_data</span><span class="p">)</span>

            <span class="c1"># Apply graph expansion if requested</span>
            <span class="k">if</span> <span class="n">include_neighbors</span> <span class="ow">and</span> <span class="n">memories</span><span class="p">:</span>
                <span class="c1"># Convert to MemorySeed objects for graph expansion</span>
                <span class="n">memory_seeds</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">memory_data</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
                    <span class="c1"># Create MemorySeed directly from memory_data</span>
                    <span class="n">hrid</span> <span class="o">=</span> <span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;hrid&quot;</span><span class="p">]</span>

                    <span class="c1"># Create MemorySeed</span>
                    <span class="n">created_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span>
                    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">)</span>

                    <span class="c1"># Parse datetime strings if they exist, otherwise use current time</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">created_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">created_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">updated_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">updated_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">updated_at</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">updated_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

                    <span class="n">seed</span> <span class="o">=</span> <span class="n">MemorySeed</span><span class="p">(</span>
                        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                        <span class="n">hrid</span><span class="o">=</span><span class="n">hrid</span><span class="p">,</span>
                        <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;memory_type&quot;</span><span class="p">],</span>
                        <span class="n">created_at</span><span class="o">=</span><span class="n">created_at</span><span class="p">,</span>
                        <span class="n">updated_at</span><span class="o">=</span><span class="n">updated_at</span><span class="p">,</span>
                        <span class="n">payload</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">],</span>
                        <span class="n">score</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
                        <span class="n">relationships</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Will be populated by graph expansion</span>
                    <span class="p">)</span>
                    <span class="n">memory_seeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

                <span class="c1"># Apply graph expansion using the graph handler</span>
                <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span><span class="o">.</span><span class="n">expand_neighbors</span><span class="p">(</span>
                    <span class="n">seeds</span><span class="o">=</span><span class="n">memory_seeds</span><span class="p">,</span>
                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                    <span class="n">relation_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># All relations</span>
                    <span class="n">neighbor_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Default limit</span>
                    <span class="n">hops</span><span class="o">=</span><span class="n">hops</span><span class="p">,</span>
                    <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Create SearchResult to maintain consistency</span>
                <span class="n">expanded_result</span> <span class="o">=</span> <span class="n">SearchResult</span><span class="p">(</span>
                    <span class="n">memories</span><span class="o">=</span><span class="n">memory_seeds</span><span class="p">,</span>
                    <span class="n">neighbors</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Convert back to dict format for API compatibility</span>
                <span class="n">expanded_memories</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">expanded_result</span><span class="o">.</span><span class="n">memories</span><span class="p">:</span>
                    <span class="n">memory_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">hrid</span><span class="p">,</span>
                        <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">memory_type</span><span class="p">,</span>
                        <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>  <span class="c1"># Use the user_id parameter</span>
                        <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Not available in MemorySeed</span>
                        <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Not available in MemorySeed</span>
                        <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
                        <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;kuzu_query_expanded&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query_type&quot;</span><span class="p">:</span> <span class="s2">&quot;get_memories_expanded&quot;</span><span class="p">},</span>
                        <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">relation_type</span><span class="p">,</span>
                                <span class="s2">&quot;target_hrid&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">target_hrid</span><span class="p">,</span>
                                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                            <span class="p">}</span>
                            <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">seed</span><span class="o">.</span><span class="n">relationships</span>
                        <span class="p">],</span>
                    <span class="p">}</span>
                    <span class="n">expanded_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_data</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">expanded_memories</span>

            <span class="k">return</span> <span class="n">memories</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Log the error instead of silently failing</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_memories() failed: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.SearchService.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize SearchService with DatabaseClients.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_clients</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DatabaseClients instance (after init_dbs() called).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_clients</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize SearchService with DatabaseClients.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_clients: DatabaseClients instance (after init_dbs() called).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">db_clients</span><span class="p">,</span> <span class="n">DatabaseClients</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;db_clients must be a DatabaseClients instance&quot;</span><span class="p">)</span>

    <span class="c1"># Get interfaces from DatabaseClients (reuses DDL-created clients)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_qdrant_interface</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_kuzu_interface</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_embedder</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">db_clients</span><span class="o">.</span><span class="n">get_yaml_translator</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span> <span class="o">=</span> <span class="n">HridTracker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>

    <span class="c1"># Initialize utility classes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span> <span class="o">=</span> <span class="n">MemorySerializer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">payload_projector</span> <span class="o">=</span> <span class="n">PayloadProjector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>

    <span class="c1"># Initialize handler classes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vector_handler</span> <span class="o">=</span> <span class="n">VectorSearchHandler</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">payload_projector</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span> <span class="o">=</span> <span class="n">GraphExpansionHandler</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memory_serializer</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payload_projector</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.SearchService.get_memories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_memories</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get multiple memories with filtering and optional graph expansion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type filter (e.g., "task", "note").</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional field filters (e.g., {"status": "open", "priority": "high"}).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of memories to return (default 50).</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of memories to skip for pagination (default 0).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_neighbors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include neighbor nodes via graph traversal.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hops</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of hops for neighbor expansion (default 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of memory data with full payloads.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_memories</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get multiple memories with filtering and optional graph expansion.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">        filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;, &quot;priority&quot;: &quot;high&quot;}).</span>
<span class="sd">        limit: Maximum number of memories to return (default 50).</span>
<span class="sd">        offset: Number of memories to skip for pagination (default 0).</span>
<span class="sd">        include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">        hops: Number of hops for neighbor expansion (default 1).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of memory data with full payloads.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use KuzuInterface to get nodes with filtering</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">(</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">node_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Convert Kuzu results directly to memory data</span>
        <span class="n">memories</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">node_data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="p">{})</span>

            <span class="c1"># Get HRID from UUID</span>
            <span class="n">uuid</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="n">hrid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_hrid</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">uuid</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hrid</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Filter out UUID fields from payload (consumers should only see HRIDs)</span>
            <span class="n">filtered_payload</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">node_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;_id&quot;</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">]</span>
            <span class="p">}</span>

            <span class="c1"># Build memory data directly</span>
            <span class="n">memory_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">),</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">),</span>
                <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">),</span>
                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">filtered_payload</span><span class="p">,</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Not from vector search</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;kuzu_query&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query_type&quot;</span><span class="p">:</span> <span class="s2">&quot;get_memories&quot;</span><span class="p">},</span>
            <span class="p">}</span>

            <span class="n">memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_data</span><span class="p">)</span>

        <span class="c1"># Apply graph expansion if requested</span>
        <span class="k">if</span> <span class="n">include_neighbors</span> <span class="ow">and</span> <span class="n">memories</span><span class="p">:</span>
            <span class="c1"># Convert to MemorySeed objects for graph expansion</span>
            <span class="n">memory_seeds</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">memory_data</span> <span class="ow">in</span> <span class="n">memories</span><span class="p">:</span>
                <span class="c1"># Create MemorySeed directly from memory_data</span>
                <span class="n">hrid</span> <span class="o">=</span> <span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;hrid&quot;</span><span class="p">]</span>

                <span class="c1"># Create MemorySeed</span>
                <span class="n">created_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span>
                <span class="n">updated_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">)</span>

                <span class="c1"># Parse datetime strings if they exist, otherwise use current time</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">created_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">created_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">updated_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">updated_at</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">updated_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

                <span class="n">seed</span> <span class="o">=</span> <span class="n">MemorySeed</span><span class="p">(</span>
                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                    <span class="n">hrid</span><span class="o">=</span><span class="n">hrid</span><span class="p">,</span>
                    <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;memory_type&quot;</span><span class="p">],</span>
                    <span class="n">created_at</span><span class="o">=</span><span class="n">created_at</span><span class="p">,</span>
                    <span class="n">updated_at</span><span class="o">=</span><span class="n">updated_at</span><span class="p">,</span>
                    <span class="n">payload</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">],</span>
                    <span class="n">score</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
                    <span class="n">relationships</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Will be populated by graph expansion</span>
                <span class="p">)</span>
                <span class="n">memory_seeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

            <span class="c1"># Apply graph expansion using the graph handler</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span><span class="o">.</span><span class="n">expand_neighbors</span><span class="p">(</span>
                <span class="n">seeds</span><span class="o">=</span><span class="n">memory_seeds</span><span class="p">,</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">relation_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># All relations</span>
                <span class="n">neighbor_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Default limit</span>
                <span class="n">hops</span><span class="o">=</span><span class="n">hops</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Create SearchResult to maintain consistency</span>
            <span class="n">expanded_result</span> <span class="o">=</span> <span class="n">SearchResult</span><span class="p">(</span>
                <span class="n">memories</span><span class="o">=</span><span class="n">memory_seeds</span><span class="p">,</span>
                <span class="n">neighbors</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Convert back to dict format for API compatibility</span>
            <span class="n">expanded_memories</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">expanded_result</span><span class="o">.</span><span class="n">memories</span><span class="p">:</span>
                <span class="n">memory_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">hrid</span><span class="p">,</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>  <span class="c1"># Use the user_id parameter</span>
                    <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Not available in MemorySeed</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Not available in MemorySeed</span>
                    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;kuzu_query_expanded&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query_type&quot;</span><span class="p">:</span> <span class="s2">&quot;get_memories_expanded&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">relation_type</span><span class="p">,</span>
                            <span class="s2">&quot;target_hrid&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">target_hrid</span><span class="p">,</span>
                            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">seed</span><span class="o">.</span><span class="n">relationships</span>
                    <span class="p">],</span>
                <span class="p">}</span>
                <span class="n">expanded_memories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">memory_data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">expanded_memories</span>

        <span class="k">return</span> <span class="n">memories</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Log the error instead of silently failing</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;get_memories() failed: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.SearchService.get_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relation_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neighbor_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single memory by HRID with optional neighbor expansion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier of the memory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_neighbors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include neighbor nodes via graph traversal.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hops</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of hops for neighbor expansion (default 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_types</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by specific relationship types (None = all relations).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum neighbors to return per hop (default 5).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_memory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">relation_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">neighbor_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a single memory by HRID with optional neighbor expansion.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable identifier of the memory.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint (inferred from HRID if not provided).</span>
<span class="sd">        include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">        hops: Number of hops for neighbor expansion (default 1).</span>
<span class="sd">        relation_types: Filter by specific relationship types (None = all relations).</span>
<span class="sd">        neighbor_limit: Maximum neighbors to return per hop (default 5).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Infer memory type from HRID if not provided</span>
        <span class="k">if</span> <span class="n">memory_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">memory_type</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Get UUID from HRID</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_uuid</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">uuid</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Get memory data from Qdrant</span>
        <span class="n">point_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">point_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Verify user ownership</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">point_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Build response with full memory information (HRID-only policy - no UUID exposure)</span>
        <span class="n">memory_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span>
            <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">),</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">),</span>
            <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">),</span>
            <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;hrid&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># Add neighbor expansion if requested</span>
        <span class="k">if</span> <span class="n">include_neighbors</span> <span class="ow">and</span> <span class="n">hops</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Convert memory to MemorySeed for graph expansion</span>
            <span class="n">created_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span>
            <span class="n">updated_at</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;updated_at&quot;</span><span class="p">)</span>

            <span class="c1"># Parse datetime strings if they exist, otherwise use current time</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">created_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">created_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">updated_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">updated_at</span> <span class="o">=</span> <span class="n">_parse_datetime</span><span class="p">(</span><span class="n">updated_at</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">updated_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span>

            <span class="c1"># Create MemorySeed for graph expansion</span>
            <span class="n">memory_seed</span> <span class="o">=</span> <span class="n">MemorySeed</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">hrid</span><span class="o">=</span><span class="n">hrid</span><span class="p">,</span>
                <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;memory_type&quot;</span><span class="p">],</span>
                <span class="n">created_at</span><span class="o">=</span><span class="n">created_at</span><span class="p">,</span>
                <span class="n">updated_at</span><span class="o">=</span><span class="n">updated_at</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;payload&quot;</span><span class="p">],</span>
                <span class="n">score</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Not from vector search, so use 1.0</span>
                <span class="n">relationships</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Will be populated by graph expansion</span>
            <span class="p">)</span>

            <span class="c1"># Use graph handler to expand neighbors</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span><span class="o">.</span><span class="n">expand_neighbors</span><span class="p">(</span>
                <span class="n">seeds</span><span class="o">=</span><span class="p">[</span><span class="n">memory_seed</span><span class="p">],</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">relation_names</span><span class="o">=</span><span class="n">relation_types</span><span class="p">,</span>
                <span class="n">neighbor_limit</span><span class="o">=</span><span class="n">neighbor_limit</span><span class="p">,</span>
                <span class="n">hops</span><span class="o">=</span><span class="n">hops</span><span class="p">,</span>
                <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># No projection needed for get_memory</span>
                <span class="n">neighbor_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># No threshold filtering</span>
            <span class="p">)</span>

            <span class="c1"># Add neighbors and relationships to response</span>
            <span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;neighbors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">hrid</span><span class="p">,</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">created_at</span>
                    <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;updated_at&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">updated_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">updated_at</span>
                    <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>  <span class="c1"># Already projected to anchor-only</span>
                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors</span>
            <span class="p">]</span>

            <span class="c1"># Add relationships from the seed (populated by expand_neighbors)</span>
            <span class="n">memory_data</span><span class="p">[</span><span class="s2">&quot;relationships&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">relation_type</span><span class="p">,</span>
                    <span class="s2">&quot;target_hrid&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">target_hrid</span><span class="p">,</span>
                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">rel</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                    <span class="s2">&quot;relationships&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;relation_type&quot;</span><span class="p">:</span> <span class="n">nested_rel</span><span class="o">.</span><span class="n">relation_type</span><span class="p">,</span>
                            <span class="s2">&quot;target_hrid&quot;</span><span class="p">:</span> <span class="n">nested_rel</span><span class="o">.</span><span class="n">target_hrid</span><span class="p">,</span>
                            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">nested_rel</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">nested_rel</span> <span class="ow">in</span> <span class="n">rel</span><span class="o">.</span><span class="n">relationships</span>
                    <span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">rel</span> <span class="ow">in</span> <span class="n">memory_seed</span><span class="o">.</span><span class="n">relationships</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">memory_data</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.SearchService.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">relation_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neighbor_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">include_details</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">modified_within_days</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decay_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>GraphRAG search orchestration: vector seeds â†’ graph expansion â†’ result composition.</p>
<p>Pure orchestration method that delegates to specialized handlers for clean separation of concerns.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search query text (required).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for filtering (required).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum results to return (default: 5).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type filter.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_names</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specific relations to expand (None = all relations).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Max neighbors per seed (default: 5).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hops</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of graph hops to expand (default: 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_details</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"self" (full payload) or "none" (anchor only) for seeds.</p>
              </div>
            </td>
            <td>
                  <code>&#39;self&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modified_within_days</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by recency (e.g., last 7 days).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Custom field-based filtering (e.g., {"project": "memg-core"}).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>projection</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="str">str</span>]] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Control which fields to return per memory type.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity score threshold (0.0-1.0).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decay_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Score decay factor per hop (default: 1.0 = no decay).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decay_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Explicit neighbor score threshold (overrides decay_rate).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SearchResult</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="SearchResult (memg_core.core.models.SearchResult)" href="#memg_core.core.models.SearchResult">SearchResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search result with explicit seed/neighbor separation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">relation_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">neighbor_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">include_details</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;self&quot;</span><span class="p">,</span>
    <span class="n">modified_within_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">projection</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decay_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decay_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GraphRAG search orchestration: vector seeds â†’ graph expansion â†’ result composition.</span>

<span class="sd">    Pure orchestration method that delegates to specialized handlers for clean separation of concerns.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Search query text (required).</span>
<span class="sd">        user_id: User ID for filtering (required).</span>
<span class="sd">        limit: Maximum results to return (default: 5).</span>
<span class="sd">        memory_type: Optional memory type filter.</span>
<span class="sd">        relation_names: Specific relations to expand (None = all relations).</span>
<span class="sd">        neighbor_limit: Max neighbors per seed (default: 5).</span>
<span class="sd">        hops: Number of graph hops to expand (default: 1).</span>
<span class="sd">        include_details: &quot;self&quot; (full payload) or &quot;none&quot; (anchor only) for seeds.</span>
<span class="sd">        modified_within_days: Filter by recency (e.g., last 7 days).</span>
<span class="sd">        filters: Custom field-based filtering (e.g., {&quot;project&quot;: &quot;memg-core&quot;}).</span>
<span class="sd">        projection: Control which fields to return per memory type.</span>
<span class="sd">        score_threshold: Minimum similarity score threshold (0.0-1.0).</span>
<span class="sd">        decay_rate: Score decay factor per hop (default: 1.0 = no decay).</span>
<span class="sd">        decay_threshold: Explicit neighbor score threshold (overrides decay_rate).</span>

<span class="sd">    Returns:</span>
<span class="sd">        SearchResult: Search result with explicit seed/neighbor separation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. Get seeds from vector search using handler</span>
    <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_handler</span><span class="o">.</span><span class="n">search_seeds</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
        <span class="n">modified_within_days</span><span class="o">=</span><span class="n">modified_within_days</span><span class="p">,</span>
        <span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
        <span class="n">include_details</span><span class="o">=</span><span class="n">include_details</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">seeds</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SearchResult</span><span class="p">()</span>

    <span class="c1"># 2. Graph expansion (neighbors with anchor-only payloads)</span>
    <span class="n">neighbors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemoryNeighbor</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">hops</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Calculate neighbor filtering threshold</span>
        <span class="n">neighbor_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_neighbor_threshold</span><span class="p">(</span>
            <span class="n">score_threshold</span><span class="p">,</span> <span class="n">decay_rate</span><span class="p">,</span> <span class="n">decay_threshold</span><span class="p">,</span> <span class="n">hops</span>
        <span class="p">)</span>

        <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_handler</span><span class="o">.</span><span class="n">expand_neighbors</span><span class="p">(</span>
            <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">relation_names</span><span class="o">=</span><span class="n">relation_names</span><span class="p">,</span>
            <span class="n">neighbor_limit</span><span class="o">=</span><span class="n">neighbor_limit</span><span class="p">,</span>
            <span class="n">hops</span><span class="o">=</span><span class="n">hops</span><span class="p">,</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
            <span class="n">neighbor_threshold</span><span class="o">=</span><span class="n">neighbor_threshold</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Compose final SearchResult with seeds and neighbors</span>
    <span class="k">return</span> <span class="n">SearchResult</span><span class="p">(</span>
        <span class="n">memories</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
        <span class="n">neighbors</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.api.public.YamlTranslator" class="doc doc-heading">
            <code>YamlTranslator</code>


</h2>


    <div class="doc doc-contents ">


        <p>Translates YAML schema definitions to Pydantic models for strict validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.YamlTranslator.yaml_path">yaml_path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.api.public.YamlTranslator._schema">_schema</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cached schema dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">YamlTranslator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translates YAML schema definitions to Pydantic models for strict validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        yaml_path: Path to YAML schema file.</span>
<span class="sd">        _schema: Cached schema dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize YamlTranslator with YAML schema path.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml_path: Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If YAML path not provided or TypeRegistry initialization fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Require explicit YAML path - no silent defaults</span>
        <span class="k">if</span> <span class="n">yaml_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">yaml_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_SCHEMA&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">env_path</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                    <span class="s2">&quot;YAML schema path required. Set MEMG_YAML_SCHEMA environment variable &quot;</span>
                    <span class="s2">&quot;or provide yaml_path parameter. No defaults allowed.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">env_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># NO model cache - TypeRegistry handles all caching</span>

        <span class="c1"># Initialize TypeRegistry from YAML - crash early if invalid</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">initialize_types_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize TypeRegistry from YAML: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the loaded YAML schema, loading it if necessary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

        <span class="c1"># Load schema from the required path - no fallbacks</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;YAML schema path not set. This should not happen after __init__.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_schema</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load schema from the current yaml_path.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;YAML path is None&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;YAML schema not found at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty YAML schema&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;YAML schema root must be a mapping&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid YAML syntax: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_entities_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">sch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="n">ents</span> <span class="o">=</span> <span class="n">sch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ents</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ents</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Normalize keys to lower</span>
            <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ents</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># list form</span>
        <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ents</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of available entity types from YAML schema.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># ================== RELATIONSHIP PARSING (TARGET-FIRST FORMAT) ==================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_relations_mapping_for_entity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return raw relations mapping for an entity in target-first schema format.</span>

<span class="sd">        The expected YAML shape under an entity is:</span>
<span class="sd">            relations:</span>
<span class="sd">              target_entity_name:</span>
<span class="sd">                - name: ...</span>
<span class="sd">                  description: ...</span>
<span class="sd">                  predicate: PREDICATE_NAME</span>
<span class="sd">                  directed: true|false</span>

<span class="sd">        Returns an empty dict when no relations are defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
        <span class="n">relations_section</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relations&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_section</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">relations_section</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Normalize keys to lower for targets; keep items as-is</span>
        <span class="n">normalized</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_section</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># Skip invalid shapes silently at this layer; validation is higher-level</span>
                <span class="k">continue</span>
            <span class="n">normalized</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">normalized</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_relations_for_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get normalized relation specs for a source entity in target-first schema.</span>

<span class="sd">        Returns list of dicts with keys:</span>
<span class="sd">            - source (str)</span>
<span class="sd">            - target (str)</span>
<span class="sd">            - name (str | None)</span>
<span class="sd">            - description (str | None)</span>
<span class="sd">            - predicate (str)</span>
<span class="sd">            - directed (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

        <span class="n">source_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">relations_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_relations_mapping_for_entity</span><span class="p">(</span><span class="n">source_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">out</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target_l</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">predicate</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># Skip invalid entries - strict behavior can be added later</span>
                    <span class="k">continue</span>
                <span class="n">directed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_l</span><span class="p">,</span>
                        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target_l</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                        <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">directed</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relationship_table_name</span><span class="p">(</span>
        <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># noqa: unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate relationship table name.</span>

<span class="sd">        For now, table name does not encode direction; direction affects creation/query semantics.</span>
<span class="sd">        Canonicalization for undirected pairs can be added here later if decided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_labels_for_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expand predicate names to concrete relationship labels for a given source.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_type: Source entity type name</span>
<span class="sd">            predicates: List of predicate names to include (case-insensitive). If None, include all.</span>
<span class="sd">            neighbor_label: Optional target entity type filter (case-insensitive)</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of concrete relationship labels (table names) matching the filter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty source_type&quot;</span><span class="p">)</span>

        <span class="n">preds_u</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicates</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">neighbor_l</span> <span class="o">=</span> <span class="n">neighbor_label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source_type</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">preds_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preds_u</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">neighbor_l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">neighbor_l</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                    <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                    <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">debug_relation_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a nested relation map for debugging/printing.</span>

<span class="sd">        Structure:</span>
<span class="sd">        {</span>
<span class="sd">          source: {</span>
<span class="sd">            target: [ {name, predicate, directed, description} ... ]</span>
<span class="sd">          }</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
            <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">specs</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_anchor_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the anchor field name for the given entity type from YAML schema.</span>

<span class="sd">        Now reads from vector.anchored_to instead of separate anchor field.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_name: Name of the entity type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Anchor field name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If anchor field not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

        <span class="c1"># Get entity spec with inheritance resolution</span>
        <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

        <span class="c1"># Look for vector field with anchored_to</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">_field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">anchored_to</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anchored_to&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">anchored_to</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">anchored_to</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; has no vector field with &#39;anchored_to&#39; property&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve entity specification with full inheritance chain.&quot;&quot;&quot;</span>
        <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

        <span class="c1"># If no parent, return as-is</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parent_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spec_raw</span>

        <span class="c1"># Recursively resolve parent and merge fields</span>
        <span class="n">parent_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">parent_name</span><span class="p">)</span>

        <span class="c1"># Merge parent fields with child fields (child overrides parent)</span>
        <span class="n">merged_fields</span> <span class="o">=</span> <span class="n">parent_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">merged_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{}))</span>

        <span class="c1"># Create merged spec</span>
        <span class="n">merged_spec</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">merged_spec</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_fields</span>

        <span class="k">return</span> <span class="n">merged_spec</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_see_also_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the see_also configuration for the given entity type from YAML schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict with keys: enabled, threshold, limit, target_types</span>
<span class="sd">            None if see_also is not configured for this entity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>
        <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

        <span class="n">see_also</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;see_also&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">see_also</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Validate required fields</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)),</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="s2">&quot;target_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_types&quot;</span><span class="p">,</span> <span class="p">[])),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_anchor_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build anchor text for embedding from YAML-defined anchor field.</span>

<span class="sd">        NO hardcoded field names - reads anchor field from YAML schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory: Memory object containing payload data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Anchor text for embedding.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If anchor field is missing or invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mem_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mem_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;Memory object missing &#39;memory_type&#39; field&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Get anchor field from YAML schema</span>
        <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">mem_type</span><span class="p">)</span>

        <span class="c1"># Try to get anchor text from the specified field</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># First check if it&#39;s a core field on the Memory object</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">):</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Otherwise check in the payload</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">stripped_text</span> <span class="o">=</span> <span class="n">anchor_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped_text</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stripped_text</span>

        <span class="c1"># Anchor field missing, empty, or invalid</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; is missing, empty, or invalid &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">mem_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">mem_type</span><span class="p">,</span>
                <span class="s2">&quot;anchor_field&quot;</span><span class="p">:</span> <span class="n">anchor_field</span><span class="p">,</span>
                <span class="s2">&quot;anchor_value&quot;</span><span class="p">:</span> <span class="n">anchor_text</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fields_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract required and optional fields from entity specification.</span>

<span class="sd">        Supports either:</span>
<span class="sd">        - fields: {required:[...], optional:[...]} format</span>
<span class="sd">        - Individual field definitions with required flags</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[list[str], list[str]]: (required_fields, optional_fields)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># supports either fields: {required:[...], optional:[...]} OR flat dict</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;required&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">or</span> <span class="s2">&quot;optional&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optional&quot;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="k">return</span> <span class="n">req</span><span class="p">,</span> <span class="n">opt</span>

        <span class="c1"># Resolve all fields including inherited ones</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="c1"># Parse individual field definitions for required flag</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">optional_fields</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">all_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="c1"># Skip system fields - they&#39;re handled by the system</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">required_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">optional_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">optional_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">required_fields</span><span class="p">,</span> <span class="n">optional_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_inherited_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve all fields including inherited ones from parent entities.</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Dictionary containing all fields (inherited + current).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">entities_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>

        <span class="c1"># If entity has a parent, resolve parent fields first</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent_name</span><span class="p">:</span>
            <span class="n">parent_spec</span> <span class="o">=</span> <span class="n">entities_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">parent_spec</span><span class="p">:</span>
                <span class="c1"># Recursively resolve parent fields</span>
                <span class="n">parent_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">parent_spec</span><span class="p">)</span>
                <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parent_fields</span><span class="p">)</span>

        <span class="c1"># Add/override with current entity&#39;s fields</span>
        <span class="n">current_fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_fields</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_system_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract system fields from YAML schema (fields marked with system: true).</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: Set of field names that are marked as system fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">all_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">system_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">system_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_enum_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate enum fields against YAML schema choices.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory_type: Entity type from YAML schema.</span>
<span class="sd">            payload: Memory data to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If enum field has invalid value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Entity validation happens elsewhere</span>

        <span class="c1"># Get field definitions for this entity type</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check each field in the payload</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">field_def</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>

                <span class="c1"># Check if this is an enum field</span>
                <span class="k">if</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;enum&quot;</span><span class="p">:</span>
                    <span class="n">choices</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> <span class="p">[])</span>

                    <span class="c1"># Validate the value against choices</span>
                    <span class="k">if</span> <span class="n">field_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">field_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2"> value &#39;</span><span class="si">{</span><span class="n">field_value</span><span class="si">}</span><span class="s2">&#39;. Valid choices: </span><span class="si">{</span><span class="n">choices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                                <span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span>
                                <span class="s2">&quot;invalid_value&quot;</span><span class="p">:</span> <span class="n">field_value</span><span class="p">,</span>
                                <span class="s2">&quot;valid_choices&quot;</span><span class="p">:</span> <span class="n">choices</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_memory_against_yaml</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate memory payload against YAML schema and return cleaned payload.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;memory_type is required&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;payload is required&quot;</span><span class="p">)</span>

        <span class="c1"># Strict validation - entity type MUST exist in YAML</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown entity type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;. All types must be defined in YAML schema.&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;available_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">emap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">req</span><span class="p">,</span> <span class="n">_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Validate enum fields against YAML schema choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_enum_fields</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

        <span class="c1"># Validate that all fields are defined in YAML schema</span>
        <span class="n">req</span><span class="p">,</span> <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">valid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">req</span> <span class="o">+</span> <span class="n">opt</span><span class="p">)</span>
        <span class="n">system_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_system_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">invalid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">valid_fields</span> <span class="o">-</span> <span class="n">system_fields</span>
        <span class="k">if</span> <span class="n">invalid_fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid fields not defined in schema: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;valid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">valid_fields</span><span class="p">),</span>
                    <span class="s2">&quot;invalid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Strip system-reserved fields if present</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">syskey</span> <span class="ow">in</span> <span class="n">system_fields</span><span class="p">:</span>
            <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">syskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cleaned</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_memory_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Memory object from YAML-validated payload.&quot;&quot;&quot;</span>

        <span class="c1"># Get anchor field from YAML schema</span>
        <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">memory_type</span><span class="p">)</span>

        <span class="c1"># Extract anchor text from payload</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing or invalid anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; in payload &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Validate full payload against YAML schema</span>
        <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

        <span class="c1"># Construct Memory with YAML-defined payload only</span>
        <span class="k">return</span> <span class="n">Memory</span><span class="p">(</span>
            <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">validated_payload</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Pydantic model from TypeRegistry - NO REDUNDANCY.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="memg_core.api.public.YamlTranslator.schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">schema</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the loaded YAML schema, loading it if necessary.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">yaml_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize YamlTranslator with YAML schema path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>yaml_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If YAML path not provided or TypeRegistry initialization fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize YamlTranslator with YAML schema path.</span>

<span class="sd">    Args:</span>
<span class="sd">        yaml_path: Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If YAML path not provided or TypeRegistry initialization fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Require explicit YAML path - no silent defaults</span>
    <span class="k">if</span> <span class="n">yaml_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">yaml_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_SCHEMA&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;YAML schema path required. Set MEMG_YAML_SCHEMA environment variable &quot;</span>
                <span class="s2">&quot;or provide yaml_path parameter. No defaults allowed.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">env_path</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># NO model cache - TypeRegistry handles all caching</span>

    <span class="c1"># Initialize TypeRegistry from YAML - crash early if invalid</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">initialize_types_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize TypeRegistry from YAML: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.build_anchor_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_anchor_text</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Build anchor text for embedding from YAML-defined anchor field.</p>
<p>NO hardcoded field names - reads anchor field from YAML schema.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory object containing payload data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anchor text for embedding.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If anchor field is missing or invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_anchor_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build anchor text for embedding from YAML-defined anchor field.</span>

<span class="sd">    NO hardcoded field names - reads anchor field from YAML schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        memory: Memory object containing payload data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Anchor text for embedding.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If anchor field is missing or invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mem_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mem_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="s2">&quot;Memory object missing &#39;memory_type&#39; field&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Get anchor field from YAML schema</span>
    <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">mem_type</span><span class="p">)</span>

    <span class="c1"># Try to get anchor text from the specified field</span>
    <span class="n">anchor_text</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># First check if it&#39;s a core field on the Memory object</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">):</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Otherwise check in the payload</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">stripped_text</span> <span class="o">=</span> <span class="n">anchor_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stripped_text</span>

    <span class="c1"># Anchor field missing, empty, or invalid</span>
    <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; is missing, empty, or invalid &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">mem_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
        <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">mem_type</span><span class="p">,</span>
            <span class="s2">&quot;anchor_field&quot;</span><span class="p">:</span> <span class="n">anchor_field</span><span class="p">,</span>
            <span class="s2">&quot;anchor_value&quot;</span><span class="p">:</span> <span class="n">anchor_text</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.create_memory_from_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_memory_from_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a Memory object from YAML-validated payload.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_memory_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Memory object from YAML-validated payload.&quot;&quot;&quot;</span>

    <span class="c1"># Get anchor field from YAML schema</span>
    <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">memory_type</span><span class="p">)</span>

    <span class="c1"># Extract anchor text from payload</span>
    <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing or invalid anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; in payload &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Validate full payload against YAML schema</span>
    <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="c1"># Construct Memory with YAML-defined payload only</span>
    <span class="k">return</span> <span class="n">Memory</span><span class="p">(</span>
        <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
        <span class="n">payload</span><span class="o">=</span><span class="n">validated_payload</span><span class="p">,</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.debug_relation_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">debug_relation_map</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a nested relation map for debugging/printing.</p>
<p>Structure:
{
  source: {
    target: [ {name, predicate, directed, description} ... ]
  }
}</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">debug_relation_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a nested relation map for debugging/printing.</span>

<span class="sd">    Structure:</span>
<span class="sd">    {</span>
<span class="sd">      source: {</span>
<span class="sd">        target: [ {name, predicate, directed, description} ... ]</span>
<span class="sd">      }</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
        <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">specs</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.get_anchor_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the anchor field name for the given entity type from YAML schema.</p>
<p>Now reads from vector.anchored_to instead of separate anchor field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anchor field name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If anchor field not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_anchor_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the anchor field name for the given entity type from YAML schema.</span>

<span class="sd">    Now reads from vector.anchored_to instead of separate anchor field.</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_name: Name of the entity type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Anchor field name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If anchor field not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

    <span class="c1"># Get entity spec with inheritance resolution</span>
    <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

    <span class="c1"># Look for vector field with anchored_to</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">_field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
            <span class="n">anchored_to</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anchored_to&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">anchored_to</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">anchored_to</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; has no vector field with &#39;anchored_to&#39; property&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.get_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get Pydantic model from TypeRegistry - NO REDUNDANCY.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Pydantic model from TypeRegistry - NO REDUNDANCY.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.get_entity_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_types</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get list of available entity types from YAML schema.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of available entity types from YAML schema.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.get_labels_for_predicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_labels_for_predicates</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="n">predicates</span><span class="p">,</span> <span class="n">neighbor_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Expand predicate names to concrete relationship labels for a given source.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source entity type name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>predicates</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of predicate names to include (case-insensitive). If None, include all.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_label</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional target entity type filter (case-insensitive)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of concrete relationship labels (table names) matching the filter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_labels_for_predicates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand predicate names to concrete relationship labels for a given source.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_type: Source entity type name</span>
<span class="sd">        predicates: List of predicate names to include (case-insensitive). If None, include all.</span>
<span class="sd">        neighbor_label: Optional target entity type filter (case-insensitive)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of concrete relationship labels (table names) matching the filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty source_type&quot;</span><span class="p">)</span>

    <span class="n">preds_u</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicates</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">neighbor_l</span> <span class="o">=</span> <span class="n">neighbor_label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">preds_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preds_u</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">neighbor_l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">neighbor_l</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.get_relations_for_source" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get normalized relation specs for a source entity in target-first schema.</p>


<details class="returns-list-of-dicts-with-keys" open>
  <summary>Returns list of dicts with keys</summary>
  <ul>
<li>source (str)</li>
<li>target (str)</li>
<li>name (str | None)</li>
<li>description (str | None)</li>
<li>predicate (str)</li>
<li>directed (bool)</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_relations_for_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get normalized relation specs for a source entity in target-first schema.</span>

<span class="sd">    Returns list of dicts with keys:</span>
<span class="sd">        - source (str)</span>
<span class="sd">        - target (str)</span>
<span class="sd">        - name (str | None)</span>
<span class="sd">        - description (str | None)</span>
<span class="sd">        - predicate (str)</span>
<span class="sd">        - directed (bool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

    <span class="n">source_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">relations_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_relations_mapping_for_entity</span><span class="p">(</span><span class="n">source_l</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_map</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">out</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target_l</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">predicate</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Skip invalid entries - strict behavior can be added later</span>
                <span class="k">continue</span>
            <span class="n">directed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_l</span><span class="p">,</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target_l</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">directed</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.get_see_also_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_see_also_config</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the see_also configuration for the given entity type from YAML schema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with keys: enabled, threshold, limit, target_types</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None if see_also is not configured for this entity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_see_also_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the see_also configuration for the given entity type from YAML schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict with keys: enabled, threshold, limit, target_types</span>
<span class="sd">        None if see_also is not configured for this entity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>
    <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
    <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

    <span class="n">see_also</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;see_also&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">see_also</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Validate required fields</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)),</span>
        <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="s2">&quot;target_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_types&quot;</span><span class="p">,</span> <span class="p">[])),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.relationship_table_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">relationship_table_name</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Generate relationship table name.</p>
<p>For now, table name does not encode direction; direction affects creation/query semantics.
Canonicalization for undirected pairs can be added here later if decided.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">relationship_table_name</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># noqa: unused-argument</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate relationship table name.</span>

<span class="sd">    For now, table name does not encode direction; direction affects creation/query semantics.</span>
<span class="sd">    Canonicalization for undirected pairs can be added here later if decided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.api.public.YamlTranslator.validate_memory_against_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate memory payload against YAML schema and return cleaned payload.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_memory_against_yaml</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate memory payload against YAML schema and return cleaned payload.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;memory_type is required&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;payload is required&quot;</span><span class="p">)</span>

    <span class="c1"># Strict validation - entity type MUST exist in YAML</span>
    <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown entity type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;. All types must be defined in YAML schema.&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                <span class="s2">&quot;available_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">emap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="n">req</span><span class="p">,</span> <span class="n">_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Validate enum fields against YAML schema choices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_enum_fields</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="c1"># Validate that all fields are defined in YAML schema</span>
    <span class="n">req</span><span class="p">,</span> <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">valid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">req</span> <span class="o">+</span> <span class="n">opt</span><span class="p">)</span>
    <span class="n">system_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_system_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">invalid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">valid_fields</span> <span class="o">-</span> <span class="n">system_fields</span>
    <span class="k">if</span> <span class="n">invalid_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid fields not defined in schema: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                <span class="s2">&quot;valid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">valid_fields</span><span class="p">),</span>
                <span class="s2">&quot;invalid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Strip system-reserved fields if present</span>
    <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">syskey</span> <span class="ow">in</span> <span class="n">system_fields</span><span class="p">:</span>
        <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">syskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cleaned</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public._get_client" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_client</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get or create singleton client from environment variables.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemgClient</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemgClient (memg_core.api.public.MemgClient)" href="#memg_core.api.public.MemgClient">MemgClient</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Singleton client instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If required environment variables are not set.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MemgClient</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get or create singleton client from environment variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemgClient: Singleton client instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If required environment variables are not set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_CLIENT</span>
    <span class="k">if</span> <span class="n">_CLIENT</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yaml_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_PATH&quot;</span><span class="p">)</span>
        <span class="n">db_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MEMG_DB_PATH&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">yaml_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">db_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_PATH and MEMG_DB_PATH environment variables must be set&quot;</span><span class="p">)</span>

        <span class="n">_CLIENT</span> <span class="o">=</span> <span class="n">MemgClient</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_CLIENT</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.add_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_memory</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add memory using environment-based client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type from YAML schema (e.g., 'task', 'note').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory data conforming to YAML schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Owner of the memory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID (HRID) for the created memory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_memory</span><span class="p">(</span><span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add memory using environment-based client.</span>

<span class="sd">    Args:</span>
<span class="sd">        memory_type: Entity type from YAML schema (e.g., &#39;task&#39;, &#39;note&#39;).</span>
<span class="sd">        payload: Memory data conforming to YAML schema.</span>
<span class="sd">        user_id: Owner of the memory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Human-readable ID (HRID) for the created memory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">add_memory</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.add_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_relationship</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">,</span> <span class="n">from_memory_type</span><span class="p">,</span> <span class="n">to_memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add relationship using environment-based client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type from YAML schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional relationship properties.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
    <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add relationship using environment-based client.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_memory_hrid: Source memory HRID.</span>
<span class="sd">        to_memory_hrid: Target memory HRID.</span>
<span class="sd">        relation_type: Relationship type from YAML schema.</span>
<span class="sd">        from_memory_type: Source memory entity type.</span>
<span class="sd">        to_memory_type: Target memory entity type.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        properties: Optional relationship properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">add_relationship</span><span class="p">(</span>
        <span class="n">from_memory_hrid</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.create_memory_service" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_memory_service</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Factory function to create a MemoryService instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_clients</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DatabaseClients instance (after init_dbs() called).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemoryService</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemoryService (memg_core.core.pipelines.indexer.MemoryService)" href="#memg_core.api.public.MemoryService">MemoryService</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured MemoryService instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/indexer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_memory_service</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemoryService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory function to create a MemoryService instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_clients: DatabaseClients instance (after init_dbs() called).</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemoryService: Configured MemoryService instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MemoryService</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.create_search_service" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_search_service</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Factory function to create a SearchService instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_clients</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DatabaseClients instance (after init_dbs() called).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SearchService</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="SearchService (memg_core.core.pipelines.retrieval.SearchService)" href="#memg_core.api.public.SearchService">SearchService</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured SearchService instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/pipelines/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_search_service</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Factory function to create a SearchService instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_clients: DatabaseClients instance (after init_dbs() called).</span>

<span class="sd">    Returns:</span>
<span class="sd">        SearchService: Configured SearchService instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">SearchService</span><span class="p">(</span><span class="n">db_clients</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.delete_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete memory using environment-based client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID of the memory to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete memory using environment-based client.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable ID of the memory to delete.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">delete_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.delete_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_relationship</span><span class="p">(</span><span class="n">from_memory_hrid</span><span class="p">,</span> <span class="n">to_memory_hrid</span><span class="p">,</span> <span class="n">relation_type</span><span class="p">,</span> <span class="n">from_memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Delete relationship using environment-based client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory HRID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type from YAML schema.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source memory entity type (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target memory entity type (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification (required).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded, False if relationship not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
    <span class="n">from_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_memory_hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete relationship using environment-based client.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_memory_hrid: Source memory HRID.</span>
<span class="sd">        to_memory_hrid: Target memory HRID.</span>
<span class="sd">        relation_type: Relationship type from YAML schema.</span>
<span class="sd">        from_memory_type: Source memory entity type (inferred from HRID if not provided).</span>
<span class="sd">        to_memory_type: Target memory entity type (inferred from HRID if not provided).</span>
<span class="sd">        user_id: User ID for ownership verification (required).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded, False if relationship not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">delete_relationship</span><span class="p">(</span>
        <span class="n">from_memory_hrid</span><span class="p">,</span>
        <span class="n">to_memory_hrid</span><span class="p">,</span>
        <span class="n">relation_type</span><span class="p">,</span>
        <span class="n">from_memory_type</span><span class="p">,</span>
        <span class="n">to_memory_type</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.get_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_config</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get system configuration, preferring environment variables.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemorySystemConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemorySystemConfig


  
      dataclass
   (memg_core.core.config.MemorySystemConfig)" href="#memg_core.core.config.MemorySystemConfig">MemorySystemConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System configuration instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MemorySystemConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get system configuration, preferring environment variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemorySystemConfig: System configuration instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MemorySystemConfig</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.get_memories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_memories</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get memories using environment-based client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type filter (e.g., "task", "note").</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional field filters (e.g., {"status": "open", "priority": "high"}).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of memories to return (default 50).</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of memories to skip for pagination (default 0).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_neighbors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include neighbor nodes via graph traversal.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hops</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of hops for neighbor expansion (default 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of memory data with full payloads.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_memories</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get memories using environment-based client.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">        filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;, &quot;priority&quot;: &quot;high&quot;}).</span>
<span class="sd">        limit: Maximum number of memories to return (default 50).</span>
<span class="sd">        offset: Number of memories to skip for pagination (default 0).</span>
<span class="sd">        include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">        hops: Number of hops for neighbor expansion (default 1).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of memory data with full payloads.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">get_memories</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="p">,</span> <span class="n">hops</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.get_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hops</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">relation_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">neighbor_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get memory using environment-based client with optional neighbor expansion.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier of the memory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_neighbors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include neighbor nodes via graph traversal.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hops</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of hops for neighbor expansion (default 1).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relation_types</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by specific relationship types (None = all relations).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum neighbors to return per hop (default 5).</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_memory</span><span class="p">(</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_neighbors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hops</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">relation_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">neighbor_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get memory using environment-based client with optional neighbor expansion.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable identifier of the memory.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint (inferred from HRID if not provided).</span>
<span class="sd">        include_neighbors: Whether to include neighbor nodes via graph traversal.</span>
<span class="sd">        hops: Number of hops for neighbor expansion (default 1).</span>
<span class="sd">        relation_types: Filter by specific relationship types (None = all relations).</span>
<span class="sd">        neighbor_limit: Maximum neighbors to return per hop (default 5).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any] | None: Memory data with full payload and optional neighbors, or None if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">get_memory</span><span class="p">(</span>
        <span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">include_neighbors</span><span class="p">,</span> <span class="n">hops</span><span class="p">,</span> <span class="n">relation_types</span><span class="p">,</span> <span class="n">neighbor_limit</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.get_services" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_services</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get services from singleton client (MCP server compatibility).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="MemoryService (memg_core.core.pipelines.indexer.MemoryService)" href="#memg_core.api.public.MemoryService">MemoryService</a>, <a class="autorefs autorefs-internal" title="SearchService (memg_core.core.pipelines.retrieval.SearchService)" href="#memg_core.api.public.SearchService">SearchService</a>, <a class="autorefs autorefs-internal" title="YamlTranslator (memg_core.core.yaml_translator.YamlTranslator)" href="#memg_core.core.yaml_translator.YamlTranslator">YamlTranslator</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[MemoryService, SearchService, YamlTranslator]: Service instances for direct access.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_services</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">MemoryService</span><span class="p">,</span> <span class="n">SearchService</span><span class="p">,</span> <span class="n">YamlTranslator</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get services from singleton client (MCP server compatibility).</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[MemoryService, SearchService, YamlTranslator]: Service instances for direct access.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">_get_client</span><span class="p">()</span>
    <span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">YamlTranslator</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_PATH&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">_memory_service</span><span class="p">,</span> <span class="n">client</span><span class="o">.</span><span class="n">_search_service</span><span class="p">,</span> <span class="n">yaml_translator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.search" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">decay_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Search memories using environment-based client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to search for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for filtering results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type filter.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of results to return.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity score threshold (0.0-1.0).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decay_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Score decay factor per hop (default: 1.0 = no decay).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decay_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Explicit neighbor score threshold (overrides decay_rate).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional search parameters.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>SearchResult</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="SearchResult (memg_core.core.models.SearchResult)" href="#memg_core.core.models.SearchResult">SearchResult</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search result with explicit seed/neighbor separation,
including full payloads for seeds and relationships.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
    <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decay_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">decay_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search memories using environment-based client.</span>

<span class="sd">    Args:</span>
<span class="sd">        query: Text to search for.</span>
<span class="sd">        user_id: User ID for filtering results.</span>
<span class="sd">        memory_type: Optional memory type filter.</span>
<span class="sd">        limit: Maximum number of results to return.</span>
<span class="sd">        score_threshold: Minimum similarity score threshold (0.0-1.0).</span>
<span class="sd">        decay_rate: Score decay factor per hop (default: 1.0 = no decay).</span>
<span class="sd">        decay_threshold: Explicit neighbor score threshold (overrides decay_rate).</span>
<span class="sd">        **kwargs: Additional search parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SearchResult: Search result with explicit seed/neighbor separation,</span>
<span class="sd">            including full payloads for seeds and relationships.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">query</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">memory_type</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
        <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">,</span>
        <span class="n">decay_threshold</span><span class="o">=</span><span class="n">decay_threshold</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.shutdown_services" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shutdown_services</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Shutdown singleton client.</p>
<p>Closes database connections and cleans up resources.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">shutdown_services</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shutdown singleton client.</span>

<span class="sd">    Closes database connections and cleans up resources.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_CLIENT</span>
    <span class="k">if</span> <span class="n">_CLIENT</span><span class="p">:</span>
        <span class="n">_CLIENT</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">_CLIENT</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.api.public.update_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">payload_updates</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update memory using environment-based client.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory HRID to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload_updates</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of fields to update (only changed fields).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional memory type hint (inferred from HRID if not provided).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if update succeeded, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/api/public.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_memory</span><span class="p">(</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">payload_updates</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update memory using environment-based client.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Memory HRID to update.</span>
<span class="sd">        payload_updates: Dictionary of fields to update (only changed fields).</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        memory_type: Optional memory type hint (inferred from HRID if not provided).</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if update succeeded, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_get_client</span><span class="p">()</span><span class="o">.</span><span class="n">update_memory</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">payload_updates</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="core-models">Core Models</h2>
<p>Core data models and types:</p>


<div class="doc doc-object doc-module">



<a id="memg_core.core.models"></a>
    <div class="doc doc-contents first">

        <p>Core models for the memory system.</p>










  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="memg_core.core.models._MAX_SCORE_TOLERANCE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_MAX_SCORE_TOLERANCE</span> <span class="o">=</span> <span class="mf">1.001</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-class">



<h2 id="memg_core.core.models.Memory" class="doc doc-heading">
            <code>Memory</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Core memory model with YAML-driven payload validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier (UUID or HRID).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Owner of the memory.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.memory_type">memory_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type from YAML schema.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.payload">payload</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity-specific fields.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.vector">vector</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Embedding vector.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.created_at">created_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Creation timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.updated_at">updated_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Last update timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.Memory.hrid">hrid</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Memory</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core memory model with YAML-driven payload validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id: Unique identifier (UUID or HRID).</span>
<span class="sd">        user_id: Owner of the memory.</span>
<span class="sd">        memory_type: Entity type from YAML schema.</span>
<span class="sd">        payload: Entity-specific fields.</span>
<span class="sd">        vector: Embedding vector.</span>
<span class="sd">        created_at: Creation timestamp.</span>
<span class="sd">        updated_at: Last update timestamp.</span>
<span class="sd">        hrid: Human-readable identifier.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Core fields only - NO hardcoded entity-specific fields</span>
    <span class="c1"># NO DEFAULTS - crash early if required fields missing</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>  <span class="c1"># System-generated ID only</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># REQUIRED - no default</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># REQUIRED - no default, must come from YAML</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># Entity fields container</span>
    <span class="n">vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># System-generated vector</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>  <span class="c1"># System timestamp</span>
    <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Human-readable id (e.g., MEMO_AAA001)</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">memory_type_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that memory_type is not empty.</span>

<span class="sd">        Args:</span>
<span class="sd">            v: Memory type value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Stripped memory type.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If memory_type is empty or whitespace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;memory_type cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># (properties removed â€“ dynamic __getattr__ handles field access)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamic attribute access for YAML-defined payload fields ONLY.</span>

<span class="sd">        No fallback logic, no backward compatibility. If the field is not</span>
<span class="sd">        in the payload dictionary, raises AttributeError immediately.</span>
<span class="sd">        This enforces strict YAML schema compliance.</span>

<span class="sd">        Args:</span>
<span class="sd">            item: Field name to access.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: Field value from payload.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: If field is not in payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">payload</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="c1"># YAML â†’ Dynamic entity model projection helpers</span>
    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Project this Memory into a dynamic Pydantic entity model.</span>

<span class="sd">        Returns an instance of the auto-generated model class that matches</span>
<span class="sd">        the entity type defined in the YAML schema. Only non-system fields</span>
<span class="sd">        are included.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseModel: Dynamic Pydantic model instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_cls</span> <span class="o">=</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_type</span><span class="p">)</span>
        <span class="c1"># Pass only fields that the model expects</span>
        <span class="n">model_fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">model_fields</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">model_cls</span><span class="p">(</span><span class="o">**</span><span class="n">model_fields</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.core.models.Memory.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Dynamic attribute access for YAML-defined payload fields ONLY.</p>
<p>No fallback logic, no backward compatibility. If the field is not
in the payload dictionary, raises AttributeError immediately.
This enforces strict YAML schema compliance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>item</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field name to access.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field value from payload.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If field is not in payload.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dynamic attribute access for YAML-defined payload fields ONLY.</span>

<span class="sd">    No fallback logic, no backward compatibility. If the field is not</span>
<span class="sd">    in the payload dictionary, raises AttributeError immediately.</span>
<span class="sd">    This enforces strict YAML schema compliance.</span>

<span class="sd">    Args:</span>
<span class="sd">        item: Field name to access.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: Field value from payload.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AttributeError: If field is not in payload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">payload</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.models.Memory.memory_type_not_empty" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">memory_type_not_empty</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validate that memory_type is not empty.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory type value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stripped memory type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If memory_type is empty or whitespace.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">memory_type_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that memory_type is not empty.</span>

<span class="sd">    Args:</span>
<span class="sd">        v: Memory type value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Stripped memory type.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If memory_type is empty or whitespace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;memory_type cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.models.Memory.to_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_entity_model</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Project this Memory into a dynamic Pydantic entity model.</p>
<p>Returns an instance of the auto-generated model class that matches
the entity type defined in the YAML schema. Only non-system fields
are included.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BaseModel</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dynamic Pydantic model instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Project this Memory into a dynamic Pydantic entity model.</span>

<span class="sd">    Returns an instance of the auto-generated model class that matches</span>
<span class="sd">    the entity type defined in the YAML schema. Only non-system fields</span>
<span class="sd">    are included.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseModel: Dynamic Pydantic model instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_cls</span> <span class="o">=</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_type</span><span class="p">)</span>
    <span class="c1"># Pass only fields that the model expects</span>
    <span class="n">model_fields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">model_fields</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">model_cls</span><span class="p">(</span><span class="o">**</span><span class="n">model_fields</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.models.MemoryNeighbor" class="doc doc-heading">
            <code>MemoryNeighbor</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Memory neighbor with anchor-only payload.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryNeighbor.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Owner of the memory.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryNeighbor.hrid">hrid</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryNeighbor.memory_type">memory_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type from YAML schema.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryNeighbor.created_at">created_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Creation timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryNeighbor.updated_at">updated_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Last update timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryNeighbor.payload">payload</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anchor-only payload (statement field only).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryNeighbor.score">score</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Recursive relevance score (seed_score Ã— neighbor_similarity).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemoryNeighbor</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Memory neighbor with anchor-only payload.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id: Owner of the memory.</span>
<span class="sd">        hrid: Human-readable identifier.</span>
<span class="sd">        memory_type: Entity type from YAML schema.</span>
<span class="sd">        created_at: Creation timestamp.</span>
<span class="sd">        updated_at: Last update timestamp.</span>
<span class="sd">        payload: Anchor-only payload (statement field only).</span>
<span class="sd">        score: Recursive relevance score (seed_score Ã— neighbor_similarity).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Owner of the memory&quot;</span><span class="p">)</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Human-readable identifier&quot;</span><span class="p">)</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Entity type from YAML schema&quot;</span><span class="p">)</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Creation timestamp&quot;</span><span class="p">)</span>
    <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Last update timestamp&quot;</span><span class="p">)</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Anchor-only payload&quot;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Recursive relevance score&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.models.MemoryPoint" class="doc doc-heading">
            <code>MemoryPoint</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Memory with embedding vector for Qdrant.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryPoint.memory">memory</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Memory (memg_core.core.models.Memory)" href="#memg_core.core.models.Memory">Memory</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryPoint.vector">vector</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Embedding vector.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemoryPoint.point_id">point_id</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Qdrant point ID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemoryPoint</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Memory with embedding vector for Qdrant.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        memory: Memory instance.</span>
<span class="sd">        vector: Embedding vector.</span>
<span class="sd">        point_id: Qdrant point ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">memory</span><span class="p">:</span> <span class="n">Memory</span>
    <span class="n">vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Embedding vector&quot;</span><span class="p">)</span>
    <span class="n">point_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Qdrant point ID&quot;</span><span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;vector&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">vector_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that vector is not empty.</span>

<span class="sd">        Args:</span>
<span class="sd">            v: Vector to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[float]: Validated vector.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If vector is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vector cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.core.models.MemoryPoint.vector_not_empty" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vector_not_empty</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validate that vector is not empty.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vector to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[float]: Validated vector.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If vector is empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;vector&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vector_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that vector is not empty.</span>

<span class="sd">    Args:</span>
<span class="sd">        v: Vector to validate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[float]: Validated vector.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If vector is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vector cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.models.MemorySeed" class="doc doc-heading">
            <code>MemorySeed</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Memory seed with full payload and explicit relationships.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Owner of the memory.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.hrid">hrid</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.memory_type">memory_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type from YAML schema.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.created_at">created_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Creation timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.updated_at">updated_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Last update timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.payload">payload</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full entity payload.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.score">score</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vector similarity score to query.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.MemorySeed.relationships">relationships</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="RelationshipInfo (memg_core.core.models.RelationshipInfo)" href="#memg_core.core.models.RelationshipInfo">RelationshipInfo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of relationships to other memories.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemorySeed</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Memory seed with full payload and explicit relationships.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id: Owner of the memory.</span>
<span class="sd">        hrid: Human-readable identifier.</span>
<span class="sd">        memory_type: Entity type from YAML schema.</span>
<span class="sd">        created_at: Creation timestamp.</span>
<span class="sd">        updated_at: Last update timestamp.</span>
<span class="sd">        payload: Full entity payload.</span>
<span class="sd">        score: Vector similarity score to query.</span>
<span class="sd">        relationships: List of relationships to other memories.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Owner of the memory&quot;</span><span class="p">)</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Human-readable identifier&quot;</span><span class="p">)</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Entity type from YAML schema&quot;</span><span class="p">)</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Creation timestamp&quot;</span><span class="p">)</span>
    <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Last update timestamp&quot;</span><span class="p">)</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Full entity payload&quot;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">_MAX_SCORE_TOLERANCE</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Vector similarity score&quot;</span>
    <span class="p">)</span>
    <span class="n">relationships</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RelationshipInfo</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Relationships to other memories&quot;</span>
    <span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize similarity scores to handle floating-point precision errors.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Similarity score cannot be negative: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mf">1.001</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Similarity score too high (indicates calculation error): </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.core.models.MemorySeed.normalize_score" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_score</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Normalize similarity scores to handle floating-point precision errors.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">normalize_score</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize similarity scores to handle floating-point precision errors.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Similarity score cannot be negative: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mf">1.001</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Similarity score too high (indicates calculation error): </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.models.ProcessingResult" class="doc doc-heading">
            <code>ProcessingResult</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Result from memory processing pipelines - type-agnostic.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.ProcessingResult.success">success</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether processing succeeded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.ProcessingResult.memories_created">memories_created</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Memory (memg_core.core.models.Memory)" href="#memg_core.core.models.Memory">Memory</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of created memories.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.ProcessingResult.errors">errors</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of error messages.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.ProcessingResult.processing_time_ms">processing_time_ms</span></code></td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Processing time in milliseconds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProcessingResult</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result from memory processing pipelines - type-agnostic.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        success: Whether processing succeeded.</span>
<span class="sd">        memories_created: List of created memories.</span>
<span class="sd">        errors: List of error messages.</span>
<span class="sd">        processing_time_ms: Processing time in milliseconds.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">memories_created</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Memory</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">processing_time_ms</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">total_created</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Total memories created (all types).</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Number of memories created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memories_created</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="memg_core.core.models.ProcessingResult.total_created" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">total_created</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Total memories created (all types).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of memories created.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>






  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.models.RelationshipInfo" class="doc doc-heading">
            <code>RelationshipInfo</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Relationship information between memories.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.RelationshipInfo.relation_type">relation_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of relationship (e.g., FIXES, ADDRESSES).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.RelationshipInfo.target_hrid">target_hrid</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HRID of the target memory.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.RelationshipInfo.score">score</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship relevance score with natural decay.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.RelationshipInfo.relationships">relationships</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="RelationshipInfo (memg_core.core.models.RelationshipInfo)" href="#memg_core.core.models.RelationshipInfo">RelationshipInfo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nested relationships for multi-hop expansion.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RelationshipInfo</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Relationship information between memories.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        relation_type: Type of relationship (e.g., FIXES, ADDRESSES).</span>
<span class="sd">        target_hrid: HRID of the target memory.</span>
<span class="sd">        score: Relationship relevance score with natural decay.</span>
<span class="sd">        relationships: Nested relationships for multi-hop expansion.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">relation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Relationship type from YAML schema&quot;</span><span class="p">)</span>
    <span class="n">target_hrid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;HRID of target memory&quot;</span><span class="p">)</span>
    <span class="n">score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Relationship relevance score&quot;</span><span class="p">)</span>
    <span class="n">relationships</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RelationshipInfo</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Nested relationships&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.models.SearchResult" class="doc doc-heading">
            <code>SearchResult</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Search result with explicit seed/neighbor separation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.SearchResult.memories">memories</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="MemorySeed (memg_core.core.models.MemorySeed)" href="#memg_core.core.models.MemorySeed">MemorySeed</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of memory seeds with full payloads and relationships.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.models.SearchResult.neighbors">neighbors</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="MemoryNeighbor (memg_core.core.models.MemoryNeighbor)" href="#memg_core.core.models.MemoryNeighbor">MemoryNeighbor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of memory neighbors with anchor-only payloads.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SearchResult</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search result with explicit seed/neighbor separation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        memories: List of memory seeds with full payloads and relationships.</span>
<span class="sd">        neighbors: List of memory neighbors with anchor-only payloads.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">memories</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemorySeed</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Memory seeds with full payloads&quot;</span>
    <span class="p">)</span>
    <span class="n">neighbors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">MemoryNeighbor</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Memory neighbors with anchor payloads&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.core.models.get_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get Pydantic model for entity from global registry.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="type">type</span>[<span title="pydantic.BaseModel">BaseModel</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>type[BaseModel]: Pydantic model class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/types.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Pydantic model for entity from global registry.</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_name: Name of the entity.</span>

<span class="sd">    Returns:</span>
<span class="sd">        type[BaseModel]: Pydantic model class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TypeRegistry</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="configuration">Configuration</h2>
<p>Configuration management:</p>


<div class="doc doc-object doc-module">



<a id="memg_core.core.config"></a>
    <div class="doc doc-contents first">

        <p>Memory System Configuration - minimal and essential settings</p>










  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="memg_core.core.config.DEFAULT_MEMG_CONFIG" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_MEMG_CONFIG</span> <span class="o">=</span> <span class="n">MemGConfig</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="memg_core.core.config.DEFAULT_SYSTEM_CONFIG" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">DEFAULT_SYSTEM_CONFIG</span> <span class="o">=</span> <span class="n">MemorySystemConfig</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-class">



<h2 id="memg_core.core.config.MemGConfig" class="doc doc-heading">
            <code>MemGConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Core memory system configuration.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.similarity_threshold">similarity_threshold</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold for conflict detection (0.0-1.0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.score_threshold">score_threshold</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum score for search results (0.0-1.0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.high_similarity_threshold">high_similarity_threshold</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold for duplicate detection (0.0-1.0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.decay_rate">decay_rate</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graph traversal decay rate per hop (0.0-1.0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.decay_threshold">decay_threshold</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum neighbor relevance threshold (0.0-1.0).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.enable_ai_type_verification">enable_ai_type_verification</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enable AI-based type detection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.enable_temporal_reasoning">enable_temporal_reasoning</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enable temporal reasoning.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.vector_dimension">vector_dimension</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Embedding dimension size.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.batch_processing_size">batch_processing_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch size for bulk operations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.embedder_model">embedder_model</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FastEmbed model name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.template_name">template_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Active template name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.qdrant_collection_name">qdrant_collection_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Qdrant collection name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemGConfig.kuzu_database_path">kuzu_database_path</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Kuzu database path.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MemGConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core memory system configuration.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        similarity_threshold: Threshold for conflict detection (0.0-1.0).</span>
<span class="sd">        score_threshold: Minimum score for search results (0.0-1.0).</span>
<span class="sd">        high_similarity_threshold: Threshold for duplicate detection (0.0-1.0).</span>
<span class="sd">        decay_rate: Graph traversal decay rate per hop (0.0-1.0).</span>
<span class="sd">        decay_threshold: Minimum neighbor relevance threshold (0.0-1.0).</span>
<span class="sd">        enable_ai_type_verification: Enable AI-based type detection.</span>
<span class="sd">        enable_temporal_reasoning: Enable temporal reasoning.</span>
<span class="sd">        vector_dimension: Embedding dimension size.</span>
<span class="sd">        batch_processing_size: Batch size for bulk operations.</span>
<span class="sd">        embedder_model: FastEmbed model name.</span>
<span class="sd">        template_name: Active template name.</span>
<span class="sd">        qdrant_collection_name: Qdrant collection name.</span>
<span class="sd">        kuzu_database_path: Kuzu database path.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Core similarity and scoring thresholds</span>
    <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c1"># For conflict detection</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># Minimum score for search results</span>
    <span class="n">high_similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>  <span class="c1"># For duplicate detection</span>
    <span class="n">decay_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>  <span class="c1"># Graph traversal decay rate per hop</span>
    <span class="n">decay_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Minimum neighbor relevance threshold</span>

    <span class="c1"># Processing settings</span>
    <span class="n">enable_ai_type_verification</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># AI-based type detection</span>
    <span class="n">enable_temporal_reasoning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Enable temporal reasoning</span>

    <span class="c1"># Performance settings</span>
    <span class="n">vector_dimension</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">384</span>  <span class="c1"># Embedding dimension</span>
    <span class="n">batch_processing_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Batch size for bulk operations</span>
    <span class="n">embedder_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Snowflake/snowflake-arctic-embed-xs&quot;</span>  <span class="c1"># FastEmbed model</span>

    <span class="c1"># Template settings</span>
    <span class="n">template_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>  <span class="c1"># Active template name</span>

    <span class="c1"># Database settings</span>
    <span class="n">qdrant_collection_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;memg&quot;</span>
    <span class="n">kuzu_database_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kuzu_db&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate configuration parameters.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If any threshold values are outside valid range [0.0, 1.0].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;similarity_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;score_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_similarity_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;high_similarity_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_rate</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;decay_rate must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;decay_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert configuration to dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Dictionary representation of configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;similarity_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span><span class="p">,</span>
            <span class="s2">&quot;score_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_threshold</span><span class="p">,</span>
            <span class="s2">&quot;high_similarity_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_similarity_threshold</span><span class="p">,</span>
            <span class="s2">&quot;decay_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_rate</span><span class="p">,</span>
            <span class="s2">&quot;decay_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_threshold</span><span class="p">,</span>
            <span class="s2">&quot;enable_ai_type_verification&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_ai_type_verification</span><span class="p">,</span>
            <span class="s2">&quot;vector_dimension&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_dimension</span><span class="p">,</span>
            <span class="s2">&quot;batch_processing_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_processing_size</span><span class="p">,</span>
            <span class="s2">&quot;embedder_model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder_model</span><span class="p">,</span>
            <span class="s2">&quot;template_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span>
            <span class="s2">&quot;qdrant_collection_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">,</span>
            <span class="s2">&quot;kuzu_database_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_database_path</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;MemGConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create configuration from dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_dict: Dictionary containing configuration values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MemGConfig: Configuration instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_env</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MemGConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create configuration from environment variables.</span>

<span class="sd">        Each instance should use explicit environment variables for isolation.</span>
<span class="sd">        The core memory system doesn&#39;t know or care about server ports.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MemGConfig: Configuration instance with environment-derived values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">similarity_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_SIMILARITY_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.7&quot;</span><span class="p">)),</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_SCORE_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.3&quot;</span><span class="p">)),</span>
            <span class="n">high_similarity_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_HIGH_SIMILARITY_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.9&quot;</span><span class="p">)),</span>
            <span class="n">decay_rate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_DECAY_RATE&quot;</span><span class="p">,</span> <span class="s2">&quot;0.9&quot;</span><span class="p">)),</span>
            <span class="n">decay_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_DECAY_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.1&quot;</span><span class="p">)),</span>
            <span class="n">enable_ai_type_verification</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;MEMG_ENABLE_AI_TYPE_VERIFICATION&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="n">vector_dimension</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EMBEDDING_DIMENSION_LEN&quot;</span><span class="p">,</span> <span class="s2">&quot;384&quot;</span><span class="p">)),</span>
            <span class="n">batch_processing_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_BATCH_SIZE&quot;</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span><span class="p">)),</span>
            <span class="n">embedder_model</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EMBEDDER_MODEL&quot;</span><span class="p">,</span> <span class="s2">&quot;Snowflake/snowflake-arctic-embed-xs&quot;</span><span class="p">),</span>
            <span class="n">template_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_TEMPLATE&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">),</span>
            <span class="n">qdrant_collection_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_QDRANT_COLLECTION&quot;</span><span class="p">,</span> <span class="s2">&quot;memg&quot;</span><span class="p">),</span>
            <span class="n">kuzu_database_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_KUZU_DB_PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;kuzu_db&quot;</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.core.config.MemGConfig.__post_init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__post_init__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate configuration parameters.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any threshold values are outside valid range [0.0, 1.0].</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate configuration parameters.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any threshold values are outside valid range [0.0, 1.0].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;similarity_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;score_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_similarity_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;high_similarity_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_rate</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;decay_rate must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_threshold</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;decay_threshold must be between 0.0 and 1.0&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.config.MemGConfig.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create configuration from dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing configuration values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemGConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemGConfig


  
      dataclass
   (memg_core.core.config.MemGConfig)" href="#memg_core.core.config.MemGConfig">MemGConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;MemGConfig&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create configuration from dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_dict: Dictionary containing configuration values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemGConfig: Configuration instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.config.MemGConfig.from_env" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_env</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create configuration from environment variables.</p>
<p>Each instance should use explicit environment variables for isolation.
The core memory system doesn't know or care about server ports.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemGConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemGConfig


  
      dataclass
   (memg_core.core.config.MemGConfig)" href="#memg_core.core.config.MemGConfig">MemGConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration instance with environment-derived values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_env</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MemGConfig&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create configuration from environment variables.</span>

<span class="sd">    Each instance should use explicit environment variables for isolation.</span>
<span class="sd">    The core memory system doesn&#39;t know or care about server ports.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemGConfig: Configuration instance with environment-derived values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">similarity_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_SIMILARITY_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.7&quot;</span><span class="p">)),</span>
        <span class="n">score_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_SCORE_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.3&quot;</span><span class="p">)),</span>
        <span class="n">high_similarity_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_HIGH_SIMILARITY_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.9&quot;</span><span class="p">)),</span>
        <span class="n">decay_rate</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_DECAY_RATE&quot;</span><span class="p">,</span> <span class="s2">&quot;0.9&quot;</span><span class="p">)),</span>
        <span class="n">decay_threshold</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_DECAY_THRESHOLD&quot;</span><span class="p">,</span> <span class="s2">&quot;0.1&quot;</span><span class="p">)),</span>
        <span class="n">enable_ai_type_verification</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
            <span class="s2">&quot;MEMG_ENABLE_AI_TYPE_VERIFICATION&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="n">vector_dimension</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EMBEDDING_DIMENSION_LEN&quot;</span><span class="p">,</span> <span class="s2">&quot;384&quot;</span><span class="p">)),</span>
        <span class="n">batch_processing_size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_BATCH_SIZE&quot;</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span><span class="p">)),</span>
        <span class="n">embedder_model</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;EMBEDDER_MODEL&quot;</span><span class="p">,</span> <span class="s2">&quot;Snowflake/snowflake-arctic-embed-xs&quot;</span><span class="p">),</span>
        <span class="n">template_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_TEMPLATE&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">),</span>
        <span class="n">qdrant_collection_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_QDRANT_COLLECTION&quot;</span><span class="p">,</span> <span class="s2">&quot;memg&quot;</span><span class="p">),</span>
        <span class="n">kuzu_database_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_KUZU_DB_PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;kuzu_db&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.config.MemGConfig.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert configuration to dictionary.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: Dictionary representation of configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert configuration to dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any]: Dictionary representation of configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;similarity_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span><span class="p">,</span>
        <span class="s2">&quot;score_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_threshold</span><span class="p">,</span>
        <span class="s2">&quot;high_similarity_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_similarity_threshold</span><span class="p">,</span>
        <span class="s2">&quot;decay_rate&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_rate</span><span class="p">,</span>
        <span class="s2">&quot;decay_threshold&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_threshold</span><span class="p">,</span>
        <span class="s2">&quot;enable_ai_type_verification&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_ai_type_verification</span><span class="p">,</span>
        <span class="s2">&quot;vector_dimension&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vector_dimension</span><span class="p">,</span>
        <span class="s2">&quot;batch_processing_size&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_processing_size</span><span class="p">,</span>
        <span class="s2">&quot;embedder_model&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder_model</span><span class="p">,</span>
        <span class="s2">&quot;template_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_name</span><span class="p">,</span>
        <span class="s2">&quot;qdrant_collection_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">,</span>
        <span class="s2">&quot;kuzu_database_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_database_path</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.config.MemorySystemConfig" class="doc doc-heading">
            <code>MemorySystemConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Core memory system configuration - NO SERVER CONCERNS.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemorySystemConfig.memg">memg</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="MemGConfig


  
      dataclass
   (memg_core.core.config.MemGConfig)" href="#memg_core.core.config.MemGConfig">MemGConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Core memory configuration instance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemorySystemConfig.debug_mode">debug_mode</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Enable debug mode.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.config.MemorySystemConfig.log_level">log_level</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MemorySystemConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core memory system configuration - NO SERVER CONCERNS.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        memg: Core memory configuration instance.</span>
<span class="sd">        debug_mode: Enable debug mode.</span>
<span class="sd">        log_level: Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">memg</span><span class="p">:</span> <span class="n">MemGConfig</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">MemGConfig</span><span class="p">)</span>

    <span class="c1"># Core system settings only</span>
    <span class="n">debug_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate core system configuration.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If log_level is not a valid logging level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;log_level must be a valid logging level&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_env</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MemorySystemConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create core memory system configuration from environment variables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MemorySystemConfig: Configuration instance with environment-derived values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">memg</span><span class="o">=</span><span class="n">MemGConfig</span><span class="o">.</span><span class="n">from_env</span><span class="p">(),</span>
            <span class="n">debug_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMORY_SYSTEM_DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
            <span class="n">log_level</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMORY_SYSTEM_LOG_LEVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.core.config.MemorySystemConfig.__post_init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__post_init__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate core system configuration.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If log_level is not a valid logging level.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate core system configuration.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If log_level is not a valid logging level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;log_level must be a valid logging level&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.config.MemorySystemConfig.from_env" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_env</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create core memory system configuration from environment variables.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemorySystemConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemorySystemConfig


  
      dataclass
   (memg_core.core.config.MemorySystemConfig)" href="#memg_core.core.config.MemorySystemConfig">MemorySystemConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration instance with environment-derived values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_env</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MemorySystemConfig&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create core memory system configuration from environment variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemorySystemConfig: Configuration instance with environment-derived values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">memg</span><span class="o">=</span><span class="n">MemGConfig</span><span class="o">.</span><span class="n">from_env</span><span class="p">(),</span>
        <span class="n">debug_mode</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMORY_SYSTEM_DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="n">log_level</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMORY_SYSTEM_LOG_LEVEL&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.core.config.get_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_config</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get system configuration, preferring environment variables.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemorySystemConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemorySystemConfig


  
      dataclass
   (memg_core.core.config.MemorySystemConfig)" href="#memg_core.core.config.MemorySystemConfig">MemorySystemConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System configuration instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MemorySystemConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get system configuration, preferring environment variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemorySystemConfig: System configuration instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MemorySystemConfig</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="exceptions">Exceptions</h2>
<p>Exception classes:</p>


<div class="doc doc-object doc-module">



<a id="memg_core.core.exceptions"></a>
    <div class="doc doc-contents first">

        <p>Custom exception hierarchy for the memory system - minimal set.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="memg_core.core.exceptions.ConfigurationError" class="doc doc-heading">
            <code>ConfigurationError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Configuration-related errors (env vars, validation).</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConfigurationError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration-related errors (env vars, validation).&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.exceptions.DatabaseError" class="doc doc-heading">
            <code>DatabaseError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Database operation failures (Qdrant, Kuzu).</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Database operation failures (Qdrant, Kuzu).&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.exceptions.MemorySystemError" class="doc doc-heading">
            <code>MemorySystemError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Base exception for all memory system errors.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.exceptions.MemorySystemError.message">message</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error message.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.exceptions.MemorySystemError.operation">operation</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Operation that caused the error.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.exceptions.MemorySystemError.context">context</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional context information.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.exceptions.MemorySystemError.original_error">original_error</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original exception that was wrapped.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemorySystemError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base exception for all memory system errors.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        message: Error message.</span>
<span class="sd">        operation: Operation that caused the error.</span>
<span class="sd">        context: Additional context information.</span>
<span class="sd">        original_error: Original exception that was wrapped.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">original_error</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_error</span> <span class="o">=</span> <span class="n">original_error</span>

        <span class="c1"># Build detailed error message</span>
        <span class="n">full_message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">if</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">full_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">original_error</span><span class="p">:</span>
            <span class="n">full_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (caused by: </span><span class="si">{</span><span class="n">original_error</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">full_message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.exceptions.ProcessingError" class="doc doc-heading">
            <code>ProcessingError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Memory processing operation failures (catch-all for processing).</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProcessingError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Memory processing operation failures (catch-all for processing).&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.exceptions.ValidationError" class="doc doc-heading">
            <code>ValidationError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Data validation failures (schema, input format).</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ValidationError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data validation failures (schema, input format).&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.core.exceptions.handle_with_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">handle_with_context</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Decorator for consistent error handling with context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>operation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Operation name for error context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>callable</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decorated function with error handling.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_with_context</span><span class="p">(</span><span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator for consistent error handling with context.</span>

<span class="sd">    Args:</span>
<span class="sd">        operation: Operation name for error context.</span>

<span class="sd">    Returns:</span>
<span class="sd">        callable: Decorated function with error handling.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">MemorySystemError</span><span class="p">:</span>
                <span class="c1"># Re-raise our own exceptions as-is</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Wrap unknown exceptions</span>
                <span class="k">raise</span> <span class="n">wrap_exception</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span> <span class="s2">&quot;kwargs&quot;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">})</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.core.exceptions.wrap_exception" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wrap_exception</span><span class="p">(</span><span class="n">original_error</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Wrap a generic exception in an appropriate MemorySystemError subclass.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_error</code>
            </td>
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original exception to wrap.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operation</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Operation that caused the error.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional context information.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemorySystemError</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wrapped exception with appropriate subclass.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wrap_exception</span><span class="p">(</span>
    <span class="n">original_error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MemorySystemError</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap a generic exception in an appropriate MemorySystemError subclass.</span>

<span class="sd">    Args:</span>
<span class="sd">        original_error: Original exception to wrap.</span>
<span class="sd">        operation: Operation that caused the error.</span>
<span class="sd">        context: Additional context information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemorySystemError: Wrapped exception with appropriate subclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">original_error</span><span class="p">)</span>

    <span class="c1"># Map common exceptions to our hierarchy</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original_error</span><span class="p">,</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Storage error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">original_error</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original_error</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ValidationError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid value: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">original_error</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Default to generic ProcessingError for unknown exceptions</span>
    <span class="k">return</span> <span class="n">ProcessingError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">operation</span><span class="o">=</span><span class="n">operation</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
        <span class="n">original_error</span><span class="o">=</span><span class="n">original_error</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="yaml-schema">YAML Schema</h2>
<p>YAML schema handling:</p>


<div class="doc doc-object doc-module">



<a id="memg_core.core.yaml_translator"></a>
    <div class="doc doc-contents first">

        <p>YAML Translator: validates payloads using TypeRegistry and resolves anchor text.</p>
<p>STRICT YAML-FIRST: This module enforces the single-YAML-orchestrates-everything principle.
NO flexibility, NO migration support, NO fallbacks.</p>
<p>Uses TypeRegistry as SINGLE SOURCE OF TRUTH for all entity definitions.
All type building and validation delegated to TypeRegistry - zero redundancy.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="memg_core.core.yaml_translator.Memory" class="doc doc-heading">
            <code>Memory</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Core memory model with YAML-driven payload validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier (UUID or HRID).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Owner of the memory.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.memory_type">memory_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type from YAML schema.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.payload">payload</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity-specific fields.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.vector">vector</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Embedding vector.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.created_at">created_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Creation timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.updated_at">updated_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Last update timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.Memory.hrid">hrid</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable identifier.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Memory</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Core memory model with YAML-driven payload validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id: Unique identifier (UUID or HRID).</span>
<span class="sd">        user_id: Owner of the memory.</span>
<span class="sd">        memory_type: Entity type from YAML schema.</span>
<span class="sd">        payload: Entity-specific fields.</span>
<span class="sd">        vector: Embedding vector.</span>
<span class="sd">        created_at: Creation timestamp.</span>
<span class="sd">        updated_at: Last update timestamp.</span>
<span class="sd">        hrid: Human-readable identifier.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Core fields only - NO hardcoded entity-specific fields</span>
    <span class="c1"># NO DEFAULTS - crash early if required fields missing</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">()))</span>  <span class="c1"># System-generated ID only</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># REQUIRED - no default</span>
    <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># REQUIRED - no default, must come from YAML</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># Entity fields container</span>
    <span class="n">vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># System-generated vector</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">))</span>  <span class="c1"># System timestamp</span>
    <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Human-readable id (e.g., MEMO_AAA001)</span>
    <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">memory_type_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that memory_type is not empty.</span>

<span class="sd">        Args:</span>
<span class="sd">            v: Memory type value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Stripped memory type.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If memory_type is empty or whitespace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;memory_type cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># (properties removed â€“ dynamic __getattr__ handles field access)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamic attribute access for YAML-defined payload fields ONLY.</span>

<span class="sd">        No fallback logic, no backward compatibility. If the field is not</span>
<span class="sd">        in the payload dictionary, raises AttributeError immediately.</span>
<span class="sd">        This enforces strict YAML schema compliance.</span>

<span class="sd">        Args:</span>
<span class="sd">            item: Field name to access.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: Field value from payload.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: If field is not in payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">payload</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="c1"># YAML â†’ Dynamic entity model projection helpers</span>
    <span class="c1"># ---------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Project this Memory into a dynamic Pydantic entity model.</span>

<span class="sd">        Returns an instance of the auto-generated model class that matches</span>
<span class="sd">        the entity type defined in the YAML schema. Only non-system fields</span>
<span class="sd">        are included.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseModel: Dynamic Pydantic model instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_cls</span> <span class="o">=</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_type</span><span class="p">)</span>
        <span class="c1"># Pass only fields that the model expects</span>
        <span class="n">model_fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">model_fields</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">model_cls</span><span class="p">(</span><span class="o">**</span><span class="n">model_fields</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.Memory.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Dynamic attribute access for YAML-defined payload fields ONLY.</p>
<p>No fallback logic, no backward compatibility. If the field is not
in the payload dictionary, raises AttributeError immediately.
This enforces strict YAML schema compliance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>item</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field name to access.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field value from payload.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AttributeError">AttributeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If field is not in payload.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dynamic attribute access for YAML-defined payload fields ONLY.</span>

<span class="sd">    No fallback logic, no backward compatibility. If the field is not</span>
<span class="sd">    in the payload dictionary, raises AttributeError immediately.</span>
<span class="sd">    This enforces strict YAML schema compliance.</span>

<span class="sd">    Args:</span>
<span class="sd">        item: Field name to access.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: Field value from payload.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AttributeError: If field is not in payload.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">payload</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; object has no attribute &#39;</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.Memory.memory_type_not_empty" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">memory_type_not_empty</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Validate that memory_type is not empty.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory type value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stripped memory type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If memory_type is empty or whitespace.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;memory_type&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">memory_type_not_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that memory_type is not empty.</span>

<span class="sd">    Args:</span>
<span class="sd">        v: Memory type value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Stripped memory type.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If memory_type is empty or whitespace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;memory_type cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.Memory.to_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_entity_model</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Project this Memory into a dynamic Pydantic entity model.</p>
<p>Returns an instance of the auto-generated model class that matches
the entity type defined in the YAML schema. Only non-system fields
are included.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>BaseModel</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dynamic Pydantic model instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Project this Memory into a dynamic Pydantic entity model.</span>

<span class="sd">    Returns an instance of the auto-generated model class that matches</span>
<span class="sd">    the entity type defined in the YAML schema. Only non-system fields</span>
<span class="sd">    are included.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseModel: Dynamic Pydantic model instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_cls</span> <span class="o">=</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory_type</span><span class="p">)</span>
    <span class="c1"># Pass only fields that the model expects</span>
    <span class="n">model_fields</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">payload</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">model_fields</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">model_cls</span><span class="p">(</span><span class="o">**</span><span class="n">model_fields</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.yaml_translator.MemorySystemError" class="doc doc-heading">
            <code>MemorySystemError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Base exception for all memory system errors.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.MemorySystemError.message">message</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error message.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.MemorySystemError.operation">operation</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Operation that caused the error.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.MemorySystemError.context">context</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional context information.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.MemorySystemError.original_error">original_error</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original exception that was wrapped.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MemorySystemError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base exception for all memory system errors.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        message: Error message.</span>
<span class="sd">        operation: Operation that caused the error.</span>
<span class="sd">        context: Additional context information.</span>
<span class="sd">        original_error: Original exception that was wrapped.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">original_error</span><span class="p">:</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_error</span> <span class="o">=</span> <span class="n">original_error</span>

        <span class="c1"># Build detailed error message</span>
        <span class="n">full_message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">if</span> <span class="n">operation</span><span class="p">:</span>
            <span class="n">full_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">original_error</span><span class="p">:</span>
            <span class="n">full_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (caused by: </span><span class="si">{</span><span class="n">original_error</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">full_message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.yaml_translator.YamlTranslator" class="doc doc-heading">
            <code>YamlTranslator</code>


</h2>


    <div class="doc doc-contents ">


        <p>Translates YAML schema definitions to Pydantic models for strict validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.YamlTranslator.yaml_path">yaml_path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.YamlTranslator._schema">_schema</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cached schema dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">YamlTranslator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translates YAML schema definitions to Pydantic models for strict validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        yaml_path: Path to YAML schema file.</span>
<span class="sd">        _schema: Cached schema dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize YamlTranslator with YAML schema path.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml_path: Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If YAML path not provided or TypeRegistry initialization fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Require explicit YAML path - no silent defaults</span>
        <span class="k">if</span> <span class="n">yaml_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">yaml_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_SCHEMA&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">env_path</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                    <span class="s2">&quot;YAML schema path required. Set MEMG_YAML_SCHEMA environment variable &quot;</span>
                    <span class="s2">&quot;or provide yaml_path parameter. No defaults allowed.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">env_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># NO model cache - TypeRegistry handles all caching</span>

        <span class="c1"># Initialize TypeRegistry from YAML - crash early if invalid</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">initialize_types_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize TypeRegistry from YAML: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the loaded YAML schema, loading it if necessary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

        <span class="c1"># Load schema from the required path - no fallbacks</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;YAML schema path not set. This should not happen after __init__.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_schema</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load schema from the current yaml_path.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;YAML path is None&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;YAML schema not found at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty YAML schema&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;YAML schema root must be a mapping&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid YAML syntax: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_entities_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">sch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="n">ents</span> <span class="o">=</span> <span class="n">sch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ents</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ents</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Normalize keys to lower</span>
            <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ents</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># list form</span>
        <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ents</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of available entity types from YAML schema.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># ================== RELATIONSHIP PARSING (TARGET-FIRST FORMAT) ==================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_relations_mapping_for_entity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return raw relations mapping for an entity in target-first schema format.</span>

<span class="sd">        The expected YAML shape under an entity is:</span>
<span class="sd">            relations:</span>
<span class="sd">              target_entity_name:</span>
<span class="sd">                - name: ...</span>
<span class="sd">                  description: ...</span>
<span class="sd">                  predicate: PREDICATE_NAME</span>
<span class="sd">                  directed: true|false</span>

<span class="sd">        Returns an empty dict when no relations are defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
        <span class="n">relations_section</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relations&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_section</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">relations_section</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Normalize keys to lower for targets; keep items as-is</span>
        <span class="n">normalized</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_section</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># Skip invalid shapes silently at this layer; validation is higher-level</span>
                <span class="k">continue</span>
            <span class="n">normalized</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">normalized</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_relations_for_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get normalized relation specs for a source entity in target-first schema.</span>

<span class="sd">        Returns list of dicts with keys:</span>
<span class="sd">            - source (str)</span>
<span class="sd">            - target (str)</span>
<span class="sd">            - name (str | None)</span>
<span class="sd">            - description (str | None)</span>
<span class="sd">            - predicate (str)</span>
<span class="sd">            - directed (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

        <span class="n">source_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">relations_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_relations_mapping_for_entity</span><span class="p">(</span><span class="n">source_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">out</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target_l</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">predicate</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># Skip invalid entries - strict behavior can be added later</span>
                    <span class="k">continue</span>
                <span class="n">directed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_l</span><span class="p">,</span>
                        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target_l</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                        <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">directed</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relationship_table_name</span><span class="p">(</span>
        <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># noqa: unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate relationship table name.</span>

<span class="sd">        For now, table name does not encode direction; direction affects creation/query semantics.</span>
<span class="sd">        Canonicalization for undirected pairs can be added here later if decided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_labels_for_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expand predicate names to concrete relationship labels for a given source.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_type: Source entity type name</span>
<span class="sd">            predicates: List of predicate names to include (case-insensitive). If None, include all.</span>
<span class="sd">            neighbor_label: Optional target entity type filter (case-insensitive)</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of concrete relationship labels (table names) matching the filter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty source_type&quot;</span><span class="p">)</span>

        <span class="n">preds_u</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicates</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">neighbor_l</span> <span class="o">=</span> <span class="n">neighbor_label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source_type</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">preds_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preds_u</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">neighbor_l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">neighbor_l</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                    <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                    <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">debug_relation_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a nested relation map for debugging/printing.</span>

<span class="sd">        Structure:</span>
<span class="sd">        {</span>
<span class="sd">          source: {</span>
<span class="sd">            target: [ {name, predicate, directed, description} ... ]</span>
<span class="sd">          }</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
            <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">specs</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_anchor_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the anchor field name for the given entity type from YAML schema.</span>

<span class="sd">        Now reads from vector.anchored_to instead of separate anchor field.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_name: Name of the entity type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Anchor field name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If anchor field not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

        <span class="c1"># Get entity spec with inheritance resolution</span>
        <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

        <span class="c1"># Look for vector field with anchored_to</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">_field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">anchored_to</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anchored_to&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">anchored_to</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">anchored_to</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; has no vector field with &#39;anchored_to&#39; property&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve entity specification with full inheritance chain.&quot;&quot;&quot;</span>
        <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

        <span class="c1"># If no parent, return as-is</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parent_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spec_raw</span>

        <span class="c1"># Recursively resolve parent and merge fields</span>
        <span class="n">parent_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">parent_name</span><span class="p">)</span>

        <span class="c1"># Merge parent fields with child fields (child overrides parent)</span>
        <span class="n">merged_fields</span> <span class="o">=</span> <span class="n">parent_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">merged_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{}))</span>

        <span class="c1"># Create merged spec</span>
        <span class="n">merged_spec</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">merged_spec</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_fields</span>

        <span class="k">return</span> <span class="n">merged_spec</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_see_also_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the see_also configuration for the given entity type from YAML schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict with keys: enabled, threshold, limit, target_types</span>
<span class="sd">            None if see_also is not configured for this entity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>
        <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

        <span class="n">see_also</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;see_also&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">see_also</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Validate required fields</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)),</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="s2">&quot;target_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_types&quot;</span><span class="p">,</span> <span class="p">[])),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_anchor_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build anchor text for embedding from YAML-defined anchor field.</span>

<span class="sd">        NO hardcoded field names - reads anchor field from YAML schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory: Memory object containing payload data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Anchor text for embedding.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If anchor field is missing or invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mem_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mem_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;Memory object missing &#39;memory_type&#39; field&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Get anchor field from YAML schema</span>
        <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">mem_type</span><span class="p">)</span>

        <span class="c1"># Try to get anchor text from the specified field</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># First check if it&#39;s a core field on the Memory object</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">):</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Otherwise check in the payload</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">stripped_text</span> <span class="o">=</span> <span class="n">anchor_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped_text</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stripped_text</span>

        <span class="c1"># Anchor field missing, empty, or invalid</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; is missing, empty, or invalid &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">mem_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">mem_type</span><span class="p">,</span>
                <span class="s2">&quot;anchor_field&quot;</span><span class="p">:</span> <span class="n">anchor_field</span><span class="p">,</span>
                <span class="s2">&quot;anchor_value&quot;</span><span class="p">:</span> <span class="n">anchor_text</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fields_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract required and optional fields from entity specification.</span>

<span class="sd">        Supports either:</span>
<span class="sd">        - fields: {required:[...], optional:[...]} format</span>
<span class="sd">        - Individual field definitions with required flags</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[list[str], list[str]]: (required_fields, optional_fields)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># supports either fields: {required:[...], optional:[...]} OR flat dict</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;required&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">or</span> <span class="s2">&quot;optional&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optional&quot;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="k">return</span> <span class="n">req</span><span class="p">,</span> <span class="n">opt</span>

        <span class="c1"># Resolve all fields including inherited ones</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="c1"># Parse individual field definitions for required flag</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">optional_fields</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">all_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="c1"># Skip system fields - they&#39;re handled by the system</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">required_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">optional_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">optional_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">required_fields</span><span class="p">,</span> <span class="n">optional_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_inherited_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve all fields including inherited ones from parent entities.</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Dictionary containing all fields (inherited + current).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">entities_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>

        <span class="c1"># If entity has a parent, resolve parent fields first</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent_name</span><span class="p">:</span>
            <span class="n">parent_spec</span> <span class="o">=</span> <span class="n">entities_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">parent_spec</span><span class="p">:</span>
                <span class="c1"># Recursively resolve parent fields</span>
                <span class="n">parent_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">parent_spec</span><span class="p">)</span>
                <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parent_fields</span><span class="p">)</span>

        <span class="c1"># Add/override with current entity&#39;s fields</span>
        <span class="n">current_fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_fields</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_system_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract system fields from YAML schema (fields marked with system: true).</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: Set of field names that are marked as system fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">all_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">system_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">system_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_enum_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate enum fields against YAML schema choices.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory_type: Entity type from YAML schema.</span>
<span class="sd">            payload: Memory data to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If enum field has invalid value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Entity validation happens elsewhere</span>

        <span class="c1"># Get field definitions for this entity type</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check each field in the payload</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">field_def</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>

                <span class="c1"># Check if this is an enum field</span>
                <span class="k">if</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;enum&quot;</span><span class="p">:</span>
                    <span class="n">choices</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> <span class="p">[])</span>

                    <span class="c1"># Validate the value against choices</span>
                    <span class="k">if</span> <span class="n">field_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">field_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2"> value &#39;</span><span class="si">{</span><span class="n">field_value</span><span class="si">}</span><span class="s2">&#39;. Valid choices: </span><span class="si">{</span><span class="n">choices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                                <span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span>
                                <span class="s2">&quot;invalid_value&quot;</span><span class="p">:</span> <span class="n">field_value</span><span class="p">,</span>
                                <span class="s2">&quot;valid_choices&quot;</span><span class="p">:</span> <span class="n">choices</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_memory_against_yaml</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate memory payload against YAML schema and return cleaned payload.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;memory_type is required&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;payload is required&quot;</span><span class="p">)</span>

        <span class="c1"># Strict validation - entity type MUST exist in YAML</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown entity type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;. All types must be defined in YAML schema.&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;available_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">emap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">req</span><span class="p">,</span> <span class="n">_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Validate enum fields against YAML schema choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_enum_fields</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

        <span class="c1"># Validate that all fields are defined in YAML schema</span>
        <span class="n">req</span><span class="p">,</span> <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">valid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">req</span> <span class="o">+</span> <span class="n">opt</span><span class="p">)</span>
        <span class="n">system_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_system_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">invalid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">valid_fields</span> <span class="o">-</span> <span class="n">system_fields</span>
        <span class="k">if</span> <span class="n">invalid_fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid fields not defined in schema: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;valid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">valid_fields</span><span class="p">),</span>
                    <span class="s2">&quot;invalid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Strip system-reserved fields if present</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">syskey</span> <span class="ow">in</span> <span class="n">system_fields</span><span class="p">:</span>
            <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">syskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cleaned</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_memory_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Memory object from YAML-validated payload.&quot;&quot;&quot;</span>

        <span class="c1"># Get anchor field from YAML schema</span>
        <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">memory_type</span><span class="p">)</span>

        <span class="c1"># Extract anchor text from payload</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing or invalid anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; in payload &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Validate full payload against YAML schema</span>
        <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

        <span class="c1"># Construct Memory with YAML-defined payload only</span>
        <span class="k">return</span> <span class="n">Memory</span><span class="p">(</span>
            <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">validated_payload</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Pydantic model from TypeRegistry - NO REDUNDANCY.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="memg_core.core.yaml_translator.YamlTranslator.schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">schema</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the loaded YAML schema, loading it if necessary.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">yaml_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize YamlTranslator with YAML schema path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>yaml_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If YAML path not provided or TypeRegistry initialization fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize YamlTranslator with YAML schema path.</span>

<span class="sd">    Args:</span>
<span class="sd">        yaml_path: Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If YAML path not provided or TypeRegistry initialization fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Require explicit YAML path - no silent defaults</span>
    <span class="k">if</span> <span class="n">yaml_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">yaml_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_SCHEMA&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;YAML schema path required. Set MEMG_YAML_SCHEMA environment variable &quot;</span>
                <span class="s2">&quot;or provide yaml_path parameter. No defaults allowed.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">env_path</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># NO model cache - TypeRegistry handles all caching</span>

    <span class="c1"># Initialize TypeRegistry from YAML - crash early if invalid</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">initialize_types_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize TypeRegistry from YAML: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.build_anchor_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_anchor_text</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Build anchor text for embedding from YAML-defined anchor field.</p>
<p>NO hardcoded field names - reads anchor field from YAML schema.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory object containing payload data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anchor text for embedding.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If anchor field is missing or invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_anchor_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build anchor text for embedding from YAML-defined anchor field.</span>

<span class="sd">    NO hardcoded field names - reads anchor field from YAML schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        memory: Memory object containing payload data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Anchor text for embedding.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If anchor field is missing or invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mem_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mem_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="s2">&quot;Memory object missing &#39;memory_type&#39; field&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Get anchor field from YAML schema</span>
    <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">mem_type</span><span class="p">)</span>

    <span class="c1"># Try to get anchor text from the specified field</span>
    <span class="n">anchor_text</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># First check if it&#39;s a core field on the Memory object</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">):</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Otherwise check in the payload</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">stripped_text</span> <span class="o">=</span> <span class="n">anchor_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stripped_text</span>

    <span class="c1"># Anchor field missing, empty, or invalid</span>
    <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; is missing, empty, or invalid &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">mem_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
        <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">mem_type</span><span class="p">,</span>
            <span class="s2">&quot;anchor_field&quot;</span><span class="p">:</span> <span class="n">anchor_field</span><span class="p">,</span>
            <span class="s2">&quot;anchor_value&quot;</span><span class="p">:</span> <span class="n">anchor_text</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.create_memory_from_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_memory_from_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a Memory object from YAML-validated payload.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_memory_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Memory object from YAML-validated payload.&quot;&quot;&quot;</span>

    <span class="c1"># Get anchor field from YAML schema</span>
    <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">memory_type</span><span class="p">)</span>

    <span class="c1"># Extract anchor text from payload</span>
    <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing or invalid anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; in payload &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Validate full payload against YAML schema</span>
    <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="c1"># Construct Memory with YAML-defined payload only</span>
    <span class="k">return</span> <span class="n">Memory</span><span class="p">(</span>
        <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
        <span class="n">payload</span><span class="o">=</span><span class="n">validated_payload</span><span class="p">,</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.debug_relation_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">debug_relation_map</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a nested relation map for debugging/printing.</p>
<p>Structure:
{
  source: {
    target: [ {name, predicate, directed, description} ... ]
  }
}</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">debug_relation_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a nested relation map for debugging/printing.</span>

<span class="sd">    Structure:</span>
<span class="sd">    {</span>
<span class="sd">      source: {</span>
<span class="sd">        target: [ {name, predicate, directed, description} ... ]</span>
<span class="sd">      }</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
        <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">specs</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.get_anchor_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the anchor field name for the given entity type from YAML schema.</p>
<p>Now reads from vector.anchored_to instead of separate anchor field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anchor field name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If anchor field not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_anchor_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the anchor field name for the given entity type from YAML schema.</span>

<span class="sd">    Now reads from vector.anchored_to instead of separate anchor field.</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_name: Name of the entity type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Anchor field name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If anchor field not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

    <span class="c1"># Get entity spec with inheritance resolution</span>
    <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

    <span class="c1"># Look for vector field with anchored_to</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">_field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
            <span class="n">anchored_to</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anchored_to&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">anchored_to</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">anchored_to</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; has no vector field with &#39;anchored_to&#39; property&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.get_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get Pydantic model from TypeRegistry - NO REDUNDANCY.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Pydantic model from TypeRegistry - NO REDUNDANCY.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.get_entity_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_types</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get list of available entity types from YAML schema.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of available entity types from YAML schema.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.get_labels_for_predicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_labels_for_predicates</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="n">predicates</span><span class="p">,</span> <span class="n">neighbor_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Expand predicate names to concrete relationship labels for a given source.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source entity type name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>predicates</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of predicate names to include (case-insensitive). If None, include all.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_label</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional target entity type filter (case-insensitive)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of concrete relationship labels (table names) matching the filter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_labels_for_predicates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand predicate names to concrete relationship labels for a given source.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_type: Source entity type name</span>
<span class="sd">        predicates: List of predicate names to include (case-insensitive). If None, include all.</span>
<span class="sd">        neighbor_label: Optional target entity type filter (case-insensitive)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of concrete relationship labels (table names) matching the filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty source_type&quot;</span><span class="p">)</span>

    <span class="n">preds_u</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicates</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">neighbor_l</span> <span class="o">=</span> <span class="n">neighbor_label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">preds_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preds_u</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">neighbor_l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">neighbor_l</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.get_relations_for_source" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get normalized relation specs for a source entity in target-first schema.</p>


<details class="returns-list-of-dicts-with-keys" open>
  <summary>Returns list of dicts with keys</summary>
  <ul>
<li>source (str)</li>
<li>target (str)</li>
<li>name (str | None)</li>
<li>description (str | None)</li>
<li>predicate (str)</li>
<li>directed (bool)</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_relations_for_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get normalized relation specs for a source entity in target-first schema.</span>

<span class="sd">    Returns list of dicts with keys:</span>
<span class="sd">        - source (str)</span>
<span class="sd">        - target (str)</span>
<span class="sd">        - name (str | None)</span>
<span class="sd">        - description (str | None)</span>
<span class="sd">        - predicate (str)</span>
<span class="sd">        - directed (bool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

    <span class="n">source_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">relations_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_relations_mapping_for_entity</span><span class="p">(</span><span class="n">source_l</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_map</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">out</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target_l</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">predicate</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Skip invalid entries - strict behavior can be added later</span>
                <span class="k">continue</span>
            <span class="n">directed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_l</span><span class="p">,</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target_l</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">directed</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.get_see_also_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_see_also_config</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the see_also configuration for the given entity type from YAML schema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with keys: enabled, threshold, limit, target_types</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None if see_also is not configured for this entity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_see_also_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the see_also configuration for the given entity type from YAML schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict with keys: enabled, threshold, limit, target_types</span>
<span class="sd">        None if see_also is not configured for this entity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>
    <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
    <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

    <span class="n">see_also</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;see_also&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">see_also</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Validate required fields</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)),</span>
        <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="s2">&quot;target_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_types&quot;</span><span class="p">,</span> <span class="p">[])),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.relationship_table_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">relationship_table_name</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Generate relationship table name.</p>
<p>For now, table name does not encode direction; direction affects creation/query semantics.
Canonicalization for undirected pairs can be added here later if decided.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">relationship_table_name</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># noqa: unused-argument</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate relationship table name.</span>

<span class="sd">    For now, table name does not encode direction; direction affects creation/query semantics.</span>
<span class="sd">    Canonicalization for undirected pairs can be added here later if decided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.core.yaml_translator.YamlTranslator.validate_memory_against_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate memory payload against YAML schema and return cleaned payload.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_memory_against_yaml</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate memory payload against YAML schema and return cleaned payload.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;memory_type is required&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;payload is required&quot;</span><span class="p">)</span>

    <span class="c1"># Strict validation - entity type MUST exist in YAML</span>
    <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown entity type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;. All types must be defined in YAML schema.&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                <span class="s2">&quot;available_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">emap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="n">req</span><span class="p">,</span> <span class="n">_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Validate enum fields against YAML schema choices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_enum_fields</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="c1"># Validate that all fields are defined in YAML schema</span>
    <span class="n">req</span><span class="p">,</span> <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">valid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">req</span> <span class="o">+</span> <span class="n">opt</span><span class="p">)</span>
    <span class="n">system_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_system_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">invalid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">valid_fields</span> <span class="o">-</span> <span class="n">system_fields</span>
    <span class="k">if</span> <span class="n">invalid_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid fields not defined in schema: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                <span class="s2">&quot;valid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">valid_fields</span><span class="p">),</span>
                <span class="s2">&quot;invalid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Strip system-reserved fields if present</span>
    <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">syskey</span> <span class="ow">in</span> <span class="n">system_fields</span><span class="p">:</span>
        <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">syskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cleaned</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.core.yaml_translator.YamlTranslatorError" class="doc doc-heading">
            <code>YamlTranslatorError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Error in YAML schema translation or validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.YamlTranslatorError.message">message</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error message.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.YamlTranslatorError.operation">operation</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Operation that caused the error.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.YamlTranslatorError.context">context</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional context information.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.core.yaml_translator.YamlTranslatorError.original_error">original_error</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Original exception that was wrapped.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">YamlTranslatorError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error in YAML schema translation or validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        message: Error message.</span>
<span class="sd">        operation: Operation that caused the error.</span>
<span class="sd">        context: Additional context information.</span>
<span class="sd">        original_error: Original exception that was wrapped.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.core.yaml_translator.get_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get Pydantic model for entity from global registry.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="type">type</span>[<span title="pydantic.BaseModel">BaseModel</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>type[BaseModel]: Pydantic model class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/types.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Pydantic model for entity from global registry.</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_name: Name of the entity.</span>

<span class="sd">    Returns:</span>
<span class="sd">        type[BaseModel]: Pydantic model class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TypeRegistry</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.core.yaml_translator.initialize_types_from_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_types_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize global type registry from YAML - call once at startup.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>yaml_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/types.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_types_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize global type registry from YAML - call once at startup.</span>

<span class="sd">    Args:</span>
<span class="sd">        yaml_path: Path to YAML schema file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TypeRegistry</span><span class="o">.</span><span class="n">initialize_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="utilities">Utilities</h2>
<h3 id="hrid-management">HRID Management</h3>
<p>Human-readable ID utilities:</p>


<div class="doc doc-object doc-module">



<a id="memg_core.utils.hrid"></a>
    <div class="doc doc-contents first">

        <p>HRID generator and parser for MEMG Core.</p>
<p>Format: {TYPE_UPPER}_{AAA000}
- TYPE: uppercase alphanumeric type name (no spaces)
- AAA: base26 letters Aâ€“Z (wraps after ZZZ)
- 000â€“999: numeric suffix</p>










  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="memg_core.utils.hrid._COUNTERS" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_COUNTERS</span> <span class="o">=</span> <span class="p">{}</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h2 id="memg_core.utils.hrid._HRID_RE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_HRID_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^(?P&lt;type&gt;[A-Z0-9_]+)_(?P&lt;alpha&gt;[A-Z]</span><span class="si">{3}</span><span class="s1">)(?P&lt;num&gt;</span><span class="se">\\</span><span class="s1">d</span><span class="si">{3}</span><span class="s1">)$&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

    </div>

</div>



<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.hrid.DatabaseError" class="doc doc-heading">
            <code>DatabaseError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Database operation failures (Qdrant, Kuzu).</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Database operation failures (Qdrant, Kuzu).&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.hrid._alpha_to_idx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_alpha_to_idx</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert alpha string to index: AAA -&gt; 0, AAB -&gt; 1, ..., ZZZ -&gt; 17575.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Three-letter alpha string (AAA-ZZZ).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numeric index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_alpha_to_idx</span><span class="p">(</span><span class="n">alpha</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert alpha string to index: AAA -&gt; 0, AAB -&gt; 1, ..., ZZZ -&gt; 17575.</span>

<span class="sd">    Args:</span>
<span class="sd">        alpha: Three-letter alpha string (AAA-ZZZ).</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Numeric index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="mi">26</span> <span class="o">+</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">idx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.hrid._idx_to_alpha" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_idx_to_alpha</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert index to alpha string: 0 -&gt; AAA, 1 -&gt; AAB, ..., 17575 -&gt; ZZZ.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numeric index (0-17575).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Three-letter alpha string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_idx_to_alpha</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert index to alpha string: 0 -&gt; AAA, 1 -&gt; AAB, ..., 17575 -&gt; ZZZ.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx: Numeric index (0-17575).</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Three-letter alpha string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chars</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">chars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">26</span><span class="p">))</span>
        <span class="n">idx</span> <span class="o">//=</span> <span class="mi">26</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">chars</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.hrid._initialize_counter_from_tracker" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_initialize_counter_from_tracker</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">hrid_tracker</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize counter by querying HridTracker for highest existing HRID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>type_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The memory type to check (e.g., 'note', 'task')</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for scoped HRID lookup</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hrid_tracker</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HridTracker instance to query</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int, int]: (alpha_idx, num) representing the next available counter position</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_initialize_counter_from_tracker</span><span class="p">(</span><span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hrid_tracker</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize counter by querying HridTracker for highest existing HRID.</span>

<span class="sd">    Args:</span>
<span class="sd">        type_name: The memory type to check (e.g., &#39;note&#39;, &#39;task&#39;)</span>
<span class="sd">        user_id: User ID for scoped HRID lookup</span>
<span class="sd">        hrid_tracker: HridTracker instance to query</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[int, int]: (alpha_idx, num) representing the next available counter position</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">highest</span> <span class="o">=</span> <span class="n">hrid_tracker</span><span class="o">.</span><span class="n">get_highest_hrid</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">highest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># No existing HRIDs for this type</span>

        <span class="n">_highest_hrid</span><span class="p">,</span> <span class="n">highest_alpha_idx</span><span class="p">,</span> <span class="n">highest_num</span> <span class="o">=</span> <span class="n">highest</span>

        <span class="c1"># Return the next position after the highest found</span>
        <span class="n">next_num</span> <span class="o">=</span> <span class="n">highest_num</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">next_num</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">:</span>
            <span class="n">next_num</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">highest_alpha_idx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">highest_alpha_idx</span><span class="p">,</span>
            <span class="n">next_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># -1 because generate_hrid will increment</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># DO NOT FALL BACK SILENTLY - this causes duplicate HRID bugs!</span>
        <span class="c1"># If we can&#39;t initialize from existing data, the system should fail fast</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to initialize HRID counter for type &#39;</span><span class="si">{</span><span class="n">type_name</span><span class="si">}</span><span class="s2">&#39; from existing data. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;This is critical - cannot generate HRIDs without knowing existing ones.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;initialize_counter_from_tracker&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type_name&quot;</span><span class="p">:</span> <span class="n">type_name</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.hrid.generate_hrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_hrid</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">hrid_tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the next HRID for the given type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>type_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The memory type (e.g., 'note', 'task').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for scoped HRID generation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hrid_tracker</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional HridTracker instance for querying existing HRIDs.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The next HRID in format TYPE_AAA000.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Uses HridTracker to query HridMapping table for existing HRIDs.</li>
<li>Falls back to in-memory counter if no tracker provided.</li>
<li>Ensures no duplicates by checking complete HRID history.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_hrid</span><span class="p">(</span><span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hrid_tracker</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate the next HRID for the given type.</span>

<span class="sd">    Args:</span>
<span class="sd">        type_name: The memory type (e.g., &#39;note&#39;, &#39;task&#39;).</span>
<span class="sd">        user_id: User ID for scoped HRID generation.</span>
<span class="sd">        hrid_tracker: Optional HridTracker instance for querying existing HRIDs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The next HRID in format TYPE_AAA000.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Uses HridTracker to query HridMapping table for existing HRIDs.</span>
<span class="sd">        - Falls back to in-memory counter if no tracker provided.</span>
<span class="sd">        - Ensures no duplicates by checking complete HRID history.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">type_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="c1"># Initialize counter from HridTracker on first use of this type+user combination</span>
    <span class="n">counter_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">counter_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_COUNTERS</span> <span class="ow">and</span> <span class="n">hrid_tracker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_COUNTERS</span><span class="p">[</span><span class="n">counter_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_initialize_counter_from_tracker</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">hrid_tracker</span><span class="p">)</span>

    <span class="c1"># Get current counter or default to fresh start</span>
    <span class="n">alpha_idx</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">_COUNTERS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">counter_key</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">999</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">alpha_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">alpha_idx</span> <span class="o">&gt;</span> <span class="mi">26</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HRID space exhausted for type </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">_COUNTERS</span><span class="p">[</span><span class="n">counter_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha_idx</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_idx_to_alpha</span><span class="p">(</span><span class="n">alpha_idx</span><span class="p">)</span><span class="si">}{</span><span class="n">num</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.hrid.parse_hrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_hrid</span><span class="p">(</span><span class="n">hrid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse HRID into (type, alpha, num).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HRID string to parse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[str, str, int]: (type, alpha, num) components.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If HRID format is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_hrid</span><span class="p">(</span><span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse HRID into (type, alpha, num).</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: HRID string to parse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, str, int]: (type, alpha, num) components.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If HRID format is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_HRID_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid HRID format: </span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="memg_core.utils.hrid_tracker"></a>
    <div class="doc doc-contents first">

        <p>HRID Tracker: UUID â†” HRID translation and lifecycle management.</p>
<p>Handles all HRID mapping operations using the existing KuzuInterface.
Provides transparent translation between user-facing HRIDs and internal UUIDs.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.hrid_tracker.DatabaseError" class="doc doc-heading">
            <code>DatabaseError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Database operation failures (Qdrant, Kuzu).</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Database operation failures (Qdrant, Kuzu).&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.hrid_tracker.HridTracker" class="doc doc-heading">
            <code>HridTracker</code>


</h2>


    <div class="doc doc-contents ">


        <p>Manages HRID â†” UUID mappings using KuzuInterface.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.hrid_tracker.HridTracker.kuzu">kuzu</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-configured Kuzu interface for database operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HridTracker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages HRID â†” UUID mappings using KuzuInterface.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        kuzu: Pre-configured Kuzu interface for database operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kuzu_interface</span><span class="p">:</span> <span class="n">KuzuInterface</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize with existing KuzuInterface.</span>

<span class="sd">        Args:</span>
<span class="sd">            kuzu_interface: Pre-configured Kuzu interface for database operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span> <span class="o">=</span> <span class="n">kuzu_interface</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate HRID to UUID.</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Human-readable ID (e.g., &#39;TASK_AAA001&#39;).</span>
<span class="sd">            user_id: User ID for scoped lookup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: UUID string for internal operations.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If HRID not found or is deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MATCH (m:HridMapping {hrid: $hrid, user_id: $user_id})</span>
<span class="s2">            WHERE m.deleted_at IS NULL</span>
<span class="s2">            RETURN m.uuid as uuid</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39; not found or has been deleted&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_uuid&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uuid&quot;</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to lookup UUID for HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_uuid&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_hrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate UUID to HRID with user verification.</span>

<span class="sd">        Args:</span>
<span class="sd">            uuid: Internal UUID.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Human-readable ID string.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If UUID not found, deleted, or doesn&#39;t belong to user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MATCH (m:HridMapping {uuid: $uuid, user_id: $user_id})</span>
<span class="s2">            WHERE m.deleted_at IS NULL</span>
<span class="s2">            RETURN m.hrid as hrid</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;UUID &#39;</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; not found or has been deleted&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_hrid&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hrid&quot;</span><span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to lookup HRID for UUID &#39;</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_hrid&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new HRID â†” UUID mapping.</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Human-readable ID.</span>
<span class="sd">            uuid: Internal UUID.</span>
<span class="sd">            memory_type: Entity type (e.g., &#39;task&#39;, &#39;note&#39;).</span>
<span class="sd">            user_id: User ID for scoped mapping.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If mapping creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

            <span class="n">mapping_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;hrid_user_key&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Composite key</span>
                <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span>
                <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
                <span class="s2">&quot;deleted_at&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># NULL for active mappings</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;HridMapping&quot;</span><span class="p">,</span> <span class="n">mapping_data</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create HRID mapping: </span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;create_mapping&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mark_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark HRID mapping as deleted (soft delete)</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Human-readable ID to mark as deleted</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If marking as deleted fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MATCH (m:HridMapping {hrid: $hrid})</span>
<span class="s2">            SET m.deleted_at = $deleted_at</span>
<span class="s2">            RETURN m.hrid as hrid</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;deleted_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39; not found for deletion&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;mark_deleted&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to mark HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39; as deleted&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;mark_deleted&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_highest_hrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get highest HRID for a memory type (for generation).</span>

<span class="sd">        Args:</span>
<span class="sd">            memory_type: Entity type to check (case insensitive).</span>
<span class="sd">            user_id: User ID for scoped HRID lookup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[str, int, int] | None: (hrid, alpha_idx, num) or None if no HRIDs exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Normalize to lowercase for database query (YAML types are lowercase)</span>
            <span class="n">normalized_type</span> <span class="o">=</span> <span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MATCH (m:HridMapping {memory_type: $memory_type, user_id: $user_id})</span>
<span class="s2">            RETURN m.hrid as hrid</span>
<span class="s2">            ORDER BY m.created_at DESC</span>
<span class="s2">            LIMIT 1000</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">normalized_type</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Find the highest HRID by parsing all results</span>
            <span class="n">highest_hrid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">highest_alpha_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">highest_num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">hrid</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;hrid&quot;</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># TODO: parsed_type available for future use (e.g., type validation)</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">parse_hrid</span><span class="p">(</span><span class="n">hrid</span><span class="p">)</span>
                    <span class="n">alpha_idx</span> <span class="o">=</span> <span class="n">_alpha_to_idx</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">alpha_idx</span> <span class="o">&gt;</span> <span class="n">highest_alpha_idx</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">alpha_idx</span> <span class="o">==</span> <span class="n">highest_alpha_idx</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="n">highest_num</span>
                    <span class="p">):</span>
                        <span class="n">highest_alpha_idx</span> <span class="o">=</span> <span class="n">alpha_idx</span>
                        <span class="n">highest_num</span> <span class="o">=</span> <span class="n">num</span>
                        <span class="n">highest_hrid</span> <span class="o">=</span> <span class="n">hrid</span>

                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">continue</span>  <span class="c1"># Skip invalid HRIDs</span>

            <span class="k">if</span> <span class="n">highest_hrid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">highest_hrid</span><span class="p">,</span> <span class="n">highest_alpha_idx</span><span class="p">,</span> <span class="n">highest_num</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to get highest HRID for type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39; and user &#39;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_highest_hrid&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if HRID exists (active, not deleted).</span>

<span class="sd">        Args:</span>
<span class="sd">            hrid: Human-readable ID to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if HRID exists and is active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MATCH (m:HridMapping {hrid: $hrid})</span>
<span class="s2">            WHERE m.deleted_at IS NULL</span>
<span class="s2">            RETURN COUNT(m) as count</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">results</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Assume doesn&#39;t exist on any error</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.HridTracker.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">kuzu_interface</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize with existing KuzuInterface.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kuzu_interface</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="KuzuInterface (memg_core.core.interfaces.kuzu.KuzuInterface)" href="#memg_core.utils.hrid_tracker.KuzuInterface">KuzuInterface</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-configured Kuzu interface for database operations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kuzu_interface</span><span class="p">:</span> <span class="n">KuzuInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize with existing KuzuInterface.</span>

<span class="sd">    Args:</span>
<span class="sd">        kuzu_interface: Pre-configured Kuzu interface for database operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span> <span class="o">=</span> <span class="n">kuzu_interface</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.HridTracker.create_mapping" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_mapping</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create new HRID â†” UUID mapping.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal UUID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type (e.g., 'task', 'note').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for scoped mapping.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If mapping creation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create new HRID â†” UUID mapping.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable ID.</span>
<span class="sd">        uuid: Internal UUID.</span>
<span class="sd">        memory_type: Entity type (e.g., &#39;task&#39;, &#39;note&#39;).</span>
<span class="sd">        user_id: User ID for scoped mapping.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If mapping creation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="n">mapping_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;hrid_user_key&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Composite key</span>
            <span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span>
            <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span>
            <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">,</span>
            <span class="s2">&quot;deleted_at&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># NULL for active mappings</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;HridMapping&quot;</span><span class="p">,</span> <span class="n">mapping_data</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to create HRID mapping: </span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2"> â†’ </span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;create_mapping&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.HridTracker.exists" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="n">hrid</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if HRID exists (active, not deleted).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if HRID exists and is active.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if HRID exists (active, not deleted).</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable ID to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if HRID exists and is active.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        MATCH (m:HridMapping {hrid: $hrid})</span>
<span class="s2">        WHERE m.deleted_at IS NULL</span>
<span class="s2">        RETURN COUNT(m) as count</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">results</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Assume doesn&#39;t exist on any error</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.HridTracker.get_highest_hrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_highest_hrid</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get highest HRID for a memory type (for generation).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Entity type to check (case insensitive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for scoped HRID lookup.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="str">str</span>, <span title="int">int</span>, <span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[str, int, int] | None: (hrid, alpha_idx, num) or None if no HRIDs exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_highest_hrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get highest HRID for a memory type (for generation).</span>

<span class="sd">    Args:</span>
<span class="sd">        memory_type: Entity type to check (case insensitive).</span>
<span class="sd">        user_id: User ID for scoped HRID lookup.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, int, int] | None: (hrid, alpha_idx, num) or None if no HRIDs exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Normalize to lowercase for database query (YAML types are lowercase)</span>
        <span class="n">normalized_type</span> <span class="o">=</span> <span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        MATCH (m:HridMapping {memory_type: $memory_type, user_id: $user_id})</span>
<span class="s2">        RETURN m.hrid as hrid</span>
<span class="s2">        ORDER BY m.created_at DESC</span>
<span class="s2">        LIMIT 1000</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">normalized_type</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Find the highest HRID by parsing all results</span>
        <span class="n">highest_hrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">highest_alpha_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">highest_num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">hrid</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;hrid&quot;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># TODO: parsed_type available for future use (e.g., type validation)</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">parse_hrid</span><span class="p">(</span><span class="n">hrid</span><span class="p">)</span>
                <span class="n">alpha_idx</span> <span class="o">=</span> <span class="n">_alpha_to_idx</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">alpha_idx</span> <span class="o">&gt;</span> <span class="n">highest_alpha_idx</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">alpha_idx</span> <span class="o">==</span> <span class="n">highest_alpha_idx</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="n">highest_num</span>
                <span class="p">):</span>
                    <span class="n">highest_alpha_idx</span> <span class="o">=</span> <span class="n">alpha_idx</span>
                    <span class="n">highest_num</span> <span class="o">=</span> <span class="n">num</span>
                    <span class="n">highest_hrid</span> <span class="o">=</span> <span class="n">hrid</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c1"># Skip invalid HRIDs</span>

        <span class="k">if</span> <span class="n">highest_hrid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">highest_hrid</span><span class="p">,</span> <span class="n">highest_alpha_idx</span><span class="p">,</span> <span class="n">highest_num</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to get highest HRID for type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39; and user &#39;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_highest_hrid&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.HridTracker.get_hrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_hrid</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Translate UUID to HRID with user verification.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal UUID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If UUID not found, deleted, or doesn't belong to user.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_hrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translate UUID to HRID with user verification.</span>

<span class="sd">    Args:</span>
<span class="sd">        uuid: Internal UUID.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Human-readable ID string.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If UUID not found, deleted, or doesn&#39;t belong to user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        MATCH (m:HridMapping {uuid: $uuid, user_id: $user_id})</span>
<span class="s2">        WHERE m.deleted_at IS NULL</span>
<span class="s2">        RETURN m.hrid as hrid</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;UUID &#39;</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39; not found or has been deleted&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_hrid&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;hrid&quot;</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to lookup HRID for UUID &#39;</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_hrid&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">uuid</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.HridTracker.get_uuid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_uuid</span><span class="p">(</span><span class="n">hrid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Translate HRID to UUID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID (e.g., 'TASK_AAA001').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for scoped lookup.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UUID string for internal operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If HRID not found or is deleted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translate HRID to UUID.</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable ID (e.g., &#39;TASK_AAA001&#39;).</span>
<span class="sd">        user_id: User ID for scoped lookup.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: UUID string for internal operations.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If HRID not found or is deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        MATCH (m:HridMapping {hrid: $hrid, user_id: $user_id})</span>
<span class="s2">        WHERE m.deleted_at IS NULL</span>
<span class="s2">        RETURN m.uuid as uuid</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39; not found or has been deleted&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_uuid&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;uuid&quot;</span><span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to lookup UUID for HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_uuid&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.HridTracker.mark_deleted" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mark_deleted</span><span class="p">(</span><span class="n">hrid</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Mark HRID mapping as deleted (soft delete)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable ID to mark as deleted</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If marking as deleted fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid_tracker.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mark_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark HRID mapping as deleted (soft delete)</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: Human-readable ID to mark as deleted</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If marking as deleted fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">UTC</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        MATCH (m:HridMapping {hrid: $hrid})</span>
<span class="s2">        SET m.deleted_at = $deleted_at</span>
<span class="s2">        RETURN m.hrid as hrid</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">,</span> <span class="s2">&quot;deleted_at&quot;</span><span class="p">:</span> <span class="n">now</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39; not found for deletion&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;mark_deleted&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to mark HRID &#39;</span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&#39; as deleted&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;mark_deleted&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hrid&quot;</span><span class="p">:</span> <span class="n">hrid</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.hrid_tracker.KuzuInterface" class="doc doc-heading">
            <code>KuzuInterface</code>


</h2>


    <div class="doc doc-contents ">


        <p>Pure CRUD wrapper around Kuzu database - NO DDL operations.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.hrid_tracker.KuzuInterface.conn">conn</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized Kuzu connection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.hrid_tracker.KuzuInterface.yaml_translator">yaml_translator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional YAML translator for relationship operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KuzuInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pure CRUD wrapper around Kuzu database - NO DDL operations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        conn: Pre-initialized Kuzu connection.</span>
<span class="sd">        yaml_translator: Optional YAML translator for relationship operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">,</span> <span class="n">yaml_translator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize with pre-created connection.</span>

<span class="sd">        Args:</span>
<span class="sd">            connection: Pre-initialized Kuzu connection from DatabaseClients.</span>
<span class="sd">            yaml_translator: Optional YamlTranslator for relationship operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">yaml_translator</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a node to the graph - pure CRUD operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Node table name.</span>
<span class="sd">            properties: Node properties.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If node creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CREATE (:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="si">{</span><span class="n">props</span><span class="si">}</span><span class="se">}}</span><span class="s2">)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to add node to </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_node</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a node in the graph - pure CRUD operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Node table name.</span>
<span class="sd">            node_uuid: UUID of the node to update.</span>
<span class="sd">            properties: Node properties to update.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if update succeeded, False if node not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If node update fails due to system error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
            <span class="n">check_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="c1"># Node doesn&#39;t exist for this user</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Build SET clause for properties</span>
            <span class="n">set_clauses</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Skip system fields that shouldn&#39;t be updated via this method</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;prop_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">set_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_clauses</span><span class="p">:</span>
                <span class="c1"># No properties to update (all were system fields)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># Execute update query</span>
            <span class="n">set_clause</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">set_clauses</span><span class="p">)</span>
            <span class="n">update_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) SET </span><span class="si">{</span><span class="n">set_clause</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">update_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to update node in </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                    <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">,</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">props</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add relationship between nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_table: Source node table name.</span>
<span class="sd">            to_table: Target node table name.</span>
<span class="sd">            rel_type: Relationship type.</span>
<span class="sd">            from_id: Source node ID.</span>
<span class="sd">            to_id: Target node ID.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            props: Optional relationship properties.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If relationship creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span> <span class="ow">or</span> <span class="p">{}</span>

            <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Use relationship type as-is (predicates from YAML) - no sanitization</span>
            <span class="c1"># rel_type should already be a valid predicate (e.g., &quot;REFERENCED_BY&quot;, &quot;ANNOTATES&quot;)</span>

            <span class="c1"># CRITICAL: Verify both nodes belong to the user before creating relationship</span>
            <span class="c1"># First check if both nodes exist and belong to the user</span>
            <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
            <span class="p">)</span>
            <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot create relationship: one or both memories not found &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;or don&#39;t belong to user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Generate relationship table name using YamlTranslator</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                        <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                        <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
                <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
            <span class="p">)</span>

            <span class="c1"># Now create the relationship using the unique table name</span>
            <span class="n">prop_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="k">if</span> <span class="n">props</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">rel_props</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="se">{{</span><span class="si">{</span><span class="n">prop_str</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">prop_str</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">create_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;CREATE (a)-[:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}{</span><span class="n">rel_props</span><span class="si">}</span><span class="s2">]-&gt;(b)&quot;</span>
            <span class="p">)</span>
            <span class="n">create_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="o">**</span><span class="n">props</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">create_params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to add relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                    <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete relationship between nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_table: Source node table name.</span>
<span class="sd">            to_table: Target node table name.</span>
<span class="sd">            rel_type: Relationship type.</span>
<span class="sd">            from_id: Source node ID.</span>
<span class="sd">            to_id: Target node ID.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion succeeded, False if relationship not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If relationship deletion fails due to system error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># CRITICAL: Verify both nodes belong to the user before deleting relationship</span>
            <span class="c1"># First check if both nodes exist and belong to the user</span>
            <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
            <span class="p">)</span>
            <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="c1"># Nodes don&#39;t exist or don&#39;t belong to user - return False (not found)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Generate relationship table name using YamlTranslator</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                        <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                        <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
                <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
            <span class="p">)</span>

            <span class="c1"># First check if the relationship exists</span>
            <span class="n">check_rel_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;RETURN r&quot;</span>
            <span class="p">)</span>
            <span class="n">check_rel_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

            <span class="c1"># Check if relationship exists</span>
            <span class="n">relationship_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_rel_query</span><span class="p">,</span> <span class="n">check_rel_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_exists</span><span class="p">:</span>
                <span class="c1"># Relationship doesn&#39;t exist - return False</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Delete the specific relationship (we know it exists)</span>
            <span class="n">delete_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;DELETE r&quot;</span>
            <span class="p">)</span>
            <span class="n">delete_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

            <span class="c1"># Execute deletion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">delete_params</span><span class="p">)</span>

            <span class="c1"># If we get here, deletion succeeded</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># Re-raise validation errors as-is</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to delete relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                    <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract results from Kuzu QueryResult using raw iteration.</span>

<span class="sd">        Args:</span>
<span class="sd">            query_result: Kuzu QueryResult object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of dictionaries containing query results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Type annotations disabled for QueryResult - dynamic interface from kuzu package</span>
        <span class="n">qr</span> <span class="o">=</span> <span class="n">query_result</span>  <span class="c1"># type: ignore</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">qr</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">qr</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">qr</span><span class="o">.</span><span class="n">get_next</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column_names</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cypher</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute Cypher query and return results.</span>

<span class="sd">        Args:</span>
<span class="sd">            cypher: Cypher query string.</span>
<span class="sd">            params: Query parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Query results.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If query execution fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">qr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="p">{})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query_results</span><span class="p">(</span><span class="n">qr</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to execute Kuzu query&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cypher&quot;</span><span class="p">:</span> <span class="n">cypher</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">neighbors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rel_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch neighbors of a node by UUID only.</span>

<span class="sd">        Args:</span>
<span class="sd">            node_label: Node type/table name (e.g., &quot;Memory&quot;, &quot;bug&quot;) - NOT a UUID.</span>
<span class="sd">            node_uuid: UUID of the specific node to find neighbors for.</span>
<span class="sd">            user_id: User ID for isolation - only return neighbors belonging to this user.</span>
<span class="sd">            rel_types: List of relationship types to filter by.</span>
<span class="sd">            direction: &quot;in&quot;, &quot;out&quot;, or &quot;any&quot; for relationship direction.</span>
<span class="sd">            limit: Maximum number of neighbors to return.</span>
<span class="sd">            neighbor_label: Type of neighbor nodes to return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of neighbor nodes with relationship info.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If node_label is a UUID or node_uuid is not a UUID.</span>
<span class="sd">            DatabaseError: If neighbor query fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate parameters to prevent common bugs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_label</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;node_label must be a node type (e.g., &#39;Memory&#39;, &#39;bug&#39;), not UUID: </span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;UUIDs should be passed as node_uuid parameter.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_uuid</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;node_uuid must be a valid UUID format, got: </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use YamlTranslator to expand predicates to concrete relationship labels</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;YamlTranslator required for neighbor operations&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span> <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Get concrete relationship labels for this source and predicates</span>
            <span class="k">if</span> <span class="n">rel_types</span><span class="p">:</span>
                <span class="n">relationship_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_labels_for_predicates</span><span class="p">(</span>
                    <span class="n">source_type</span><span class="o">=</span><span class="n">node_label</span><span class="p">,</span>
                    <span class="n">predicates</span><span class="o">=</span><span class="n">rel_types</span><span class="p">,</span>
                    <span class="n">neighbor_label</span><span class="o">=</span><span class="n">neighbor_label</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_labels</span><span class="p">:</span>
                    <span class="c1"># No matching relationships found - return empty</span>
                    <span class="k">return</span> <span class="p">[]</span>

                <span class="c1"># Create relationship pattern with specific labels</span>
                <span class="n">rel_filter</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relationship_labels</span><span class="p">)</span>
                <span class="n">rel_part</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">rel_filter</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No filtering - match all relationships</span>
                <span class="n">rel_part</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="c1"># CRITICAL: User isolation - both source node and neighbors must belong to user</span>
            <span class="n">node_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;a:</span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $node_uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>
            <span class="n">neighbor</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">neighbor_label</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">neighbor_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>

            <span class="c1"># Build direction-aware pattern</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-&gt;(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)&lt;-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>

            <span class="c1"># Return neighbors only if they belong to the same user</span>
            <span class="n">cypher</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MATCH </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span>
<span class="s2">            RETURN DISTINCT n.id as id,</span>
<span class="s2">                            n.user_id as user_id,</span>
<span class="s2">                            n.memory_type as memory_type,</span>
<span class="s2">                            n.created_at as created_at,</span>
<span class="s2">                            label(r) as rel_type,</span>
<span class="s2">                            n as node</span>
<span class="s2">            LIMIT $limit</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">}</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to fetch neighbors&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span>
                    <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                    <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">,</span>
                    <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="n">direction</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a single node by UUID&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
            <span class="n">cypher_check</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_check</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="c1"># Node doesn&#39;t exist for this user, consider it successfully &quot;deleted&quot;</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># Delete the node - only if it belongs to the user</span>
            <span class="n">cypher_delete_node</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) DELETE n&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">cypher_delete_node</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;delete undirected rel&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span> <span class="ow">or</span> <span class="s2">&quot;relationship&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="c1"># Relationship constraint prevents deletion - this is a REAL FAILURE</span>
                <span class="c1"># Don&#39;t lie by returning True - raise explicit error</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot delete node </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">: has existing relationships. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Delete relationships first or use CASCADE delete if supported.&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                        <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                        <span class="s2">&quot;constraint_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="p">},</span>
                    <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># Other database error</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to delete node from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">node_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get multiple nodes with filtering and pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            node_type: Optional node type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">            filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;}).</span>
<span class="sd">            limit: Maximum number of nodes to return.</span>
<span class="sd">            offset: Number of nodes to skip for pagination.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of node data from Kuzu.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If node retrieval fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">{}</span>

            <span class="c1"># Build MATCH clause</span>
            <span class="k">if</span> <span class="n">node_type</span><span class="p">:</span>
                <span class="n">match_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">match_clause</span> <span class="o">=</span> <span class="s2">&quot;MATCH (n {user_id: $user_id&quot;</span>

            <span class="c1"># Add field filters</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;filter_</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">match_clause</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_value</span>

            <span class="n">match_clause</span> <span class="o">+=</span> <span class="s2">&quot;})&quot;</span>

            <span class="c1"># Build complete query</span>
            <span class="n">cypher_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            </span><span class="si">{</span><span class="n">match_clause</span><span class="si">}</span>
<span class="s2">            RETURN n.id as id,</span>
<span class="s2">                   n.user_id as user_id,</span>
<span class="s2">                   n.memory_type as memory_type,</span>
<span class="s2">                   n.created_at as created_at,</span>
<span class="s2">                   n.updated_at as updated_at,</span>
<span class="s2">                   n as node</span>
<span class="s2">            ORDER BY n.created_at DESC</span>
<span class="s2">            SKIP $offset</span>
<span class="s2">            LIMIT $limit</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get nodes from Kuzu&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_nodes&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                    <span class="s2">&quot;node_type&quot;</span><span class="p">:</span> <span class="n">node_type</span><span class="p">,</span>
                    <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">,</span>
                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_kuzu_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map Python types to Kuzu types with proper validation.</span>

<span class="sd">        Args:</span>
<span class="sd">            key: Property key name.</span>
<span class="sd">            value: Property value to type-check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Kuzu type name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If the Python type is not supported by Kuzu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="c1"># Check bool first (bool is subclass of int in Python!)</span>
            <span class="k">return</span> <span class="s2">&quot;BOOLEAN&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;INT64&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;DOUBLE&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;STRING&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># None values need special handling - default to STRING for now</span>
            <span class="k">return</span> <span class="s2">&quot;STRING&quot;</span>
        <span class="c1"># Unsupported type - fail explicitly instead of silent STRING conversion</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unsupported property type for key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Supported types: str, int, float, bool. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Complex types must be serialized before storage.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_get_kuzu_type&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if string looks like a UUID (36 chars with hyphens in right positions).</span>

<span class="sd">        Args:</span>
<span class="sd">            value: String to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if value matches UUID format (8-4-4-4-12 hex pattern), False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">36</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># UUID format: 8-4-4-4-12 (e.g., 550e8400-e29b-41d4-a716-446655440000)</span>
        <span class="n">uuid_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^[0-9a-f]</span><span class="si">{8}</span><span class="s2">-[0-9a-f]</span><span class="si">{4}</span><span class="s2">-[0-9a-f]</span><span class="si">{4}</span><span class="s2">-[0-9a-f]</span><span class="si">{4}</span><span class="s2">-[0-9a-f]</span><span class="si">{12}</span><span class="s2">$&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">uuid_pattern</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">yaml_translator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize with pre-created connection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>connection</code>
            </td>
            <td>
                  <code><span title="kuzu.Connection">Connection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized Kuzu connection from DatabaseClients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>yaml_translator</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional YamlTranslator for relationship operations.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">,</span> <span class="n">yaml_translator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize with pre-created connection.</span>

<span class="sd">    Args:</span>
<span class="sd">        connection: Pre-initialized Kuzu connection from DatabaseClients.</span>
<span class="sd">        yaml_translator: Optional YamlTranslator for relationship operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">yaml_translator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.add_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_node</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a node to the graph - pure CRUD operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node properties.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node creation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a node to the graph - pure CRUD operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Node table name.</span>
<span class="sd">        properties: Node properties.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If node creation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CREATE (:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="si">{</span><span class="n">props</span><span class="si">}</span><span class="se">}}</span><span class="s2">)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to add node to </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_node&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.add_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_relationship</span><span class="p">(</span><span class="n">from_table</span><span class="p">,</span> <span class="n">to_table</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">,</span> <span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add relationship between nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rel_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>props</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional relationship properties.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If relationship creation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">props</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add relationship between nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_table: Source node table name.</span>
<span class="sd">        to_table: Target node table name.</span>
<span class="sd">        rel_type: Relationship type.</span>
<span class="sd">        from_id: Source node ID.</span>
<span class="sd">        to_id: Target node ID.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        props: Optional relationship properties.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If relationship creation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">props</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Use relationship type as-is (predicates from YAML) - no sanitization</span>
        <span class="c1"># rel_type should already be a valid predicate (e.g., &quot;REFERENCED_BY&quot;, &quot;ANNOTATES&quot;)</span>

        <span class="c1"># CRITICAL: Verify both nodes belong to the user before creating relationship</span>
        <span class="c1"># First check if both nodes exist and belong to the user</span>
        <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
        <span class="p">)</span>
        <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot create relationship: one or both memories not found &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;or don&#39;t belong to user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Generate relationship table name using YamlTranslator</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
            <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
        <span class="p">)</span>

        <span class="c1"># Now create the relationship using the unique table name</span>
        <span class="n">prop_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="k">if</span> <span class="n">props</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">rel_props</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="se">{{</span><span class="si">{</span><span class="n">prop_str</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">prop_str</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">create_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;CREATE (a)-[:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}{</span><span class="n">rel_props</span><span class="si">}</span><span class="s2">]-&gt;(b)&quot;</span>
        <span class="p">)</span>
        <span class="n">create_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
            <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">props</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">create_params</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to add relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.delete_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_node</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a single node by UUID</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a single node by UUID&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
        <span class="n">cypher_check</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_check</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="c1"># Node doesn&#39;t exist for this user, consider it successfully &quot;deleted&quot;</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Delete the node - only if it belongs to the user</span>
        <span class="n">cypher_delete_node</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) DELETE n&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">cypher_delete_node</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;delete undirected rel&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span> <span class="ow">or</span> <span class="s2">&quot;relationship&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="c1"># Relationship constraint prevents deletion - this is a REAL FAILURE</span>
            <span class="c1"># Don&#39;t lie by returning True - raise explicit error</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot delete node </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">: has existing relationships. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Delete relationships first or use CASCADE delete if supported.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                    <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;constraint_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="c1"># Other database error</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to delete node from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.delete_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_relationship</span><span class="p">(</span><span class="n">from_table</span><span class="p">,</span> <span class="n">to_table</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">,</span> <span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete relationship between nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rel_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded, False if relationship not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If relationship deletion fails due to system error.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete relationship between nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_table: Source node table name.</span>
<span class="sd">        to_table: Target node table name.</span>
<span class="sd">        rel_type: Relationship type.</span>
<span class="sd">        from_id: Source node ID.</span>
<span class="sd">        to_id: Target node ID.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded, False if relationship not found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If relationship deletion fails due to system error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># CRITICAL: Verify both nodes belong to the user before deleting relationship</span>
        <span class="c1"># First check if both nodes exist and belong to the user</span>
        <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
        <span class="p">)</span>
        <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="c1"># Nodes don&#39;t exist or don&#39;t belong to user - return False (not found)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Generate relationship table name using YamlTranslator</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
            <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
        <span class="p">)</span>

        <span class="c1"># First check if the relationship exists</span>
        <span class="n">check_rel_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;RETURN r&quot;</span>
        <span class="p">)</span>
        <span class="n">check_rel_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

        <span class="c1"># Check if relationship exists</span>
        <span class="n">relationship_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_rel_query</span><span class="p">,</span> <span class="n">check_rel_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_exists</span><span class="p">:</span>
            <span class="c1"># Relationship doesn&#39;t exist - return False</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Delete the specific relationship (we know it exists)</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;DELETE r&quot;</span>
        <span class="p">)</span>
        <span class="n">delete_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

        <span class="c1"># Execute deletion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">delete_params</span><span class="p">)</span>

        <span class="c1"># If we get here, deletion succeeded</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Re-raise validation errors as-is</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to delete relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.get_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nodes</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">node_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get multiple nodes with filtering and pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional node type filter (e.g., "task", "note").</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional field filters (e.g., {"status": "open"}).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of nodes to return.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes to skip for pagination.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of node data from Kuzu.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node retrieval fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nodes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">node_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get multiple nodes with filtering and pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        node_type: Optional node type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">        filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;}).</span>
<span class="sd">        limit: Maximum number of nodes to return.</span>
<span class="sd">        offset: Number of nodes to skip for pagination.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of node data from Kuzu.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If node retrieval fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Build MATCH clause</span>
        <span class="k">if</span> <span class="n">node_type</span><span class="p">:</span>
            <span class="n">match_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">match_clause</span> <span class="o">=</span> <span class="s2">&quot;MATCH (n {user_id: $user_id&quot;</span>

        <span class="c1"># Add field filters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;filter_</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">match_clause</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_value</span>

        <span class="n">match_clause</span> <span class="o">+=</span> <span class="s2">&quot;})&quot;</span>

        <span class="c1"># Build complete query</span>
        <span class="n">cypher_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="n">match_clause</span><span class="si">}</span>
<span class="s2">        RETURN n.id as id,</span>
<span class="s2">               n.user_id as user_id,</span>
<span class="s2">               n.memory_type as memory_type,</span>
<span class="s2">               n.created_at as created_at,</span>
<span class="s2">               n.updated_at as updated_at,</span>
<span class="s2">               n as node</span>
<span class="s2">        ORDER BY n.created_at DESC</span>
<span class="s2">        SKIP $offset</span>
<span class="s2">        LIMIT $limit</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to get nodes from Kuzu&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_nodes&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s2">&quot;node_type&quot;</span><span class="p">:</span> <span class="n">node_type</span><span class="p">,</span>
                <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">,</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.neighbors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">neighbors</span><span class="p">(</span><span class="n">node_label</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">rel_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">neighbor_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fetch neighbors of a node by UUID only.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_label</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node type/table name (e.g., "Memory", "bug") - NOT a UUID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UUID of the specific node to find neighbors for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for isolation - only return neighbors belonging to this user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rel_types</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of relationship types to filter by.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"in", "out", or "any" for relationship direction.</p>
              </div>
            </td>
            <td>
                  <code>&#39;any&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of neighbors to return.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_label</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of neighbor nodes to return.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of neighbor nodes with relationship info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node_label is a UUID or node_uuid is not a UUID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If neighbor query fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">neighbors</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">node_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rel_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch neighbors of a node by UUID only.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_label: Node type/table name (e.g., &quot;Memory&quot;, &quot;bug&quot;) - NOT a UUID.</span>
<span class="sd">        node_uuid: UUID of the specific node to find neighbors for.</span>
<span class="sd">        user_id: User ID for isolation - only return neighbors belonging to this user.</span>
<span class="sd">        rel_types: List of relationship types to filter by.</span>
<span class="sd">        direction: &quot;in&quot;, &quot;out&quot;, or &quot;any&quot; for relationship direction.</span>
<span class="sd">        limit: Maximum number of neighbors to return.</span>
<span class="sd">        neighbor_label: Type of neighbor nodes to return.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of neighbor nodes with relationship info.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If node_label is a UUID or node_uuid is not a UUID.</span>
<span class="sd">        DatabaseError: If neighbor query fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate parameters to prevent common bugs</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_label</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;node_label must be a node type (e.g., &#39;Memory&#39;, &#39;bug&#39;), not UUID: </span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;UUIDs should be passed as node_uuid parameter.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_uuid</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;node_uuid must be a valid UUID format, got: </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use YamlTranslator to expand predicates to concrete relationship labels</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YamlTranslator required for neighbor operations&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span> <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Get concrete relationship labels for this source and predicates</span>
        <span class="k">if</span> <span class="n">rel_types</span><span class="p">:</span>
            <span class="n">relationship_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_labels_for_predicates</span><span class="p">(</span>
                <span class="n">source_type</span><span class="o">=</span><span class="n">node_label</span><span class="p">,</span>
                <span class="n">predicates</span><span class="o">=</span><span class="n">rel_types</span><span class="p">,</span>
                <span class="n">neighbor_label</span><span class="o">=</span><span class="n">neighbor_label</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_labels</span><span class="p">:</span>
                <span class="c1"># No matching relationships found - return empty</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Create relationship pattern with specific labels</span>
            <span class="n">rel_filter</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relationship_labels</span><span class="p">)</span>
            <span class="n">rel_part</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">rel_filter</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No filtering - match all relationships</span>
            <span class="n">rel_part</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># CRITICAL: User isolation - both source node and neighbors must belong to user</span>
        <span class="n">node_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;a:</span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $node_uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="n">neighbor</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">neighbor_label</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">neighbor_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>

        <span class="c1"># Build direction-aware pattern</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-&gt;(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)&lt;-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># Return neighbors only if they belong to the same user</span>
        <span class="n">cypher</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        MATCH </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span>
<span class="s2">        RETURN DISTINCT n.id as id,</span>
<span class="s2">                        n.user_id as user_id,</span>
<span class="s2">                        n.memory_type as memory_type,</span>
<span class="s2">                        n.created_at as created_at,</span>
<span class="s2">                        label(r) as rel_type,</span>
<span class="s2">                        n as node</span>
<span class="s2">        LIMIT $limit</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to fetch neighbors&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span>
                <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="n">direction</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Execute Cypher query and return results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cypher</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cypher query string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: Query results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If query execution fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cypher</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute Cypher query and return results.</span>

<span class="sd">    Args:</span>
<span class="sd">        cypher: Cypher query string.</span>
<span class="sd">        params: Query parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: Query results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If query execution fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">qr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query_results</span><span class="p">(</span><span class="n">qr</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to execute Kuzu query&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cypher&quot;</span><span class="p">:</span> <span class="n">cypher</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.hrid_tracker.KuzuInterface.update_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_node</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update a node in the graph - pure CRUD operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UUID of the node to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node properties to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if update succeeded, False if node not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node update fails due to system error.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_node</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a node in the graph - pure CRUD operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Node table name.</span>
<span class="sd">        node_uuid: UUID of the node to update.</span>
<span class="sd">        properties: Node properties to update.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if update succeeded, False if node not found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If node update fails due to system error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
        <span class="n">check_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="c1"># Node doesn&#39;t exist for this user</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Build SET clause for properties</span>
        <span class="n">set_clauses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Skip system fields that shouldn&#39;t be updated via this method</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;prop_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">set_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">set_clauses</span><span class="p">:</span>
            <span class="c1"># No properties to update (all were system fields)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Execute update query</span>
        <span class="n">set_clause</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">set_clauses</span><span class="p">)</span>
        <span class="n">update_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) SET </span><span class="si">{</span><span class="n">set_clause</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">update_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to update node in </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_node&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.hrid_tracker._alpha_to_idx" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_alpha_to_idx</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert alpha string to index: AAA -&gt; 0, AAB -&gt; 1, ..., ZZZ -&gt; 17575.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Three-letter alpha string (AAA-ZZZ).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Numeric index.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_alpha_to_idx</span><span class="p">(</span><span class="n">alpha</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert alpha string to index: AAA -&gt; 0, AAB -&gt; 1, ..., ZZZ -&gt; 17575.</span>

<span class="sd">    Args:</span>
<span class="sd">        alpha: Three-letter alpha string (AAA-ZZZ).</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Numeric index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">alpha</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">*</span> <span class="mi">26</span> <span class="o">+</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">idx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.hrid_tracker.parse_hrid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_hrid</span><span class="p">(</span><span class="n">hrid</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parse HRID into (type, alpha, num).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hrid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HRID string to parse.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[str, str, int]: (type, alpha, num) components.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If HRID format is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/hrid.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_hrid</span><span class="p">(</span><span class="n">hrid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse HRID into (type, alpha, num).</span>

<span class="sd">    Args:</span>
<span class="sd">        hrid: HRID string to parse.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, str, int]: (type, alpha, num) components.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If HRID format is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_HRID_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">hrid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid HRID format: </span><span class="si">{</span><span class="n">hrid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="database-clients">Database Clients</h3>
<p>Database client utilities:</p>


<div class="doc doc-object doc-module">



<a id="memg_core.utils.db_clients"></a>
    <div class="doc doc-contents first">

        <p>Database client management - thin layer for explicit database setup.</p>
<p>User controls database paths. No fallbacks. No automation.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.db_clients.DatabaseClients" class="doc doc-heading">
            <code>DatabaseClients</code>


</h2>


    <div class="doc doc-contents ">


        <p>DDL-only database setup - creates schemas and returns raw clients.</p>
<p>NO INTERFACES - pure schema creation only.
Consumer must create interfaces separately using returned raw clients.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.DatabaseClients.qdrant_client">qdrant_client</span></code></td>
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized QdrantClient.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.DatabaseClients.kuzu_connection">kuzu_connection</span></code></td>
            <td>
                  <code><span title="kuzu.Connection">Connection</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized Kuzu connection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.DatabaseClients.db_name">db_name</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.DatabaseClients.qdrant_path">qdrant_path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to Qdrant database.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.DatabaseClients.kuzu_path">kuzu_path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to Kuzu database.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.DatabaseClients.yaml_translator">yaml_translator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>YAML translator instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseClients</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DDL-only database setup - creates schemas and returns raw clients.</span>

<span class="sd">    NO INTERFACES - pure schema creation only.</span>
<span class="sd">    Consumer must create interfaces separately using returned raw clients.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        qdrant_client: Pre-initialized QdrantClient.</span>
<span class="sd">        kuzu_connection: Pre-initialized Kuzu connection.</span>
<span class="sd">        db_name: Database name.</span>
<span class="sd">        qdrant_path: Path to Qdrant database.</span>
<span class="sd">        kuzu_path: Path to Kuzu database.</span>
<span class="sd">        yaml_translator: YAML translator instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create DDL-only database client wrapper.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml_path: Path to YAML schema file. User must provide - no defaults.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">:</span> <span class="n">QdrantClient</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Set during init_dbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="s2">&quot;qdrant&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="s2">&quot;kuzu&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">YamlTranslator</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">yaml_path</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_dbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize databases with structured paths.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_path: Base database directory.</span>
<span class="sd">            db_name: Database name (used for collection and file names).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Structure paths</span>
        <span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;qdrant&quot;</span><span class="p">)</span>
        <span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;kuzu&quot;</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span>

        <span class="c1"># Store paths and names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">qdrant_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">kuzu_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="n">db_name</span>

        <span class="c1"># Ensure directories exist</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">qdrant_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Create raw database clients directly</span>
        <span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">qdrant_path</span><span class="p">)</span>
        <span class="n">kuzu_db</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span>
        <span class="n">kuzu_conn</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">kuzu_db</span><span class="p">)</span>

        <span class="c1"># Store raw clients for interface creation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">qdrant_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="n">kuzu_conn</span>

        <span class="c1"># DDL operations - create collection and tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_qdrant_collection</span><span class="p">(</span><span class="n">qdrant_client</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_kuzu_tables_with_graph_register</span><span class="p">(</span><span class="n">kuzu_conn</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_qdrant_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Qdrant collection if it doesn&#39;t exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            client: Qdrant client instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If collection creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
            <span class="n">vector_dimension</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">vector_dimension</span>
            <span class="n">collection_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span>

            <span class="n">collections</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_collections</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">collection_name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">collections</span><span class="o">.</span><span class="n">collections</span><span class="p">):</span>
                <span class="n">client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
                    <span class="n">vectors_config</span><span class="o">=</span><span class="n">VectorParams</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">vector_dimension</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="n">Distance</span><span class="o">.</span><span class="n">COSINE</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to setup Qdrant collection&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_setup_qdrant_collection&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_kuzu_tables_with_graph_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create Kuzu tables using GraphRegister for DDL generation.</span>

<span class="sd">        Args:</span>
<span class="sd">            conn: Kuzu database connection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If YAML translator not initialized or table creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YAML translator not initialized. Provide yaml_path to constructor.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_setup_kuzu_tables_with_graph_register&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create GraphRegister with YamlTranslator for complete DDL generation</span>
            <span class="n">graph_register</span> <span class="o">=</span> <span class="n">GraphRegister</span><span class="p">(</span><span class="n">yaml_translator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>

            <span class="c1"># Generate all DDL statements using GraphRegister</span>
            <span class="n">ddl_statements</span> <span class="o">=</span> <span class="n">graph_register</span><span class="o">.</span><span class="n">generate_all_ddl</span><span class="p">()</span>

            <span class="c1"># Execute all DDL statements</span>
            <span class="k">for</span> <span class="n">ddl</span> <span class="ow">in</span> <span class="n">ddl_statements</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">ddl</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to setup Kuzu tables using GraphRegister&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_setup_kuzu_tables_with_graph_register&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># ===== INTERFACE ACCESS METHODS =====</span>
    <span class="c1"># After DDL operations, provide access to CRUD interfaces</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_qdrant_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QdrantInterface</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Qdrant interface using the initialized client.</span>

<span class="sd">        Returns:</span>
<span class="sd">            QdrantInterface: Configured with the DDL-created client and collection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If client not initialized (call init_dbs first).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Qdrant client not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_qdrant_interface&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">QdrantInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_kuzu_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KuzuInterface</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Kuzu interface using the initialized connection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            KuzuInterface: Configured with the DDL-created connection.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If connection not initialized (call init_dbs first).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Kuzu connection not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_kuzu_interface&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">KuzuInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_embedder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Embedder</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get embedder instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Embedder: Instance for generating vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Embedder</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_yaml_translator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">YamlTranslator</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the YAML translator used for schema operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            YamlTranslator: Instance used during DDL operations.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If YAML translator not initialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YAML translator not initialized. Provide yaml_path to constructor.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_yaml_translator&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Close all database connections and cleanup resources.</span>

<span class="sd">        Should be called when database clients are no longer needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
                <span class="c1"># Ignore cleanup errors - best effort</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
                <span class="c1"># Ignore cleanup errors - best effort</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.DatabaseClients.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">yaml_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create DDL-only database client wrapper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>yaml_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file. User must provide - no defaults.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create DDL-only database client wrapper.</span>

<span class="sd">    Args:</span>
<span class="sd">        yaml_path: Path to YAML schema file. User must provide - no defaults.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">:</span> <span class="n">QdrantClient</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Set during init_dbs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="s2">&quot;qdrant&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="s2">&quot;kuzu&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">YamlTranslator</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">yaml_path</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.DatabaseClients.close" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">close</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Close all database connections and cleanup resources.</p>
<p>Should be called when database clients are no longer needed.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Close all database connections and cleanup resources.</span>

<span class="sd">    Should be called when database clients are no longer needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="c1"># Ignore cleanup errors - best effort</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="c1"># Ignore cleanup errors - best effort</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.DatabaseClients.get_embedder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_embedder</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get embedder instance.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Embedder</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Embedder (memg_core.core.interfaces.embedder.Embedder)" href="#memg_core.utils.db_clients.Embedder">Embedder</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instance for generating vectors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_embedder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Embedder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get embedder instance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Embedder: Instance for generating vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Embedder</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.DatabaseClients.get_kuzu_interface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_kuzu_interface</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get Kuzu interface using the initialized connection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>KuzuInterface</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="KuzuInterface (memg_core.core.interfaces.kuzu.KuzuInterface)" href="#memg_core.utils.hrid_tracker.KuzuInterface">KuzuInterface</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured with the DDL-created connection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If connection not initialized (call init_dbs first).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_kuzu_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KuzuInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Kuzu interface using the initialized connection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        KuzuInterface: Configured with the DDL-created connection.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If connection not initialized (call init_dbs first).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Kuzu connection not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_kuzu_interface&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">KuzuInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.DatabaseClients.get_qdrant_interface" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_qdrant_interface</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get Qdrant interface using the initialized client.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>QdrantInterface</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="QdrantInterface (memg_core.core.interfaces.qdrant.QdrantInterface)" href="#memg_core.utils.db_clients.QdrantInterface">QdrantInterface</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured with the DDL-created client and collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If client not initialized (call init_dbs first).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_qdrant_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QdrantInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Qdrant interface using the initialized client.</span>

<span class="sd">    Returns:</span>
<span class="sd">        QdrantInterface: Configured with the DDL-created client and collection.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If client not initialized (call init_dbs first).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Qdrant client not initialized. Call init_dbs() first.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_qdrant_interface&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">QdrantInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">qdrant_collection_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.DatabaseClients.get_yaml_translator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_yaml_translator</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the YAML translator used for schema operations.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>YamlTranslator</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslator (memg_core.core.yaml_translator.YamlTranslator)" href="#memg_core.core.yaml_translator.YamlTranslator">YamlTranslator</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instance used during DDL operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If YAML translator not initialized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_yaml_translator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">YamlTranslator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the YAML translator used for schema operations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        YamlTranslator: Instance used during DDL operations.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If YAML translator not initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;YAML translator not initialized. Provide yaml_path to constructor.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_yaml_translator&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.DatabaseClients.init_dbs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_dbs</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize databases with structured paths.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base database directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>db_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Database name (used for collection and file names).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/db_clients.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_dbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize databases with structured paths.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_path: Base database directory.</span>
<span class="sd">        db_name: Database name (used for collection and file names).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Structure paths</span>
    <span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;qdrant&quot;</span><span class="p">)</span>
    <span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">db_path</span><span class="p">,</span> <span class="s2">&quot;kuzu&quot;</span><span class="p">,</span> <span class="n">db_name</span><span class="p">)</span>

    <span class="c1"># Store paths and names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_path</span> <span class="o">=</span> <span class="n">qdrant_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_path</span> <span class="o">=</span> <span class="n">kuzu_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="n">db_name</span>

    <span class="c1"># Ensure directories exist</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">qdrant_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create raw database clients directly</span>
    <span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">QdrantClient</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">qdrant_path</span><span class="p">)</span>
    <span class="n">kuzu_db</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">kuzu_path</span><span class="p">)</span>
    <span class="n">kuzu_conn</span> <span class="o">=</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="n">kuzu_db</span><span class="p">)</span>

    <span class="c1"># Store raw clients for interface creation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qdrant_client</span> <span class="o">=</span> <span class="n">qdrant_client</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kuzu_connection</span> <span class="o">=</span> <span class="n">kuzu_conn</span>

    <span class="c1"># DDL operations - create collection and tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_qdrant_collection</span><span class="p">(</span><span class="n">qdrant_client</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_kuzu_tables_with_graph_register</span><span class="p">(</span><span class="n">kuzu_conn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.db_clients.DatabaseError" class="doc doc-heading">
            <code>DatabaseError</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="MemorySystemError (memg_core.core.exceptions.MemorySystemError)" href="#memg_core.core.exceptions.MemorySystemError">MemorySystemError</a></code></p>


        <p>Database operation failures (Qdrant, Kuzu).</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/exceptions.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatabaseError</span><span class="p">(</span><span class="n">MemorySystemError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Database operation failures (Qdrant, Kuzu).&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.db_clients.Embedder" class="doc doc-heading">
            <code>Embedder</code>


</h2>


    <div class="doc doc-contents ">


        <p>Local embedder using FastEmbed - no API keys required.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.Embedder.model_name">model_name</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the embedding model being used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.Embedder.model">model</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>FastEmbed TextEmbedding instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/interfaces/embedder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Embedder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Local embedder using FastEmbed - no API keys required.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        model_name: Name of the embedding model being used.</span>
<span class="sd">        model: FastEmbed TextEmbedding instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the FastEmbed embedder.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name: Model to use. Defaults to config or snowflake-arctic-embed-xs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get model name from config system (which reads env) or use provided override</span>
        <span class="k">if</span> <span class="n">model_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use config system which handles env variable EMBEDDER_MODEL</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">embedder_model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">TextEmbedding</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get embedding for a single text.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Text to embed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[float]: Embedding vector.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If FastEmbed returns empty embedding.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># FastEmbed returns a generator, so we need to extract the first result</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embed</span><span class="p">([</span><span class="n">text</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">embeddings</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;FastEmbed returned empty embedding&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get embeddings for multiple texts.</span>

<span class="sd">        Args:</span>
<span class="sd">            texts: List of texts to embed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[list[float]]: List of embedding vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">texts</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">emb</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">emb</span> <span class="ow">in</span> <span class="n">embeddings</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.Embedder.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the FastEmbed embedder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model to use. Defaults to config or snowflake-arctic-embed-xs.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/embedder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the FastEmbed embedder.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name: Model to use. Defaults to config or snowflake-arctic-embed-xs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get model name from config system (which reads env) or use provided override</span>
    <span class="k">if</span> <span class="n">model_name</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use config system which handles env variable EMBEDDER_MODEL</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">memg</span><span class="o">.</span><span class="n">embedder_model</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">TextEmbedding</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.Embedder.get_embedding" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get embedding for a single text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to embed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[float]: Embedding vector.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If FastEmbed returns empty embedding.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/embedder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get embedding for a single text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Text to embed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[float]: Embedding vector.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If FastEmbed returns empty embedding.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># FastEmbed returns a generator, so we need to extract the first result</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embed</span><span class="p">([</span><span class="n">text</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">embeddings</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">embeddings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;FastEmbed returned empty embedding&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.Embedder.get_embeddings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_embeddings</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get embeddings for multiple texts.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>texts</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of texts to embed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="list">list</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[list[float]]: List of embedding vectors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/embedder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get embeddings for multiple texts.</span>

<span class="sd">    Args:</span>
<span class="sd">        texts: List of texts to embed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[list[float]]: List of embedding vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">texts</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">emb</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">emb</span> <span class="ow">in</span> <span class="n">embeddings</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.db_clients.GraphRegister" class="doc doc-heading">
            <code>GraphRegister</code>


</h2>


    <div class="doc doc-contents ">


        <p>Generates DDL statements for graph databases using TypeRegistry.</p>
<p>Database-agnostic design - generates DDL that can be adapted for:
- Kuzu (current)
- Neo4j (future)
- ArangoDB (future)
- Any graph database with node/relationship tables</p>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/utils/graph_register.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GraphRegister</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates DDL statements for graph databases using TypeRegistry.</span>

<span class="sd">    Database-agnostic design - generates DDL that can be adapted for:</span>
<span class="sd">    - Kuzu (current)</span>
<span class="sd">    - Neo4j (future)</span>
<span class="sd">    - ArangoDB (future)</span>
<span class="sd">    - Any graph database with node/relationship tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">type_registry</span><span class="p">:</span> <span class="n">TypeRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">yaml_translator</span><span class="p">:</span> <span class="n">YamlTranslator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize GraphRegister with TypeRegistry and YamlTranslator.</span>

<span class="sd">        Args:</span>
<span class="sd">            type_registry: TypeRegistry instance. If None, uses global singleton.</span>
<span class="sd">            yaml_translator: YamlTranslator for accessing full YAML schema. Optional.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span> <span class="o">=</span> <span class="n">type_registry</span> <span class="ow">or</span> <span class="n">TypeRegistry</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">yaml_translator</span>

        <span class="c1"># Validate TypeRegistry is properly initialized</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_valid_entity_names</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;TypeRegistry not initialized. Call initialize_types_from_yaml() first.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;graph_register_init&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_entity_table_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate DDL for a single entity table.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_name: Name of entity type (e.g., &#39;task&#39;, &#39;bug&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            DDL string for creating the entity table</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If entity not found in TypeRegistry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate entity exists in TypeRegistry</span>
        <span class="n">valid_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_valid_entity_names</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">entity_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_entities</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in TypeRegistry&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;generate_entity_table_ddl&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;entity_name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">,</span> <span class="s2">&quot;valid_entities&quot;</span><span class="p">:</span> <span class="n">valid_entities</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Get Pydantic model with all fields (inheritance already resolved)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

        <span class="c1"># Build column definitions from Pydantic model fields</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">system_field_names</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
            <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">_field_info</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">model_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Skip system fields - they&#39;ll be added separately</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">system_field_names</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># All user fields are STRING for now (Kuzu limitation)</span>
            <span class="c1"># TODO: Add proper type mapping when Kuzu supports more types</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2"> STRING&quot;</span><span class="p">)</span>

        <span class="c1"># Add system fields (not in YAML schema)</span>
        <span class="n">system_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;id STRING&quot;</span><span class="p">,</span>
            <span class="s2">&quot;user_id STRING&quot;</span><span class="p">,</span>
            <span class="s2">&quot;memory_type STRING&quot;</span><span class="p">,</span>
            <span class="s2">&quot;created_at STRING&quot;</span><span class="p">,</span>
            <span class="s2">&quot;updated_at STRING&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">all_columns</span> <span class="o">=</span> <span class="n">system_columns</span> <span class="o">+</span> <span class="n">columns</span>
        <span class="n">columns_sql</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">                &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_columns</span><span class="p">)</span>

        <span class="c1"># Generate Kuzu-style DDL (adaptable for other graph DBs)</span>
        <span class="n">ddl</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;CREATE NODE TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">(</span>
<span class="s2">                </span><span class="si">{</span><span class="n">columns_sql</span><span class="si">}</span><span class="s2">,</span>
<span class="s2">                PRIMARY KEY (id)</span>
<span class="s2">        )&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">ddl</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_all_entity_tables_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate DDL for all entity tables from TypeRegistry.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of DDL strings, one per entity table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ddl_statements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">entity_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_valid_entity_names</span><span class="p">():</span>
            <span class="n">ddl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_entity_table_ddl</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
            <span class="n">ddl_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ddl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ddl_statements</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_relationship_tables_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate DDL for relationship tables from YAML schema using YamlTranslator.</span>

<span class="sd">        Uses YamlTranslator to discover relations and centralized table naming.</span>
<span class="sd">        Handles directed/undirected semantics for table creation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of DDL strings for relationship tables</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If YamlTranslator not provided or schema access fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="c1"># Return empty list if no YamlTranslator - maintains compatibility</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">ddl_statements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">created_tables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Track unique table names to avoid duplicates</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use YamlTranslator to discover all relations across all entities</span>
            <span class="k">for</span> <span class="n">entity_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
                <span class="n">relation_specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">relation_specs</span><span class="p">:</span>
                    <span class="c1"># Validate predicate against TypeRegistry</span>
                    <span class="n">predicate</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">predicate</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Invalid predicate &#39;</span><span class="si">{</span><span class="n">predicate</span><span class="si">}</span><span class="s2">&#39; not found in TypeRegistry&quot;</span><span class="p">,</span>
                            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;generate_relationship_tables_ddl&quot;</span><span class="p">,</span>
                            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="s2">&quot;spec&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="p">},</span>
                        <span class="p">)</span>

                    <span class="c1"># Generate table name using centralized helper</span>
                    <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                        <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                        <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                        <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                        <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
                    <span class="p">)</span>

                    <span class="c1"># Skip if we&#39;ve already created this table</span>
                    <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">created_tables</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">created_tables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

                    <span class="c1"># Create DDL - direction affects semantics but not table structure</span>
                    <span class="n">ddl</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;CREATE REL TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">(</span>
<span class="s2">                        FROM </span><span class="si">{</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2"> TO </span><span class="si">{</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">                    )&quot;&quot;&quot;</span>
                    <span class="n">ddl_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ddl</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to generate relationship tables DDL&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;generate_relationship_tables_ddl&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">return</span> <span class="n">ddl_statements</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_hrid_mapping_table_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate DDL for HRID mapping table (system table).</span>

<span class="sd">        Returns:</span>
<span class="sd">            DDL string for HRID mapping table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ddl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CREATE NODE TABLE IF NOT EXISTS HridMapping(</span>
<span class="s2">            hrid_user_key STRING,</span>
<span class="s2">            hrid STRING,</span>
<span class="s2">            uuid STRING,</span>
<span class="s2">            memory_type STRING,</span>
<span class="s2">            user_id STRING,</span>
<span class="s2">            created_at STRING,</span>
<span class="s2">            deleted_at STRING,</span>
<span class="s2">            PRIMARY KEY (hrid_user_key)</span>
<span class="s2">        )&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">ddl</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_all_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate all DDL statements for complete schema setup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of all DDL statements needed for schema creation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ddl_statements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Entity tables</span>
        <span class="n">ddl_statements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_all_entity_tables_ddl</span><span class="p">())</span>

        <span class="c1"># Relationship tables</span>
        <span class="n">ddl_statements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_relationship_tables_ddl</span><span class="p">())</span>

        <span class="c1"># System tables</span>
        <span class="n">ddl_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_hrid_mapping_table_ddl</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ddl_statements</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.GraphRegister.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">type_registry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yaml_translator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize GraphRegister with TypeRegistry and YamlTranslator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>type_registry</code>
            </td>
            <td>
                  <code><span title="memg_core.core.types.TypeRegistry">TypeRegistry</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TypeRegistry instance. If None, uses global singleton.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>yaml_translator</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslator (memg_core.core.yaml_translator.YamlTranslator)" href="#memg_core.core.yaml_translator.YamlTranslator">YamlTranslator</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>YamlTranslator for accessing full YAML schema. Optional.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/graph_register.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">type_registry</span><span class="p">:</span> <span class="n">TypeRegistry</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">yaml_translator</span><span class="p">:</span> <span class="n">YamlTranslator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize GraphRegister with TypeRegistry and YamlTranslator.</span>

<span class="sd">    Args:</span>
<span class="sd">        type_registry: TypeRegistry instance. If None, uses global singleton.</span>
<span class="sd">        yaml_translator: YamlTranslator for accessing full YAML schema. Optional.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span> <span class="o">=</span> <span class="n">type_registry</span> <span class="ow">or</span> <span class="n">TypeRegistry</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">yaml_translator</span>

    <span class="c1"># Validate TypeRegistry is properly initialized</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_valid_entity_names</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;TypeRegistry not initialized. Call initialize_types_from_yaml() first.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;graph_register_init&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.GraphRegister.generate_all_ddl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_all_ddl</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate all DDL statements for complete schema setup.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of all DDL statements needed for schema creation</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/graph_register.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_all_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate all DDL statements for complete schema setup.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of all DDL statements needed for schema creation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ddl_statements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Entity tables</span>
    <span class="n">ddl_statements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_all_entity_tables_ddl</span><span class="p">())</span>

    <span class="c1"># Relationship tables</span>
    <span class="n">ddl_statements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_relationship_tables_ddl</span><span class="p">())</span>

    <span class="c1"># System tables</span>
    <span class="n">ddl_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_hrid_mapping_table_ddl</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">ddl_statements</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.GraphRegister.generate_all_entity_tables_ddl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_all_entity_tables_ddl</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate DDL for all entity tables from TypeRegistry.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of DDL strings, one per entity table</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/graph_register.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_all_entity_tables_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate DDL for all entity tables from TypeRegistry.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of DDL strings, one per entity table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ddl_statements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">entity_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_valid_entity_names</span><span class="p">():</span>
        <span class="n">ddl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_entity_table_ddl</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
        <span class="n">ddl_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ddl</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ddl_statements</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.GraphRegister.generate_entity_table_ddl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_entity_table_ddl</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate DDL for a single entity table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of entity type (e.g., 'task', 'bug')</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DDL string for creating the entity table</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If entity not found in TypeRegistry</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/graph_register.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_entity_table_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate DDL for a single entity table.</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_name: Name of entity type (e.g., &#39;task&#39;, &#39;bug&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        DDL string for creating the entity table</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If entity not found in TypeRegistry</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate entity exists in TypeRegistry</span>
    <span class="n">valid_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_valid_entity_names</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">entity_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_entities</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in TypeRegistry&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;generate_entity_table_ddl&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;entity_name&quot;</span><span class="p">:</span> <span class="n">entity_name</span><span class="p">,</span> <span class="s2">&quot;valid_entities&quot;</span><span class="p">:</span> <span class="n">valid_entities</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Get Pydantic model with all fields (inheritance already resolved)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

    <span class="c1"># Build column definitions from Pydantic model fields</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">system_field_names</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at&quot;</span><span class="p">,</span>
        <span class="s2">&quot;updated_at&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">_field_info</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">model_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Skip system fields - they&#39;ll be added separately</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">system_field_names</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># All user fields are STRING for now (Kuzu limitation)</span>
        <span class="c1"># TODO: Add proper type mapping when Kuzu supports more types</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2"> STRING&quot;</span><span class="p">)</span>

    <span class="c1"># Add system fields (not in YAML schema)</span>
    <span class="n">system_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;id STRING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;user_id STRING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;memory_type STRING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at STRING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;updated_at STRING&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">all_columns</span> <span class="o">=</span> <span class="n">system_columns</span> <span class="o">+</span> <span class="n">columns</span>
    <span class="n">columns_sql</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">                &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_columns</span><span class="p">)</span>

    <span class="c1"># Generate Kuzu-style DDL (adaptable for other graph DBs)</span>
    <span class="n">ddl</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;CREATE NODE TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">(</span>
<span class="s2">            </span><span class="si">{</span><span class="n">columns_sql</span><span class="si">}</span><span class="s2">,</span>
<span class="s2">            PRIMARY KEY (id)</span>
<span class="s2">    )&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">ddl</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.GraphRegister.generate_hrid_mapping_table_ddl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_hrid_mapping_table_ddl</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate DDL for HRID mapping table (system table).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DDL string for HRID mapping table</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/graph_register.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_hrid_mapping_table_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate DDL for HRID mapping table (system table).</span>

<span class="sd">    Returns:</span>
<span class="sd">        DDL string for HRID mapping table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ddl</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CREATE NODE TABLE IF NOT EXISTS HridMapping(</span>
<span class="s2">        hrid_user_key STRING,</span>
<span class="s2">        hrid STRING,</span>
<span class="s2">        uuid STRING,</span>
<span class="s2">        memory_type STRING,</span>
<span class="s2">        user_id STRING,</span>
<span class="s2">        created_at STRING,</span>
<span class="s2">        deleted_at STRING,</span>
<span class="s2">        PRIMARY KEY (hrid_user_key)</span>
<span class="s2">    )&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">ddl</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.GraphRegister.generate_relationship_tables_ddl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_relationship_tables_ddl</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate DDL for relationship tables from YAML schema using YamlTranslator.</p>
<p>Uses YamlTranslator to discover relations and centralized table naming.
Handles directed/undirected semantics for table creation.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of DDL strings for relationship tables</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If YamlTranslator not provided or schema access fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/utils/graph_register.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_relationship_tables_ddl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate DDL for relationship tables from YAML schema using YamlTranslator.</span>

<span class="sd">    Uses YamlTranslator to discover relations and centralized table naming.</span>
<span class="sd">    Handles directed/undirected semantics for table creation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of DDL strings for relationship tables</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If YamlTranslator not provided or schema access fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
        <span class="c1"># Return empty list if no YamlTranslator - maintains compatibility</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">ddl_statements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">created_tables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Track unique table names to avoid duplicates</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use YamlTranslator to discover all relations across all entities</span>
        <span class="k">for</span> <span class="n">entity_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
            <span class="n">relation_specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">relation_specs</span><span class="p">:</span>
                <span class="c1"># Validate predicate against TypeRegistry</span>
                <span class="n">predicate</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">predicate</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Invalid predicate &#39;</span><span class="si">{</span><span class="n">predicate</span><span class="si">}</span><span class="s2">&#39; not found in TypeRegistry&quot;</span><span class="p">,</span>
                        <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;generate_relationship_tables_ddl&quot;</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="p">,</span> <span class="s2">&quot;spec&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="p">},</span>
                    <span class="p">)</span>

                <span class="c1"># Generate table name using centralized helper</span>
                <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                    <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                    <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="c1"># Skip if we&#39;ve already created this table</span>
                <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">created_tables</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">created_tables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

                <span class="c1"># Create DDL - direction affects semantics but not table structure</span>
                <span class="n">ddl</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;CREATE REL TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">(</span>
<span class="s2">                    FROM </span><span class="si">{</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2"> TO </span><span class="si">{</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">                )&quot;&quot;&quot;</span>
                <span class="n">ddl_statements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ddl</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to generate relationship tables DDL&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;generate_relationship_tables_ddl&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">return</span> <span class="n">ddl_statements</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.db_clients.KuzuInterface" class="doc doc-heading">
            <code>KuzuInterface</code>


</h2>


    <div class="doc doc-contents ">


        <p>Pure CRUD wrapper around Kuzu database - NO DDL operations.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.KuzuInterface.conn">conn</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized Kuzu connection.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.KuzuInterface.yaml_translator">yaml_translator</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional YAML translator for relationship operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KuzuInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pure CRUD wrapper around Kuzu database - NO DDL operations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        conn: Pre-initialized Kuzu connection.</span>
<span class="sd">        yaml_translator: Optional YAML translator for relationship operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">,</span> <span class="n">yaml_translator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize with pre-created connection.</span>

<span class="sd">        Args:</span>
<span class="sd">            connection: Pre-initialized Kuzu connection from DatabaseClients.</span>
<span class="sd">            yaml_translator: Optional YamlTranslator for relationship operations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">yaml_translator</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a node to the graph - pure CRUD operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Node table name.</span>
<span class="sd">            properties: Node properties.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If node creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CREATE (:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="si">{</span><span class="n">props</span><span class="si">}</span><span class="se">}}</span><span class="s2">)&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to add node to </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_node</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a node in the graph - pure CRUD operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Node table name.</span>
<span class="sd">            node_uuid: UUID of the node to update.</span>
<span class="sd">            properties: Node properties to update.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if update succeeded, False if node not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If node update fails due to system error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
            <span class="n">check_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="c1"># Node doesn&#39;t exist for this user</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Build SET clause for properties</span>
            <span class="n">set_clauses</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Skip system fields that shouldn&#39;t be updated via this method</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;prop_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">set_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">set_clauses</span><span class="p">:</span>
                <span class="c1"># No properties to update (all were system fields)</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># Execute update query</span>
            <span class="n">set_clause</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">set_clauses</span><span class="p">)</span>
            <span class="n">update_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) SET </span><span class="si">{</span><span class="n">set_clause</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">update_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to update node in </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                    <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">,</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">props</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add relationship between nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_table: Source node table name.</span>
<span class="sd">            to_table: Target node table name.</span>
<span class="sd">            rel_type: Relationship type.</span>
<span class="sd">            from_id: Source node ID.</span>
<span class="sd">            to_id: Target node ID.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            props: Optional relationship properties.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If relationship creation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">props</span> <span class="ow">or</span> <span class="p">{}</span>

            <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Use relationship type as-is (predicates from YAML) - no sanitization</span>
            <span class="c1"># rel_type should already be a valid predicate (e.g., &quot;REFERENCED_BY&quot;, &quot;ANNOTATES&quot;)</span>

            <span class="c1"># CRITICAL: Verify both nodes belong to the user before creating relationship</span>
            <span class="c1"># First check if both nodes exist and belong to the user</span>
            <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
            <span class="p">)</span>
            <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot create relationship: one or both memories not found &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;or don&#39;t belong to user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Generate relationship table name using YamlTranslator</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                        <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                        <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
                <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
            <span class="p">)</span>

            <span class="c1"># Now create the relationship using the unique table name</span>
            <span class="n">prop_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="k">if</span> <span class="n">props</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">rel_props</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="se">{{</span><span class="si">{</span><span class="n">prop_str</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">prop_str</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">create_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;CREATE (a)-[:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}{</span><span class="n">rel_props</span><span class="si">}</span><span class="s2">]-&gt;(b)&quot;</span>
            <span class="p">)</span>
            <span class="n">create_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="o">**</span><span class="n">props</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">create_params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to add relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                    <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete relationship between nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            from_table: Source node table name.</span>
<span class="sd">            to_table: Target node table name.</span>
<span class="sd">            rel_type: Relationship type.</span>
<span class="sd">            from_id: Source node ID.</span>
<span class="sd">            to_id: Target node ID.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion succeeded, False if relationship not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If relationship deletion fails due to system error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># CRITICAL: Verify both nodes belong to the user before deleting relationship</span>
            <span class="c1"># First check if both nodes exist and belong to the user</span>
            <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
            <span class="p">)</span>
            <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="c1"># Nodes don&#39;t exist or don&#39;t belong to user - return False (not found)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Generate relationship table name using YamlTranslator</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                        <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                        <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">)</span>

            <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
                <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
            <span class="p">)</span>

            <span class="c1"># First check if the relationship exists</span>
            <span class="n">check_rel_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;RETURN r&quot;</span>
            <span class="p">)</span>
            <span class="n">check_rel_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

            <span class="c1"># Check if relationship exists</span>
            <span class="n">relationship_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_rel_query</span><span class="p">,</span> <span class="n">check_rel_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_exists</span><span class="p">:</span>
                <span class="c1"># Relationship doesn&#39;t exist - return False</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Delete the specific relationship (we know it exists)</span>
            <span class="n">delete_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;DELETE r&quot;</span>
            <span class="p">)</span>
            <span class="n">delete_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

            <span class="c1"># Execute deletion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">delete_params</span><span class="p">)</span>

            <span class="c1"># If we get here, deletion succeeded</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1"># Re-raise validation errors as-is</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to delete relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                    <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                    <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_query_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract results from Kuzu QueryResult using raw iteration.</span>

<span class="sd">        Args:</span>
<span class="sd">            query_result: Kuzu QueryResult object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of dictionaries containing query results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Type annotations disabled for QueryResult - dynamic interface from kuzu package</span>
        <span class="n">qr</span> <span class="o">=</span> <span class="n">query_result</span>  <span class="c1"># type: ignore</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">column_names</span> <span class="o">=</span> <span class="n">qr</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">qr</span><span class="o">.</span><span class="n">has_next</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">qr</span><span class="o">.</span><span class="n">get_next</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">column_names</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cypher</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute Cypher query and return results.</span>

<span class="sd">        Args:</span>
<span class="sd">            cypher: Cypher query string.</span>
<span class="sd">            params: Query parameters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Query results.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If query execution fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">qr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="p">{})</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query_results</span><span class="p">(</span><span class="n">qr</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to execute Kuzu query&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cypher&quot;</span><span class="p">:</span> <span class="n">cypher</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">neighbors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">rel_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch neighbors of a node by UUID only.</span>

<span class="sd">        Args:</span>
<span class="sd">            node_label: Node type/table name (e.g., &quot;Memory&quot;, &quot;bug&quot;) - NOT a UUID.</span>
<span class="sd">            node_uuid: UUID of the specific node to find neighbors for.</span>
<span class="sd">            user_id: User ID for isolation - only return neighbors belonging to this user.</span>
<span class="sd">            rel_types: List of relationship types to filter by.</span>
<span class="sd">            direction: &quot;in&quot;, &quot;out&quot;, or &quot;any&quot; for relationship direction.</span>
<span class="sd">            limit: Maximum number of neighbors to return.</span>
<span class="sd">            neighbor_label: Type of neighbor nodes to return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of neighbor nodes with relationship info.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If node_label is a UUID or node_uuid is not a UUID.</span>
<span class="sd">            DatabaseError: If neighbor query fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate parameters to prevent common bugs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_label</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;node_label must be a node type (e.g., &#39;Memory&#39;, &#39;bug&#39;), not UUID: </span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;UUIDs should be passed as node_uuid parameter.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_uuid</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;node_uuid must be a valid UUID format, got: </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use YamlTranslator to expand predicates to concrete relationship labels</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;YamlTranslator required for neighbor operations&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span> <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="c1"># Get concrete relationship labels for this source and predicates</span>
            <span class="k">if</span> <span class="n">rel_types</span><span class="p">:</span>
                <span class="n">relationship_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_labels_for_predicates</span><span class="p">(</span>
                    <span class="n">source_type</span><span class="o">=</span><span class="n">node_label</span><span class="p">,</span>
                    <span class="n">predicates</span><span class="o">=</span><span class="n">rel_types</span><span class="p">,</span>
                    <span class="n">neighbor_label</span><span class="o">=</span><span class="n">neighbor_label</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_labels</span><span class="p">:</span>
                    <span class="c1"># No matching relationships found - return empty</span>
                    <span class="k">return</span> <span class="p">[]</span>

                <span class="c1"># Create relationship pattern with specific labels</span>
                <span class="n">rel_filter</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relationship_labels</span><span class="p">)</span>
                <span class="n">rel_part</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">rel_filter</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No filtering - match all relationships</span>
                <span class="n">rel_part</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="c1"># CRITICAL: User isolation - both source node and neighbors must belong to user</span>
            <span class="n">node_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;a:</span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $node_uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>
            <span class="n">neighbor</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">neighbor_label</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="n">neighbor_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>

            <span class="c1"># Build direction-aware pattern</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-&gt;(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)&lt;-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>

            <span class="c1"># Return neighbors only if they belong to the same user</span>
            <span class="n">cypher</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            MATCH </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span>
<span class="s2">            RETURN DISTINCT n.id as id,</span>
<span class="s2">                            n.user_id as user_id,</span>
<span class="s2">                            n.memory_type as memory_type,</span>
<span class="s2">                            n.created_at as created_at,</span>
<span class="s2">                            label(r) as rel_type,</span>
<span class="s2">                            n as node</span>
<span class="s2">            LIMIT $limit</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">}</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to fetch neighbors&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span>
                    <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                    <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">,</span>
                    <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="n">direction</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a single node by UUID&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
            <span class="n">cypher_check</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_check</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
                <span class="c1"># Node doesn&#39;t exist for this user, consider it successfully &quot;deleted&quot;</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="c1"># Delete the node - only if it belongs to the user</span>
            <span class="n">cypher_delete_node</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) DELETE n&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">cypher_delete_node</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;delete undirected rel&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span> <span class="ow">or</span> <span class="s2">&quot;relationship&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span><span class="p">:</span>
                <span class="c1"># Relationship constraint prevents deletion - this is a REAL FAILURE</span>
                <span class="c1"># Don&#39;t lie by returning True - raise explicit error</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot delete node </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">: has existing relationships. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Delete relationships first or use CASCADE delete if supported.&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                        <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                        <span class="s2">&quot;constraint_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="p">},</span>
                    <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
            <span class="c1"># Other database error</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to delete node from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">node_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get multiple nodes with filtering and pagination.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            node_type: Optional node type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">            filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;}).</span>
<span class="sd">            limit: Maximum number of nodes to return.</span>
<span class="sd">            offset: Number of nodes to skip for pagination.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of node data from Kuzu.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If node retrieval fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">{}</span>

            <span class="c1"># Build MATCH clause</span>
            <span class="k">if</span> <span class="n">node_type</span><span class="p">:</span>
                <span class="n">match_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">match_clause</span> <span class="o">=</span> <span class="s2">&quot;MATCH (n {user_id: $user_id&quot;</span>

            <span class="c1"># Add field filters</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;filter_</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">match_clause</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_value</span>

            <span class="n">match_clause</span> <span class="o">+=</span> <span class="s2">&quot;})&quot;</span>

            <span class="c1"># Build complete query</span>
            <span class="n">cypher_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            </span><span class="si">{</span><span class="n">match_clause</span><span class="si">}</span>
<span class="s2">            RETURN n.id as id,</span>
<span class="s2">                   n.user_id as user_id,</span>
<span class="s2">                   n.memory_type as memory_type,</span>
<span class="s2">                   n.created_at as created_at,</span>
<span class="s2">                   n.updated_at as updated_at,</span>
<span class="s2">                   n as node</span>
<span class="s2">            ORDER BY n.created_at DESC</span>
<span class="s2">            SKIP $offset</span>
<span class="s2">            LIMIT $limit</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get nodes from Kuzu&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_nodes&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                    <span class="s2">&quot;node_type&quot;</span><span class="p">:</span> <span class="n">node_type</span><span class="p">,</span>
                    <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">,</span>
                    <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                    <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_kuzu_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map Python types to Kuzu types with proper validation.</span>

<span class="sd">        Args:</span>
<span class="sd">            key: Property key name.</span>
<span class="sd">            value: Property value to type-check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Kuzu type name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If the Python type is not supported by Kuzu.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="c1"># Check bool first (bool is subclass of int in Python!)</span>
            <span class="k">return</span> <span class="s2">&quot;BOOLEAN&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;INT64&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;DOUBLE&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;STRING&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># None values need special handling - default to STRING for now</span>
            <span class="k">return</span> <span class="s2">&quot;STRING&quot;</span>
        <span class="c1"># Unsupported type - fail explicitly instead of silent STRING conversion</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unsupported property type for key &#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Supported types: str, int, float, bool. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Complex types must be serialized before storage.&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;_get_kuzu_type&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if string looks like a UUID (36 chars with hyphens in right positions).</span>

<span class="sd">        Args:</span>
<span class="sd">            value: String to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if value matches UUID format (8-4-4-4-12 hex pattern), False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">36</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># UUID format: 8-4-4-4-12 (e.g., 550e8400-e29b-41d4-a716-446655440000)</span>
        <span class="n">uuid_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^[0-9a-f]</span><span class="si">{8}</span><span class="s2">-[0-9a-f]</span><span class="si">{4}</span><span class="s2">-[0-9a-f]</span><span class="si">{4}</span><span class="s2">-[0-9a-f]</span><span class="si">{4}</span><span class="s2">-[0-9a-f]</span><span class="si">{12}</span><span class="s2">$&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">uuid_pattern</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">yaml_translator</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize with pre-created connection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>connection</code>
            </td>
            <td>
                  <code><span title="kuzu.Connection">Connection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized Kuzu connection from DatabaseClients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>yaml_translator</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional YamlTranslator for relationship operations.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">kuzu</span><span class="o">.</span><span class="n">Connection</span><span class="p">,</span> <span class="n">yaml_translator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize with pre-created connection.</span>

<span class="sd">    Args:</span>
<span class="sd">        connection: Pre-initialized Kuzu connection from DatabaseClients.</span>
<span class="sd">        yaml_translator: Optional YamlTranslator for relationship operations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">connection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span> <span class="o">=</span> <span class="n">yaml_translator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.add_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_node</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">properties</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a node to the graph - pure CRUD operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node properties.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node creation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a node to the graph - pure CRUD operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Node table name.</span>
<span class="sd">        properties: Node properties.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If node creation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CREATE (:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="si">{</span><span class="n">props</span><span class="si">}</span><span class="se">}}</span><span class="s2">)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to add node to </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_node&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.add_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_relationship</span><span class="p">(</span><span class="n">from_table</span><span class="p">,</span> <span class="n">to_table</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">,</span> <span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add relationship between nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rel_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>props</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional relationship properties.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If relationship creation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">props</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add relationship between nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_table: Source node table name.</span>
<span class="sd">        to_table: Target node table name.</span>
<span class="sd">        rel_type: Relationship type.</span>
<span class="sd">        from_id: Source node ID.</span>
<span class="sd">        to_id: Target node ID.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        props: Optional relationship properties.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If relationship creation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">props</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Use relationship type as-is (predicates from YAML) - no sanitization</span>
        <span class="c1"># rel_type should already be a valid predicate (e.g., &quot;REFERENCED_BY&quot;, &quot;ANNOTATES&quot;)</span>

        <span class="c1"># CRITICAL: Verify both nodes belong to the user before creating relationship</span>
        <span class="c1"># First check if both nodes exist and belong to the user</span>
        <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
        <span class="p">)</span>
        <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot create relationship: one or both memories not found &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;or don&#39;t belong to user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Generate relationship table name using YamlTranslator</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
            <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
        <span class="p">)</span>

        <span class="c1"># Now create the relationship using the unique table name</span>
        <span class="n">prop_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="k">if</span> <span class="n">props</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">rel_props</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="se">{{</span><span class="si">{</span><span class="n">prop_str</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">prop_str</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">create_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;CREATE (a)-[:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}{</span><span class="n">rel_props</span><span class="si">}</span><span class="s2">]-&gt;(b)&quot;</span>
        <span class="p">)</span>
        <span class="n">create_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
            <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="o">**</span><span class="n">props</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">create_params</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to add relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_relationship&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.delete_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_node</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a single node by UUID</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a single node by UUID&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
        <span class="n">cypher_check</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_check</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="c1"># Node doesn&#39;t exist for this user, consider it successfully &quot;deleted&quot;</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Delete the node - only if it belongs to the user</span>
        <span class="n">cypher_delete_node</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) DELETE n&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">cypher_delete_node</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;delete undirected rel&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span> <span class="ow">or</span> <span class="s2">&quot;relationship&quot;</span> <span class="ow">in</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="c1"># Relationship constraint prevents deletion - this is a REAL FAILURE</span>
            <span class="c1"># Don&#39;t lie by returning True - raise explicit error</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot delete node </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">: has existing relationships. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Delete relationships first or use CASCADE delete if supported.&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                    <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                    <span class="s2">&quot;constraint_error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="p">},</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="c1"># Other database error</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to delete node from </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_node&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span> <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.delete_relationship" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_relationship</span><span class="p">(</span><span class="n">from_table</span><span class="p">,</span> <span class="n">to_table</span><span class="p">,</span> <span class="n">rel_type</span><span class="p">,</span> <span class="n">from_id</span><span class="p">,</span> <span class="n">to_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete relationship between nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>from_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rel_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relationship type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>from_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target node ID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded, False if relationship not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If relationship deletion fails due to system error.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_relationship</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">from_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rel_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">from_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">to_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete relationship between nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        from_table: Source node table name.</span>
<span class="sd">        to_table: Target node table name.</span>
<span class="sd">        rel_type: Relationship type.</span>
<span class="sd">        from_id: Source node ID.</span>
<span class="sd">        to_id: Target node ID.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded, False if relationship not found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If relationship deletion fails due to system error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># VALIDATE RELATIONSHIP AGAINST YAML SCHEMA - crash if invalid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_relation_predicate</span><span class="p">(</span><span class="n">rel_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid relationship predicate: </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">. Must be defined in YAML schema.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># CRITICAL: Verify both nodes belong to the user before deleting relationship</span>
        <span class="c1"># First check if both nodes exist and belong to the user</span>
        <span class="n">check_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">), &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;RETURN a.id, b.id&quot;</span>
        <span class="p">)</span>
        <span class="n">check_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="n">check_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="c1"># Nodes don&#39;t exist or don&#39;t belong to user - return False (not found)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Generate relationship table name using YamlTranslator</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YamlTranslator required for relationship operations&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                    <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                    <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">relationship_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">from_table</span><span class="p">,</span>
            <span class="n">predicate</span><span class="o">=</span><span class="n">rel_type</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">to_table</span><span class="p">,</span>
            <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Direction affects semantics but not table naming for now</span>
        <span class="p">)</span>

        <span class="c1"># First check if the relationship exists</span>
        <span class="n">check_rel_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;RETURN r&quot;</span>
        <span class="p">)</span>
        <span class="n">check_rel_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

        <span class="c1"># Check if relationship exists</span>
        <span class="n">relationship_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_rel_query</span><span class="p">,</span> <span class="n">check_rel_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_exists</span><span class="p">:</span>
            <span class="c1"># Relationship doesn&#39;t exist - return False</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Delete the specific relationship (we know it exists)</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;MATCH (a:</span><span class="si">{</span><span class="n">from_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $from_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">)&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;-[r:</span><span class="si">{</span><span class="n">relationship_table_name</span><span class="si">}</span><span class="s2">]-&gt;&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(b:</span><span class="si">{</span><span class="n">to_table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $to_id, user_id: $user_id</span><span class="se">}}</span><span class="s2">) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;DELETE r&quot;</span>
        <span class="p">)</span>
        <span class="n">delete_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span> <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

        <span class="c1"># Execute deletion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">delete_params</span><span class="p">)</span>

        <span class="c1"># If we get here, deletion succeeded</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># Re-raise validation errors as-is</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to delete relationship </span><span class="si">{</span><span class="n">rel_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_relationship&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;from_table&quot;</span><span class="p">:</span> <span class="n">from_table</span><span class="p">,</span>
                <span class="s2">&quot;to_table&quot;</span><span class="p">:</span> <span class="n">to_table</span><span class="p">,</span>
                <span class="s2">&quot;rel_type&quot;</span><span class="p">:</span> <span class="n">rel_type</span><span class="p">,</span>
                <span class="s2">&quot;from_id&quot;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                <span class="s2">&quot;to_id&quot;</span><span class="p">:</span> <span class="n">to_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.get_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nodes</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">node_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get multiple nodes with filtering and pagination.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional node type filter (e.g., "task", "note").</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional field filters (e.g., {"status": "open"}).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of nodes to return.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes to skip for pagination.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of node data from Kuzu.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node retrieval fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nodes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">node_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get multiple nodes with filtering and pagination.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        node_type: Optional node type filter (e.g., &quot;task&quot;, &quot;note&quot;).</span>
<span class="sd">        filters: Optional field filters (e.g., {&quot;status&quot;: &quot;open&quot;}).</span>
<span class="sd">        limit: Maximum number of nodes to return.</span>
<span class="sd">        offset: Number of nodes to skip for pagination.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of node data from Kuzu.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If node retrieval fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># Build MATCH clause</span>
        <span class="k">if</span> <span class="n">node_type</span><span class="p">:</span>
            <span class="n">match_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">node_type</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">match_clause</span> <span class="o">=</span> <span class="s2">&quot;MATCH (n {user_id: $user_id&quot;</span>

        <span class="c1"># Add field filters</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;filter_</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">match_clause</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">field_value</span>

        <span class="n">match_clause</span> <span class="o">+=</span> <span class="s2">&quot;})&quot;</span>

        <span class="c1"># Build complete query</span>
        <span class="n">cypher_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span><span class="si">{</span><span class="n">match_clause</span><span class="si">}</span>
<span class="s2">        RETURN n.id as id,</span>
<span class="s2">               n.user_id as user_id,</span>
<span class="s2">               n.memory_type as memory_type,</span>
<span class="s2">               n.created_at as created_at,</span>
<span class="s2">               n.updated_at as updated_at,</span>
<span class="s2">               n as node</span>
<span class="s2">        ORDER BY n.created_at DESC</span>
<span class="s2">        SKIP $offset</span>
<span class="s2">        LIMIT $limit</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher_query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to get nodes from Kuzu&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_nodes&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s2">&quot;node_type&quot;</span><span class="p">:</span> <span class="n">node_type</span><span class="p">,</span>
                <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">,</span>
                <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
                <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.neighbors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">neighbors</span><span class="p">(</span><span class="n">node_label</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">rel_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">neighbor_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fetch neighbors of a node by UUID only.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_label</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node type/table name (e.g., "Memory", "bug") - NOT a UUID.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UUID of the specific node to find neighbors for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for isolation - only return neighbors belonging to this user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rel_types</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of relationship types to filter by.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"in", "out", or "any" for relationship direction.</p>
              </div>
            </td>
            <td>
                  <code>&#39;any&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of neighbors to return.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_label</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of neighbor nodes to return.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of neighbor nodes with relationship info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node_label is a UUID or node_uuid is not a UUID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If neighbor query fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">neighbors</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">node_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">rel_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;any&quot;</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch neighbors of a node by UUID only.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_label: Node type/table name (e.g., &quot;Memory&quot;, &quot;bug&quot;) - NOT a UUID.</span>
<span class="sd">        node_uuid: UUID of the specific node to find neighbors for.</span>
<span class="sd">        user_id: User ID for isolation - only return neighbors belonging to this user.</span>
<span class="sd">        rel_types: List of relationship types to filter by.</span>
<span class="sd">        direction: &quot;in&quot;, &quot;out&quot;, or &quot;any&quot; for relationship direction.</span>
<span class="sd">        limit: Maximum number of neighbors to return.</span>
<span class="sd">        neighbor_label: Type of neighbor nodes to return.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of neighbor nodes with relationship info.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If node_label is a UUID or node_uuid is not a UUID.</span>
<span class="sd">        DatabaseError: If neighbor query fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Validate parameters to prevent common bugs</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_label</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;node_label must be a node type (e.g., &#39;Memory&#39;, &#39;bug&#39;), not UUID: </span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;UUIDs should be passed as node_uuid parameter.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_uuid</span><span class="p">(</span><span class="n">node_uuid</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;node_uuid must be a valid UUID format, got: </span><span class="si">{</span><span class="n">node_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use YamlTranslator to expand predicates to concrete relationship labels</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;YamlTranslator required for neighbor operations&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span> <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Get concrete relationship labels for this source and predicates</span>
        <span class="k">if</span> <span class="n">rel_types</span><span class="p">:</span>
            <span class="n">relationship_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_translator</span><span class="o">.</span><span class="n">get_labels_for_predicates</span><span class="p">(</span>
                <span class="n">source_type</span><span class="o">=</span><span class="n">node_label</span><span class="p">,</span>
                <span class="n">predicates</span><span class="o">=</span><span class="n">rel_types</span><span class="p">,</span>
                <span class="n">neighbor_label</span><span class="o">=</span><span class="n">neighbor_label</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">relationship_labels</span><span class="p">:</span>
                <span class="c1"># No matching relationships found - return empty</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Create relationship pattern with specific labels</span>
            <span class="n">rel_filter</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relationship_labels</span><span class="p">)</span>
            <span class="n">rel_part</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">rel_filter</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No filtering - match all relationships</span>
            <span class="n">rel_part</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># CRITICAL: User isolation - both source node and neighbors must belong to user</span>
        <span class="n">node_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;a:</span><span class="si">{</span><span class="n">node_label</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $node_uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="n">neighbor</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">neighbor_label</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">neighbor_condition</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">user_id: $user_id</span><span class="se">}}</span><span class="s2">&quot;</span>

        <span class="c1"># Build direction-aware pattern</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;out&quot;</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-&gt;(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)&lt;-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node_condition</span><span class="si">}</span><span class="s2">)-[r</span><span class="si">{</span><span class="n">rel_part</span><span class="si">}</span><span class="s2">]-(</span><span class="si">{</span><span class="n">neighbor_condition</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># Return neighbors only if they belong to the same user</span>
        <span class="n">cypher</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        MATCH </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span>
<span class="s2">        RETURN DISTINCT n.id as id,</span>
<span class="s2">                        n.user_id as user_id,</span>
<span class="s2">                        n.memory_type as memory_type,</span>
<span class="s2">                        n.created_at as created_at,</span>
<span class="s2">                        label(r) as rel_type,</span>
<span class="s2">                        n as node</span>
<span class="s2">        LIMIT $limit</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="n">limit</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to fetch neighbors&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;neighbors&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;node_label&quot;</span><span class="p">:</span> <span class="n">node_label</span><span class="p">,</span>
                <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s2">&quot;rel_types&quot;</span><span class="p">:</span> <span class="n">rel_types</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="n">direction</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.query" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Execute Cypher query and return results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cypher</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cypher query string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: Query results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If query execution fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cypher</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute Cypher query and return results.</span>

<span class="sd">    Args:</span>
<span class="sd">        cypher: Cypher query string.</span>
<span class="sd">        params: Query parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: Query results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If query execution fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">qr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_query_results</span><span class="p">(</span><span class="n">qr</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Failed to execute Kuzu query&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cypher&quot;</span><span class="p">:</span> <span class="n">cypher</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.KuzuInterface.update_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_node</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update a node in the graph - pure CRUD operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_uuid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UUID of the node to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node properties to update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if update succeeded, False if node not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If node update fails due to system error.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/kuzu.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_node</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_uuid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a node in the graph - pure CRUD operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Node table name.</span>
<span class="sd">        node_uuid: UUID of the node to update.</span>
<span class="sd">        properties: Node properties to update.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if update succeeded, False if node not found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If node update fails due to system error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># CRITICAL: Check if node exists AND belongs to user</span>
        <span class="n">check_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) RETURN n.id as id&quot;</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">check_query</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">:</span>
            <span class="c1"># Node doesn&#39;t exist for this user</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Build SET clause for properties</span>
        <span class="n">set_clauses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Skip system fields that shouldn&#39;t be updated via this method</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">param_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;prop_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">set_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n.</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> = $</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">set_clauses</span><span class="p">:</span>
            <span class="c1"># No properties to update (all were system fields)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Execute update query</span>
        <span class="n">set_clause</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">set_clauses</span><span class="p">)</span>
        <span class="n">update_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;MATCH (n:</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> </span><span class="se">{{</span><span class="s2">id: $uuid, user_id: $user_id</span><span class="se">}}</span><span class="s2">) SET </span><span class="si">{</span><span class="n">set_clause</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">update_query</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to update node in </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;update_node&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">table</span><span class="p">,</span>
                <span class="s2">&quot;node_uuid&quot;</span><span class="p">:</span> <span class="n">node_uuid</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="n">properties</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.db_clients.QdrantInterface" class="doc doc-heading">
            <code>QdrantInterface</code>


</h2>


    <div class="doc doc-contents ">


        <p>Pure CRUD wrapper around QdrantClient - NO DDL operations.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.QdrantInterface.client">client</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized QdrantClient.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.QdrantInterface.collection_name">collection_name</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the Qdrant collection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/interfaces/qdrant.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">QdrantInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pure CRUD wrapper around QdrantClient - NO DDL operations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        client: Pre-initialized QdrantClient.</span>
<span class="sd">        collection_name: Name of the Qdrant collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize with pre-created client and collection.</span>

<span class="sd">        Args:</span>
<span class="sd">            client: Pre-initialized QdrantClient from DatabaseClients.</span>
<span class="sd">            collection_name: Name of pre-created collection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_point</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">point_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a single point to collection - pure CRUD operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            vector: Embedding vector.</span>
<span class="sd">            payload: Point payload data.</span>
<span class="sd">            point_id: Optional point ID (auto-generated if None).</span>
<span class="sd">            collection: Optional collection name override.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[bool, str]: (success, point_id) where success indicates if operation succeeded.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If point addition fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

            <span class="k">if</span> <span class="n">point_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">point_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

            <span class="c1"># Create PointStruct with VectorStruct</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">PointStruct</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">point_id</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">point</span><span class="p">])</span>

            <span class="c1"># print(&quot;Qdrant result&quot;, result)</span>

            <span class="c1"># Determine success from returned UpdateResult status</span>
            <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">status</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">status_str</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">status_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status_str</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">status_str</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;acknowledged&quot;</span><span class="p">,</span> <span class="s2">&quot;completed&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">success</span><span class="p">,</span> <span class="n">point_id</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Qdrant add_point error&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_point&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_points</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for similar points with mandatory user isolation - pure CRUD operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            vector: Query embedding vector.</span>
<span class="sd">            limit: Maximum number of results.</span>
<span class="sd">            collection: Optional collection name override.</span>
<span class="sd">            filters: Search filters (must include user_id for security).</span>
<span class="sd">            score_threshold: Minimum similarity score threshold (0.0-1.0).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of search results with id, score, and payload.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If search fails or user_id is missing from filters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># CRITICAL SECURITY: Validate user_id is present in filters</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span> <span class="ow">or</span> <span class="s2">&quot;user_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;user_id is mandatory in filters for data isolation&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;search_points_validation&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="n">user_id</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user_id</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="s2">&quot;user_id must be a non-empty string&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;search_points_validation&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="p">)</span>

            <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

            <span class="c1"># Build query filter</span>
            <span class="n">query_filter</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">filter_conditions</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Add user_id filter - flat payload structure (always required)</span>
            <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchValue</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">user_id</span><span class="p">)))</span>

            <span class="c1"># Add additional filters (skip user_id since it&#39;s already added)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;user_id&quot;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># Handle range filters</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">range_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">bound_key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;gt&quot;</span><span class="p">,</span> <span class="s2">&quot;gte&quot;</span><span class="p">,</span> <span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;lte&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">bound_key</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="n">bound_key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">range_kwargs</span><span class="p">[</span><span class="n">bound_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">bound_key</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">range_kwargs</span><span class="p">:</span>
                        <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="o">**</span><span class="n">range_kwargs</span><span class="p">))</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                <span class="c1"># Handle list values</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchAny</span><span class="p">(</span><span class="nb">any</span><span class="o">=</span><span class="n">value</span><span class="p">)))</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># Skip dict values that weren&#39;t handled as ranges</span>
                    <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchValue</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">filter_conditions</span><span class="p">:</span>
                <span class="c1"># Use type ignore for the Filter argument type mismatch</span>
                <span class="n">query_filter</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">must</span><span class="o">=</span><span class="n">filter_conditions</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

            <span class="c1"># Search using modern API</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span>
                <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">query</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
                <span class="n">query_filter</span><span class="o">=</span><span class="n">query_filter</span><span class="p">,</span>
                <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">points</span>

            <span class="c1"># Convert to simplified results (score_threshold already applied by Qdrant)</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
            <span class="p">]</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Qdrant search_points error&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;search_points&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a single point by ID - pure CRUD operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            point_id: ID of the point to retrieve.</span>
<span class="sd">            collection: Optional collection name override.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any] | None: Point data including id, vector, and payload, or None if not found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If retrieval fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">point_id</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">point</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                    <span class="s2">&quot;vector&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span>
                    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Qdrant get_point error&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_point&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">delete_points</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">point_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete points by IDs with user ownership verification.</span>

<span class="sd">        Args:</span>
<span class="sd">            point_ids: List of point IDs to delete.</span>
<span class="sd">            user_id: User ID for ownership verification.</span>
<span class="sd">            collection: Optional collection name override.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion succeeded.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If points not found or don&#39;t belong to user, or deletion fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

            <span class="c1"># CRITICAL: Verify user ownership before deletion</span>
            <span class="c1"># First, verify all points belong to the user</span>
            <span class="k">for</span> <span class="n">point_id</span> <span class="ow">in</span> <span class="n">point_ids</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                    <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">point_id</span><span class="p">],</span> <span class="n">with_payload</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">points</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span> <span class="ow">and</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">user_id</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Point </span><span class="si">{</span><span class="n">point_id</span><span class="si">}</span><span class="s2"> not found or doesn&#39;t belong to user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_points&quot;</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;point_id&quot;</span><span class="p">:</span> <span class="n">point_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                    <span class="p">)</span>

            <span class="c1"># If all points belong to user, proceed with deletion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
                <span class="n">points_selector</span><span class="o">=</span><span class="n">PointIdsList</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">point_ids</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Qdrant delete_points error&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_points&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_collection_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get collection information - pure read operation.</span>

<span class="sd">        Args:</span>
<span class="sd">            collection: Optional collection name override.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Collection information including existence, vector count, point count, and config.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DatabaseError: If collection info retrieval fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
            <span class="c1"># Handle different types of vector params</span>
            <span class="n">vector_size</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">vector_distance</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">vectors_param</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">vectors</span>
            <span class="k">if</span> <span class="n">vectors_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vectors_param</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                    <span class="n">vector_size</span> <span class="o">=</span> <span class="n">vectors_param</span><span class="o">.</span><span class="n">size</span>  <span class="c1"># type: ignore</span>
                    <span class="n">vector_distance</span> <span class="o">=</span> <span class="n">vectors_param</span><span class="o">.</span><span class="n">distance</span>  <span class="c1"># type: ignore</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vectors_param</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="c1"># For multi-vector collections, use the first vector&#39;s params</span>
                    <span class="k">if</span> <span class="n">vectors_param</span><span class="p">:</span>
                        <span class="n">vector_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vectors_param</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">vector_values</span><span class="p">:</span>
                            <span class="n">first_vector</span> <span class="o">=</span> <span class="n">vector_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">vector_size</span> <span class="o">=</span> <span class="n">first_vector</span><span class="o">.</span><span class="n">size</span>
                            <span class="n">vector_distance</span> <span class="o">=</span> <span class="n">first_vector</span><span class="o">.</span><span class="n">distance</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;vectors_count&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">vectors_count</span><span class="p">,</span>
                <span class="s2">&quot;points_count&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">points_count</span><span class="p">,</span>
                <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;vector_size&quot;</span><span class="p">:</span> <span class="n">vector_size</span><span class="p">,</span>
                    <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="n">vector_distance</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;Qdrant get_collection_info error&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_collection_info&quot;</span><span class="p">,</span>
                <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.QdrantInterface.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize with pre-created client and collection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>client</code>
            </td>
            <td>
                  <code><span title="qdrant_client.QdrantClient">QdrantClient</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-initialized QdrantClient from DatabaseClients.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of pre-created collection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">QdrantClient</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize with pre-created client and collection.</span>

<span class="sd">    Args:</span>
<span class="sd">        client: Pre-initialized QdrantClient from DatabaseClients.</span>
<span class="sd">        collection_name: Name of pre-created collection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span> <span class="o">=</span> <span class="n">collection_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.QdrantInterface.add_point" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_point</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">point_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a single point to collection - pure CRUD operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vector</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Embedding vector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>payload</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Point payload data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>point_id</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional point ID (auto-generated if None).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional collection name override.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="bool">bool</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[bool, str]: (success, point_id) where success indicates if operation succeeded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If point addition fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_point</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">point_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a single point to collection - pure CRUD operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        vector: Embedding vector.</span>
<span class="sd">        payload: Point payload data.</span>
<span class="sd">        point_id: Optional point ID (auto-generated if None).</span>
<span class="sd">        collection: Optional collection name override.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[bool, str]: (success, point_id) where success indicates if operation succeeded.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If point addition fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

        <span class="k">if</span> <span class="n">point_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">point_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

        <span class="c1"># Create PointStruct with VectorStruct</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">PointStruct</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">point_id</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">upsert</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="n">point</span><span class="p">])</span>

        <span class="c1"># print(&quot;Qdrant result&quot;, result)</span>

        <span class="c1"># Determine success from returned UpdateResult status</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">status</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status_str</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">status_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">status_str</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">status_str</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;acknowledged&quot;</span><span class="p">,</span> <span class="s2">&quot;completed&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">success</span><span class="p">,</span> <span class="n">point_id</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Qdrant add_point error&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;add_point&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.QdrantInterface.delete_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_points</span><span class="p">(</span><span class="n">point_ids</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delete points by IDs with user ownership verification.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>point_ids</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of point IDs to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID for ownership verification.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional collection name override.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion succeeded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If points not found or don't belong to user, or deletion fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delete_points</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">point_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete points by IDs with user ownership verification.</span>

<span class="sd">    Args:</span>
<span class="sd">        point_ids: List of point IDs to delete.</span>
<span class="sd">        user_id: User ID for ownership verification.</span>
<span class="sd">        collection: Optional collection name override.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion succeeded.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If points not found or don&#39;t belong to user, or deletion fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

        <span class="c1"># CRITICAL: Verify user ownership before deletion</span>
        <span class="c1"># First, verify all points belong to the user</span>
        <span class="k">for</span> <span class="n">point_id</span> <span class="ow">in</span> <span class="n">point_ids</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">point_id</span><span class="p">],</span> <span class="n">with_payload</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">points</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span> <span class="ow">and</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">user_id</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Point </span><span class="si">{</span><span class="n">point_id</span><span class="si">}</span><span class="s2"> not found or doesn&#39;t belong to user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_points&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;point_id&quot;</span><span class="p">:</span> <span class="n">point_id</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="p">)</span>

        <span class="c1"># If all points belong to user, proceed with deletion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
            <span class="n">points_selector</span><span class="o">=</span><span class="n">PointIdsList</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">point_ids</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Qdrant delete_points error&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;delete_points&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.QdrantInterface.get_collection_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_info</span><span class="p">(</span><span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get collection information - pure read operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional collection name override.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: Collection information including existence, vector count, point count, and config.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If collection info retrieval fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_collection_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get collection information - pure read operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        collection: Optional collection name override.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any]: Collection information including existence, vector count, point count, and config.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If collection info retrieval fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">)</span>
        <span class="c1"># Handle different types of vector params</span>
        <span class="n">vector_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">vector_distance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">vectors_param</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">vectors</span>
        <span class="k">if</span> <span class="n">vectors_param</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">vectors_param</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="p">):</span>
                <span class="n">vector_size</span> <span class="o">=</span> <span class="n">vectors_param</span><span class="o">.</span><span class="n">size</span>  <span class="c1"># type: ignore</span>
                <span class="n">vector_distance</span> <span class="o">=</span> <span class="n">vectors_param</span><span class="o">.</span><span class="n">distance</span>  <span class="c1"># type: ignore</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vectors_param</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># For multi-vector collections, use the first vector&#39;s params</span>
                <span class="k">if</span> <span class="n">vectors_param</span><span class="p">:</span>
                    <span class="n">vector_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">vectors_param</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">vector_values</span><span class="p">:</span>
                        <span class="n">first_vector</span> <span class="o">=</span> <span class="n">vector_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">vector_size</span> <span class="o">=</span> <span class="n">first_vector</span><span class="o">.</span><span class="n">size</span>
                        <span class="n">vector_distance</span> <span class="o">=</span> <span class="n">first_vector</span><span class="o">.</span><span class="n">distance</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;exists&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;vectors_count&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">vectors_count</span><span class="p">,</span>
            <span class="s2">&quot;points_count&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">points_count</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;vector_size&quot;</span><span class="p">:</span> <span class="n">vector_size</span><span class="p">,</span>
                <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="n">vector_distance</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Qdrant get_collection_info error&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_collection_info&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.QdrantInterface.get_point" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_point</span><span class="p">(</span><span class="n">point_id</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single point by ID - pure CRUD operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>point_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the point to retrieve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional collection name override.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any] | None: Point data including id, vector, and payload, or None if not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If retrieval fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a single point by ID - pure CRUD operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        point_id: ID of the point to retrieve.</span>
<span class="sd">        collection: Optional collection name override.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Any] | None: Point data including id, vector, and payload, or None if not found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If retrieval fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
            <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">point_id</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                <span class="s2">&quot;vector&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span>
                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">point</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Qdrant get_point error&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;get_point&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.QdrantInterface.search_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">search_points</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">collection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">score_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Search for similar points with mandatory user isolation - pure CRUD operation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vector</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query embedding vector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of results.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional collection name override.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Search filters (must include user_id for security).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum similarity score threshold (0.0-1.0).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict[str, Any]]: List of search results with id, score, and payload.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatabaseError (memg_core.core.exceptions.DatabaseError)" href="#memg_core.core.exceptions.DatabaseError">DatabaseError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If search fails or user_id is missing from filters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/interfaces/qdrant.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search_points</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">vector</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filters</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">score_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for similar points with mandatory user isolation - pure CRUD operation.</span>

<span class="sd">    Args:</span>
<span class="sd">        vector: Query embedding vector.</span>
<span class="sd">        limit: Maximum number of results.</span>
<span class="sd">        collection: Optional collection name override.</span>
<span class="sd">        filters: Search filters (must include user_id for security).</span>
<span class="sd">        score_threshold: Minimum similarity score threshold (0.0-1.0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict[str, Any]]: List of search results with id, score, and payload.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DatabaseError: If search fails or user_id is missing from filters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># CRITICAL SECURITY: Validate user_id is present in filters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span> <span class="ow">or</span> <span class="s2">&quot;user_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;user_id is mandatory in filters for data isolation&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;search_points_validation&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="n">filters</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="n">user_id</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user_id</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
                <span class="s2">&quot;user_id must be a non-empty string&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;search_points_validation&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection_name</span>

        <span class="c1"># Build query filter</span>
        <span class="n">query_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">filter_conditions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add user_id filter - flat payload structure (always required)</span>
        <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchValue</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">user_id</span><span class="p">)))</span>

        <span class="c1"># Add additional filters (skip user_id since it&#39;s already added)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;user_id&quot;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Handle range filters</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">range_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">bound_key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;gt&quot;</span><span class="p">,</span> <span class="s2">&quot;gte&quot;</span><span class="p">,</span> <span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;lte&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">bound_key</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="n">bound_key</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">range_kwargs</span><span class="p">[</span><span class="n">bound_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">bound_key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">range_kwargs</span><span class="p">:</span>
                    <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="o">**</span><span class="n">range_kwargs</span><span class="p">))</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
            <span class="c1"># Handle list values</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchAny</span><span class="p">(</span><span class="nb">any</span><span class="o">=</span><span class="n">value</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># Skip dict values that weren&#39;t handled as ranges</span>
                <span class="n">filter_conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FieldCondition</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">MatchValue</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">filter_conditions</span><span class="p">:</span>
            <span class="c1"># Use type ignore for the Filter argument type mismatch</span>
            <span class="n">query_filter</span> <span class="o">=</span> <span class="n">Filter</span><span class="p">(</span><span class="n">must</span><span class="o">=</span><span class="n">filter_conditions</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Search using modern API</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">query_points</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection</span><span class="p">,</span>
            <span class="n">query</span><span class="o">=</span><span class="n">vector</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
            <span class="n">query_filter</span><span class="o">=</span><span class="n">query_filter</span><span class="p">,</span>
            <span class="n">score_threshold</span><span class="o">=</span><span class="n">score_threshold</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">points</span>

        <span class="c1"># Convert to simplified results (score_threshold already applied by Qdrant)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span>
        <span class="p">]</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DatabaseError</span><span class="p">(</span>
            <span class="s2">&quot;Qdrant search_points error&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;search_points&quot;</span><span class="p">,</span>
            <span class="n">original_error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="memg_core.utils.db_clients.YamlTranslator" class="doc doc-heading">
            <code>YamlTranslator</code>


</h2>


    <div class="doc doc-contents ">


        <p>Translates YAML schema definitions to Pydantic models for strict validation.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.YamlTranslator.yaml_path">yaml_path</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="memg_core.utils.db_clients.YamlTranslator._schema">_schema</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cached schema dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">YamlTranslator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translates YAML schema definitions to Pydantic models for strict validation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        yaml_path: Path to YAML schema file.</span>
<span class="sd">        _schema: Cached schema dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize YamlTranslator with YAML schema path.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml_path: Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If YAML path not provided or TypeRegistry initialization fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Require explicit YAML path - no silent defaults</span>
        <span class="k">if</span> <span class="n">yaml_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">yaml_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_SCHEMA&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">env_path</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                    <span class="s2">&quot;YAML schema path required. Set MEMG_YAML_SCHEMA environment variable &quot;</span>
                    <span class="s2">&quot;or provide yaml_path parameter. No defaults allowed.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">env_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># NO model cache - TypeRegistry handles all caching</span>

        <span class="c1"># Initialize TypeRegistry from YAML - crash early if invalid</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">initialize_types_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize TypeRegistry from YAML: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the loaded YAML schema, loading it if necessary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

        <span class="c1"># Load schema from the required path - no fallbacks</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;YAML schema path not set. This should not happen after __init__.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_schema</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load schema from the current yaml_path.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;YAML path is None&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;YAML schema not found at </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty YAML schema&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;YAML schema root must be a mapping&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid YAML syntax: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_entities_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">sch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span>
        <span class="n">ents</span> <span class="o">=</span> <span class="n">sch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entities&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ents</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ents</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Normalize keys to lower</span>
            <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ents</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># list form</span>
        <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ents</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of available entity types from YAML schema.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># ================== RELATIONSHIP PARSING (TARGET-FIRST FORMAT) ==================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_relations_mapping_for_entity</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return raw relations mapping for an entity in target-first schema format.</span>

<span class="sd">        The expected YAML shape under an entity is:</span>
<span class="sd">            relations:</span>
<span class="sd">              target_entity_name:</span>
<span class="sd">                - name: ...</span>
<span class="sd">                  description: ...</span>
<span class="sd">                  predicate: PREDICATE_NAME</span>
<span class="sd">                  directed: true|false</span>

<span class="sd">        Returns an empty dict when no relations are defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
        <span class="n">relations_section</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relations&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_section</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">relations_section</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Normalize keys to lower for targets; keep items as-is</span>
        <span class="n">normalized</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_section</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="c1"># Skip invalid shapes silently at this layer; validation is higher-level</span>
                <span class="k">continue</span>
            <span class="n">normalized</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">normalized</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_relations_for_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get normalized relation specs for a source entity in target-first schema.</span>

<span class="sd">        Returns list of dicts with keys:</span>
<span class="sd">            - source (str)</span>
<span class="sd">            - target (str)</span>
<span class="sd">            - name (str | None)</span>
<span class="sd">            - description (str | None)</span>
<span class="sd">            - predicate (str)</span>
<span class="sd">            - directed (bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

        <span class="n">source_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">relations_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_relations_mapping_for_entity</span><span class="p">(</span><span class="n">source_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_map</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">out</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target_l</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
                <span class="n">predicate</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># Skip invalid entries - strict behavior can be added later</span>
                    <span class="k">continue</span>
                <span class="n">directed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_l</span><span class="p">,</span>
                        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target_l</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                        <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">directed</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">relationship_table_name</span><span class="p">(</span>
        <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># noqa: unused-argument</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate relationship table name.</span>

<span class="sd">        For now, table name does not encode direction; direction affects creation/query semantics.</span>
<span class="sd">        Canonicalization for undirected pairs can be added here later if decided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_labels_for_predicates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expand predicate names to concrete relationship labels for a given source.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_type: Source entity type name</span>
<span class="sd">            predicates: List of predicate names to include (case-insensitive). If None, include all.</span>
<span class="sd">            neighbor_label: Optional target entity type filter (case-insensitive)</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of concrete relationship labels (table names) matching the filter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty source_type&quot;</span><span class="p">)</span>

        <span class="n">preds_u</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicates</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">neighbor_l</span> <span class="o">=</span> <span class="n">neighbor_label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source_type</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">preds_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preds_u</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">neighbor_l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">neighbor_l</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                    <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                    <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                    <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">debug_relation_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a nested relation map for debugging/printing.</span>

<span class="sd">        Structure:</span>
<span class="sd">        {</span>
<span class="sd">          source: {</span>
<span class="sd">            target: [ {name, predicate, directed, description} ... ]</span>
<span class="sd">          }</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
            <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">specs</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                    <span class="p">}</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_anchor_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the anchor field name for the given entity type from YAML schema.</span>

<span class="sd">        Now reads from vector.anchored_to instead of separate anchor field.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_name: Name of the entity type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Anchor field name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If anchor field not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

        <span class="c1"># Get entity spec with inheritance resolution</span>
        <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

        <span class="c1"># Look for vector field with anchored_to</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">for</span> <span class="n">_field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">anchored_to</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anchored_to&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">anchored_to</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">anchored_to</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; has no vector field with &#39;anchored_to&#39; property&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve entity specification with full inheritance chain.&quot;&quot;&quot;</span>
        <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

        <span class="c1"># If no parent, return as-is</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parent_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spec_raw</span>

        <span class="c1"># Recursively resolve parent and merge fields</span>
        <span class="n">parent_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">parent_name</span><span class="p">)</span>

        <span class="c1"># Merge parent fields with child fields (child overrides parent)</span>
        <span class="n">merged_fields</span> <span class="o">=</span> <span class="n">parent_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">merged_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{}))</span>

        <span class="c1"># Create merged spec</span>
        <span class="n">merged_spec</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">merged_spec</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_fields</span>

        <span class="k">return</span> <span class="n">merged_spec</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_see_also_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the see_also configuration for the given entity type from YAML schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict with keys: enabled, threshold, limit, target_types</span>
<span class="sd">            None if see_also is not configured for this entity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>
        <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

        <span class="n">see_also</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;see_also&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">see_also</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Validate required fields</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)),</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="s2">&quot;target_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_types&quot;</span><span class="p">,</span> <span class="p">[])),</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build_anchor_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build anchor text for embedding from YAML-defined anchor field.</span>

<span class="sd">        NO hardcoded field names - reads anchor field from YAML schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory: Memory object containing payload data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Anchor text for embedding.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If anchor field is missing or invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mem_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mem_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;Memory object missing &#39;memory_type&#39; field&quot;</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Get anchor field from YAML schema</span>
        <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">mem_type</span><span class="p">)</span>

        <span class="c1"># Try to get anchor text from the specified field</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># First check if it&#39;s a core field on the Memory object</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">):</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Otherwise check in the payload</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">stripped_text</span> <span class="o">=</span> <span class="n">anchor_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">stripped_text</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">stripped_text</span>

        <span class="c1"># Anchor field missing, empty, or invalid</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; is missing, empty, or invalid &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">mem_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">mem_type</span><span class="p">,</span>
                <span class="s2">&quot;anchor_field&quot;</span><span class="p">:</span> <span class="n">anchor_field</span><span class="p">,</span>
                <span class="s2">&quot;anchor_value&quot;</span><span class="p">:</span> <span class="n">anchor_text</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fields_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract required and optional fields from entity specification.</span>

<span class="sd">        Supports either:</span>
<span class="sd">        - fields: {required:[...], optional:[...]} format</span>
<span class="sd">        - Individual field definitions with required flags</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[list[str], list[str]]: (required_fields, optional_fields)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># supports either fields: {required:[...], optional:[...]} OR flat dict</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s2">&quot;required&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">or</span> <span class="s2">&quot;optional&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;optional&quot;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="k">return</span> <span class="n">req</span><span class="p">,</span> <span class="n">opt</span>

        <span class="c1"># Resolve all fields including inherited ones</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="c1"># Parse individual field definitions for required flag</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">optional_fields</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">all_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="c1"># Skip system fields - they&#39;re handled by the system</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">required_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">optional_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">optional_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">required_fields</span><span class="p">,</span> <span class="n">optional_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_inherited_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Resolve all fields including inherited ones from parent entities.</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Dictionary containing all fields (inherited + current).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">entities_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>

        <span class="c1"># If entity has a parent, resolve parent fields first</span>
        <span class="n">parent_name</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;parent&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent_name</span><span class="p">:</span>
            <span class="n">parent_spec</span> <span class="o">=</span> <span class="n">entities_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">parent_spec</span><span class="p">:</span>
                <span class="c1"># Recursively resolve parent fields</span>
                <span class="n">parent_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">parent_spec</span><span class="p">)</span>
                <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parent_fields</span><span class="p">)</span>

        <span class="c1"># Add/override with current entity&#39;s fields</span>
        <span class="n">current_fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">all_fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">current_fields</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_system_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract system fields from YAML schema (fields marked with system: true).</span>

<span class="sd">        Args:</span>
<span class="sd">            spec: Entity specification dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: Set of field names that are marked as system fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">all_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_inherited_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">all_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">system_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">system_fields</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_enum_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate enum fields against YAML schema choices.</span>

<span class="sd">        Args:</span>
<span class="sd">            memory_type: Entity type from YAML schema.</span>
<span class="sd">            payload: Memory data to validate.</span>

<span class="sd">        Raises:</span>
<span class="sd">            YamlTranslatorError: If enum field has invalid value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
            <span class="k">return</span>  <span class="c1"># Entity validation happens elsewhere</span>

        <span class="c1"># Get field definitions for this entity type</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check each field in the payload</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">field_value</span> <span class="ow">in</span> <span class="n">payload</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">field_def</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field_name</span><span class="p">]</span>

                <span class="c1"># Check if this is an enum field</span>
                <span class="k">if</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;enum&quot;</span><span class="p">:</span>
                    <span class="n">choices</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> <span class="p">[])</span>

                    <span class="c1"># Validate the value against choices</span>
                    <span class="k">if</span> <span class="n">field_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">field_value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Invalid </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2"> value &#39;</span><span class="si">{</span><span class="n">field_value</span><span class="si">}</span><span class="s2">&#39;. Valid choices: </span><span class="si">{</span><span class="n">choices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                                <span class="s2">&quot;field_name&quot;</span><span class="p">:</span> <span class="n">field_name</span><span class="p">,</span>
                                <span class="s2">&quot;invalid_value&quot;</span><span class="p">:</span> <span class="n">field_value</span><span class="p">,</span>
                                <span class="s2">&quot;valid_choices&quot;</span><span class="p">:</span> <span class="n">choices</span><span class="p">,</span>
                            <span class="p">},</span>
                        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_memory_against_yaml</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate memory payload against YAML schema and return cleaned payload.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;memory_type is required&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;payload is required&quot;</span><span class="p">)</span>

        <span class="c1"># Strict validation - entity type MUST exist in YAML</span>
        <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown entity type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;. All types must be defined in YAML schema.&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;available_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">emap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="n">req</span><span class="p">,</span> <span class="n">_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Validate enum fields against YAML schema choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_enum_fields</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

        <span class="c1"># Validate that all fields are defined in YAML schema</span>
        <span class="n">req</span><span class="p">,</span> <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">valid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">req</span> <span class="o">+</span> <span class="n">opt</span><span class="p">)</span>
        <span class="n">system_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_system_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="n">invalid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">valid_fields</span> <span class="o">-</span> <span class="n">system_fields</span>
        <span class="k">if</span> <span class="n">invalid_fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid fields not defined in schema: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                    <span class="s2">&quot;valid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">valid_fields</span><span class="p">),</span>
                    <span class="s2">&quot;invalid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">)</span>

        <span class="c1"># Strip system-reserved fields if present</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">syskey</span> <span class="ow">in</span> <span class="n">system_fields</span><span class="p">:</span>
            <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">syskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cleaned</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_memory_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Memory object from YAML-validated payload.&quot;&quot;&quot;</span>

        <span class="c1"># Get anchor field from YAML schema</span>
        <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">memory_type</span><span class="p">)</span>

        <span class="c1"># Extract anchor text from payload</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing or invalid anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; in payload &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Validate full payload against YAML schema</span>
        <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

        <span class="c1"># Construct Memory with YAML-defined payload only</span>
        <span class="k">return</span> <span class="n">Memory</span><span class="p">(</span>
            <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
            <span class="n">payload</span><span class="o">=</span><span class="n">validated_payload</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Pydantic model from TypeRegistry - NO REDUNDANCY.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="memg_core.utils.db_clients.YamlTranslator.schema" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">schema</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the loaded YAML schema, loading it if necessary.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">yaml_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize YamlTranslator with YAML schema path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>yaml_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If YAML path not provided or TypeRegistry initialization fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yaml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize YamlTranslator with YAML schema path.</span>

<span class="sd">    Args:</span>
<span class="sd">        yaml_path: Path to YAML schema file. If None, uses MEMG_YAML_SCHEMA env var.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If YAML path not provided or TypeRegistry initialization fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Require explicit YAML path - no silent defaults</span>
    <span class="k">if</span> <span class="n">yaml_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">yaml_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">env_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEMG_YAML_SCHEMA&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
                <span class="s2">&quot;YAML schema path required. Set MEMG_YAML_SCHEMA environment variable &quot;</span>
                <span class="s2">&quot;or provide yaml_path parameter. No defaults allowed.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span> <span class="o">=</span> <span class="n">env_path</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_schema</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># NO model cache - TypeRegistry handles all caching</span>

    <span class="c1"># Initialize TypeRegistry from YAML - crash early if invalid</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">initialize_types_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to initialize TypeRegistry from YAML: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.build_anchor_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_anchor_text</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Build anchor text for embedding from YAML-defined anchor field.</p>
<p>NO hardcoded field names - reads anchor field from YAML schema.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>memory</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Memory object containing payload data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anchor text for embedding.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If anchor field is missing or invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_anchor_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build anchor text for embedding from YAML-defined anchor field.</span>

<span class="sd">    NO hardcoded field names - reads anchor field from YAML schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        memory: Memory object containing payload data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Anchor text for embedding.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If anchor field is missing or invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mem_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;memory_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mem_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="s2">&quot;Memory object missing &#39;memory_type&#39; field&quot;</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Get anchor field from YAML schema</span>
    <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">mem_type</span><span class="p">)</span>

    <span class="c1"># Try to get anchor text from the specified field</span>
    <span class="n">anchor_text</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># First check if it&#39;s a core field on the Memory object</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">):</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">anchor_field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Otherwise check in the payload</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="s2">&quot;payload&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">stripped_text</span> <span class="o">=</span> <span class="n">anchor_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">stripped_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stripped_text</span>

    <span class="c1"># Anchor field missing, empty, or invalid</span>
    <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; is missing, empty, or invalid &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">mem_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
        <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;build_anchor_text&quot;</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">mem_type</span><span class="p">,</span>
            <span class="s2">&quot;anchor_field&quot;</span><span class="p">:</span> <span class="n">anchor_field</span><span class="p">,</span>
            <span class="s2">&quot;anchor_value&quot;</span><span class="p">:</span> <span class="n">anchor_text</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.create_memory_from_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_memory_from_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a Memory object from YAML-validated payload.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_memory_from_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a Memory object from YAML-validated payload.&quot;&quot;&quot;</span>

    <span class="c1"># Get anchor field from YAML schema</span>
    <span class="n">anchor_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">memory_type</span><span class="p">)</span>

    <span class="c1"># Extract anchor text from payload</span>
    <span class="n">anchor_text</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anchor_field</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">anchor_text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">anchor_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing or invalid anchor field &#39;</span><span class="si">{</span><span class="n">anchor_field</span><span class="si">}</span><span class="s2">&#39; in payload &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;for memory type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Validate full payload against YAML schema</span>
    <span class="n">validated_payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="c1"># Construct Memory with YAML-defined payload only</span>
    <span class="k">return</span> <span class="n">Memory</span><span class="p">(</span>
        <span class="n">memory_type</span><span class="o">=</span><span class="n">memory_type</span><span class="p">,</span>
        <span class="n">payload</span><span class="o">=</span><span class="n">validated_payload</span><span class="p">,</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.debug_relation_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">debug_relation_map</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a nested relation map for debugging/printing.</p>
<p>Structure:
{
  source: {
    target: [ {name, predicate, directed, description} ... ]
  }
}</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">debug_relation_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a nested relation map for debugging/printing.</span>

<span class="sd">    Structure:</span>
<span class="sd">    {</span>
<span class="sd">      source: {</span>
<span class="sd">        target: [ {name, predicate, directed, description} ... ]</span>
<span class="sd">      }</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_types</span><span class="p">():</span>
        <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">specs</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">specs</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">out</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.get_anchor_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_anchor_field</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the anchor field name for the given entity type from YAML schema.</p>
<p>Now reads from vector.anchored_to instead of separate anchor field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the entity type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Anchor field name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="YamlTranslatorError (memg_core.core.yaml_translator.YamlTranslatorError)" href="#memg_core.core.yaml_translator.YamlTranslatorError">YamlTranslatorError</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If anchor field not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_anchor_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the anchor field name for the given entity type from YAML schema.</span>

<span class="sd">    Now reads from vector.anchored_to instead of separate anchor field.</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_name: Name of the entity type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Anchor field name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        YamlTranslatorError: If anchor field not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

    <span class="c1"># Get entity spec with inheritance resolution</span>
    <span class="n">entity_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_entity_with_inheritance</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>

    <span class="c1"># Look for vector field with anchored_to</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">entity_spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fields&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">_field_name</span><span class="p">,</span> <span class="n">field_def</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_def</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
            <span class="n">anchored_to</span> <span class="o">=</span> <span class="n">field_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anchored_to&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">anchored_to</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">anchored_to</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; has no vector field with &#39;anchored_to&#39; property&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.get_entity_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get Pydantic model from TypeRegistry - NO REDUNDANCY.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get Pydantic model from TypeRegistry - NO REDUNDANCY.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_entity_model</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.get_entity_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_entity_types</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get list of available entity types from YAML schema.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of available entity types from YAML schema.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.get_labels_for_predicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_labels_for_predicates</span><span class="p">(</span><span class="n">source_type</span><span class="p">,</span> <span class="n">predicates</span><span class="p">,</span> <span class="n">neighbor_label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Expand predicate names to concrete relationship labels for a given source.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source entity type name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>predicates</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of predicate names to include (case-insensitive). If None, include all.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>neighbor_label</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional target entity type filter (case-insensitive)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of concrete relationship labels (table names) matching the filter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_labels_for_predicates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">source_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">neighbor_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Expand predicate names to concrete relationship labels for a given source.</span>

<span class="sd">    Args:</span>
<span class="sd">        source_type: Source entity type name</span>
<span class="sd">        predicates: List of predicate names to include (case-insensitive). If None, include all.</span>
<span class="sd">        neighbor_label: Optional target entity type filter (case-insensitive)</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of concrete relationship labels (table names) matching the filter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty source_type&quot;</span><span class="p">)</span>

    <span class="n">preds_u</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">)</span> <span class="k">if</span> <span class="n">predicates</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">neighbor_l</span> <span class="o">=</span> <span class="n">neighbor_label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">neighbor_label</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">source_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">preds_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">preds_u</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">neighbor_l</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">neighbor_l</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relationship_table_name</span><span class="p">(</span>
                <span class="n">source</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">],</span>
                <span class="n">predicate</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;predicate&quot;</span><span class="p">],</span>
                <span class="n">target</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
                <span class="n">directed</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;directed&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.get_relations_for_source" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_relations_for_source</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get normalized relation specs for a source entity in target-first schema.</p>


<details class="returns-list-of-dicts-with-keys" open>
  <summary>Returns list of dicts with keys</summary>
  <ul>
<li>source (str)</li>
<li>target (str)</li>
<li>name (str | None)</li>
<li>description (str | None)</li>
<li>predicate (str)</li>
<li>directed (bool)</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_relations_for_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get normalized relation specs for a source entity in target-first schema.</span>

<span class="sd">    Returns list of dicts with keys:</span>
<span class="sd">        - source (str)</span>
<span class="sd">        - target (str)</span>
<span class="sd">        - name (str | None)</span>
<span class="sd">        - description (str | None)</span>
<span class="sd">        - predicate (str)</span>
<span class="sd">        - directed (bool)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>

    <span class="n">source_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">relations_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_relations_mapping_for_entity</span><span class="p">(</span><span class="n">source_l</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_map</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">out</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target_l</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">relations_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">predicate</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;predicate&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Skip invalid entries - strict behavior can be added later</span>
                <span class="k">continue</span>
            <span class="n">directed</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;directed&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source_l</span><span class="p">,</span>
                    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target_l</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;predicate&quot;</span><span class="p">:</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                    <span class="s2">&quot;directed&quot;</span><span class="p">:</span> <span class="n">directed</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.get_see_also_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_see_also_config</span><span class="p">(</span><span class="n">entity_name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the see_also configuration for the given entity type from YAML schema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict with keys: enabled, threshold, limit, target_types</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None if see_also is not configured for this entity</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_see_also_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the see_also configuration for the given entity type from YAML schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict with keys: enabled, threshold, limit, target_types</span>
<span class="sd">        None if see_also is not configured for this entity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;Empty entity name&quot;</span><span class="p">)</span>
    <span class="n">name_l</span> <span class="o">=</span> <span class="n">entity_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
    <span class="n">spec_raw</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name_l</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec_raw</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entity &#39;</span><span class="si">{</span><span class="n">entity_name</span><span class="si">}</span><span class="s2">&#39; not found in YAML schema&quot;</span><span class="p">)</span>

    <span class="n">see_also</span> <span class="o">=</span> <span class="n">spec_raw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;see_also&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">see_also</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Validate required fields</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)),</span>
        <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
        <span class="s2">&quot;target_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">see_also</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_types&quot;</span><span class="p">,</span> <span class="p">[])),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.relationship_table_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">relationship_table_name</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Generate relationship table name.</p>
<p>For now, table name does not encode direction; direction affects creation/query semantics.
Canonicalization for undirected pairs can be added here later if decided.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">relationship_table_name</span><span class="p">(</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># noqa: unused-argument</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate relationship table name.</span>

<span class="sd">    For now, table name does not encode direction; direction affects creation/query semantics.</span>
<span class="sd">    Canonicalization for undirected pairs can be added here later if decided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="memg_core.utils.db_clients.YamlTranslator.validate_memory_against_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_memory_against_yaml</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Validate memory payload against YAML schema and return cleaned payload.</p>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/yaml_translator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_memory_against_yaml</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">memory_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate memory payload against YAML schema and return cleaned payload.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">memory_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;memory_type is required&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span><span class="s2">&quot;payload is required&quot;</span><span class="p">)</span>

    <span class="c1"># Strict validation - entity type MUST exist in YAML</span>
    <span class="n">emap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_map</span><span class="p">()</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">emap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_type</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">spec</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown entity type &#39;</span><span class="si">{</span><span class="n">memory_type</span><span class="si">}</span><span class="s2">&#39;. All types must be defined in YAML schema.&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                <span class="s2">&quot;available_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">emap</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="n">req</span><span class="p">,</span> <span class="n">_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing required fields: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Validate enum fields against YAML schema choices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_enum_fields</span><span class="p">(</span><span class="n">memory_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="c1"># Validate that all fields are defined in YAML schema</span>
    <span class="n">req</span><span class="p">,</span> <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fields_contract</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">valid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">req</span> <span class="o">+</span> <span class="n">opt</span><span class="p">)</span>
    <span class="n">system_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_system_fields</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
    <span class="n">invalid_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">valid_fields</span> <span class="o">-</span> <span class="n">system_fields</span>
    <span class="k">if</span> <span class="n">invalid_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YamlTranslatorError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid fields not defined in schema: </span><span class="si">{</span><span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;memory_type&quot;</span><span class="p">:</span> <span class="n">memory_type</span><span class="p">,</span>
                <span class="s2">&quot;valid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">valid_fields</span><span class="p">),</span>
                <span class="s2">&quot;invalid_fields&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">invalid_fields</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="c1"># Strip system-reserved fields if present</span>
    <span class="n">cleaned</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">syskey</span> <span class="ow">in</span> <span class="n">system_fields</span><span class="p">:</span>
        <span class="n">cleaned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">syskey</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cleaned</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="memg_core.utils.db_clients.get_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_config</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get system configuration, preferring environment variables.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>MemorySystemConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="MemorySystemConfig


  
      dataclass
   (memg_core.core.config.MemorySystemConfig)" href="#memg_core.core.config.MemorySystemConfig">MemorySystemConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>System configuration instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/memg_core/core/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MemorySystemConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get system configuration, preferring environment variables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        MemorySystemConfig: System configuration instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MemorySystemConfig</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>